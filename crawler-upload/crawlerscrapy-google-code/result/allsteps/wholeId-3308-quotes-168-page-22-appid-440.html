https://code.google.com/archive/p/csipsimple/issues/1532<!DOCTYPE html><html class="google ng-scope" lang="en" ng-app="codesiteArchive.application"><head>
    <meta charset="utf-8">
    <meta content="initial-scale=1, minimum-scale=1, width=device-width" name="viewport">

    <!-- https://developers.google.com/webmasters/ajax-crawling/docs/specification -->
    <meta name="fragment" content="!">
    <title>Google Code Archive - Long-term storage for Google Code Project Hosting.</title>

    <link rel="icon" type="image/vnd.microsoft.icon" href="/archive/img/project-hosting.ico">
    <script src="//www.google.com/js/google.js"></script>
    <link href="//www.google.com/css/maia.css" rel="stylesheet">
    <link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,600,700&amp;lang=en" rel="stylesheet">
    <link rel="stylesheet" href="/archive/archive_css.css">
    <script>
      CLOSURE_NO_DEPS = true;
    </script>
    <script src="/archive/angular.js"></script><style type="text/css">@charset "UTF-8";

[ng\:cloak], [ng-cloak], [data-ng-cloak], [x-ng-cloak],
.ng-cloak, .x-ng-cloak,
.ng-hide:not(.ng-hide-animate) {
  display: none !important;
}

ng\:form {
  display: block;
}

.ng-animate-shim {
  visibility:hidden;
}

.ng-anchor {
  position:absolute;
}
</style>
    <script src="/archive/pagedown.js"></script>
    <script src="/archive/archive.js"></script>
    <base href="/archive/">
  </head>

  <body>
    <div class="maia-header" id="maia-header" role="banner">
      <div class="maia-aux">
        <a href="/archive/">
          </a><h1><a href="/archive/">
            <img alt="Google" src="//www.google.com/images/branding/googlelogo/1x/googlelogo_color_116x41dp.png"> Code</a>
          </h1>
        
        <a href="/archive/">
          <h2>Archive</h2>
        </a>
        <a class="maia-teleport" href="#content">Skip to content</a>
        <div class="maia-util">
          <form action="/archive/search" class="maia-search ng-pristine ng-valid">
            <input name="q" placeholder="Search this site" type="text">
            <button class="maia-button">
              <span class="maia-search-icon">Search</span>
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- ngView: --><div ng-view="" class="ng-scope"><div ng-controller="ProjectIssueCtrl as issueCtrl" class="ng-scope">
<nav-bar-widget nav-level-1="projectCtrl.navLevel1" class="ng-isolate-scope"><div class="maia-nav maia-complex" id="maia-nav-x" role="navigation">
  <div class="maia-aux">
    <ul>
      <li ng-class="{active: navLevel1 == 'projects'}">
        <a href="/archive/">Projects</a>
        <!-- ngIf: navLevel2 -->
      </li>
      <li ng-class="{active: navLevel1 == 'search'}">
        <a href="/archive/search">Search</a>
      </li>
      <li ng-class="{active: navLevel1 == 'about'}">
        <a href="/archive/about">About</a>
      </li>
    </ul>
  </div>
</div>
</nav-bar-widget>
<div id="maia-main" role="main">

  <!-- ngIf: issueCtrl.notFound -->

  <div ng-hide="issueCtrl.notFound">
    <!-- Left-side resource nav -->
    <project-resources-widget domain="issueCtrl.domain" project="issueCtrl.projectName" class="ng-isolate-scope"><div class="maia-nav" id="maia-nav-y" role="navigation">
  <!-- ngIf: domain == 'code.google.com' --><ul ng-if="domain == 'code.google.com'" class="ng-scope">
    <li class="active">
      <a href="/archive/p/csipsimple/">Project</a>
    </li>
    <li>
      <a href="/archive/p/csipsimple/source">Source</a>
    </li>
    <li>
      <a href="/archive/p/csipsimple/issues">Issues</a>
    </li>
    <li>
      <a href="/archive/p/csipsimple/wikis">Wikis</a>
    </li>
    <li>
      <a href="/archive/p/csipsimple/downloads">Downloads</a>
    </li>
  </ul><!-- end ngIf: domain == 'code.google.com' -->

    <!-- ngIf: domain != 'code.google.com' -->
</div></project-resources-widget>

    <div class="maia-article" role="article">
      <div class="maia-teleport" id="content"></div>
      <div class="maia-cols">
        <div id="gca-project-header" class="maia-col-10">
          <a id="gca-export-to-gh" class="maia-button" href="https://code.google.com/export-to-github/export?project=csipsimple">Export to GitHub</a>
            <img class="gca-project-logo" src="https://storage.googleapis.com/google-code-archive/v2/code.google.com/csipsimple/logo.png">
            <h1 class="ng-binding">csipsimple - issue #1532</h1>
            <p class="ng-binding">no RTP audio packets sent when WMM on wireless LAN and QoS on CSipSimple are enabled</p>
        </div>

        <div class="maia-col-10">
          <hr>

        <!-- ngIf: issueCtrl.error -->

        <!-- ngIf: !issueCtrl.error --><div ng-if="!issueCtrl.error" class="ng-scope">
          <!-- Comments -->
          <div class="maia-col-8">
            <!-- ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Jan 23, 2012 by
                  <i class="ng-binding">Happy Kangaroo</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p><b>What steps will reproduce the problem?</b>
1.Enabling WMM function for Wireless LAN on a wireless router or an access point 
2.Turn on "Enable QoS"
3.Connect to a wireless LAN access point, and any other networks are disabled(I don't use the phone as UMTS/GSM phone.)
4.Set up a RTP starting port number in the Network settings, 65520 for example.
5.Set up an audio call with maybe any codec (tested G711u and GSM) to sflphone by either URI direct call or extension via Asterisk server. They are all on the same network.</p>

<p><b>What is the expected output? What do you see instead?</b>
1.Sflphone should receive audio from CSipSimple, but no sound.
1-1.Outgoing audio from CSipSimple must be sent, but no audio is sent.
1-2.CSipSimple must send RTP packets to sflphone or Asterisk server, but no RTP packets are sent if I check the packets with WireShark. However, it sometimes works properly and sends RTP packets after a while being on the same network.</p>

<p><b>What version of the product are you using? On what operating system?</b>
Cellphone
1.LG Optimus One (Model No.:LG-P500h) with Android 2.3.3.
2.CSipSimple version is 0.03-01 r1108
3.Current IP address is 192.168.0.16 (DHCP)</p>

<p>Asterisk Server
1.OS is Ubuntu 11.04 with 2.6.38-8-generic kernel
2.Asterisk is Asterisk 1.6.2.9-2ubuntu2.1
3.Current IP address is 192.168.0.200 (static)</p>

<p>SFLphone
1.OS is Ubuntu 11.04 with 2.6.38-13-generic-pae kernel
2.SFLphone is 0.9.12
3.Current IP address is 192.168.0.10 (DHCP)</p>

<p>Wireless router
1.D-link WBR-2310 working as an access point (NAPT is disabled)
2.Firmware ver. 2.03
3.WMM function is on</p>

<p><b>Please provide any additional information below.</b>
1.CSipSimple works perfectly when it connects to the Asterisk Server that is open to the Internet from WAN side of NATed networks such as starbucks wifi etc.</p>

<p>Solutions to avoid this issue:
* Disabling WMM function on Wireless LAN
 --&gt; CSipSimple works perfectly regardless of Enable QoS setting.
* Disabling "Enable QoS" on CSipSimple
 --&gt; CSipSimple works perfectly regardless of WMM setting on a wireless router</p>

<p>So, this is mainly related to WMM(L2 QoS for wireless LAN, 802.11e-2005) functionality because CSipSImple works fine when WMM is disabled, and I presume that this issue occurs when WMM is on, Enable QoS is on and peers are in the same private LAN because I do not recall I had this issue when I used public wifi APs.</p>

<p>I will check if the wifi APs have WMM enabled or not when I visit any public wifi place next time, and post updates.</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #1</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Jan 23, 2012 by
                  <i class="ng-binding">Quick Hippo</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>Well I'm far to be expert on QoS stuff, but I know that it is very very tricky to configure on network equipement. Many sip providers do a lot of test on QoS before getting something working good with most clients.</p>

<p>QoS can be for good or for bad of the transport. So it is possible that qos lead to worse result than result you get without qos. You probably noticed that QoS is disabled by default in csipsimple. The reason is that I know that it can worsen things, and many sip providers advised me to disable it by default and let users that know what they do activate it.</p>

<p>To do qos (and actually to do all sip stuff), CSipSimple relies on pjsip (it's a well known and widely used sip stack)
The documentation about QoS on pjsip stack is available here :
<a href="http://trac.pjsip.org/repos/wiki/QoS">http://trac.pjsip.org/repos/wiki/QoS</a></p>

<p>What I can tell, is that pjsip on android is not built to support WMM (actually pjsip implementation does support WMM only on windows... )
The only implementation it supports is DSCP.</p>

<p>I added in the interface a way to activate QoS DSCP and a way to change the DSCP value. And it will automatically set the qos type as voice. (which should preset various other settings to correct values).
If you think that I should try to give access to another setting let me know, I'll add it in the interface so that you can tweak pjsip settings.</p>

<p>Since I've no real ways to do test in my dev environment, I'm not really able to test that part so do not hesitate to tell me if you observe something weird, I'll have a closer look to the code and how I setup pjsip.</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #2</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Jan 23, 2012 by
                  <i class="ng-binding">Happy Kangaroo</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>This could be related to my D-link WBR-2310 router.</p>

<p>I just remembered I have another wireless router, Planex MZK-MF300N2 for mobile usage and I tested the router as an AP in the same private LAN. The result is CSipSimple works fine with the router.</p>

<p>Although I cannot change the WMM parameter, it is set to enabled in the web console, and I can see QoS data frames between the router and my cellphone if I check 802.11 frames with WireShark unless I am looking at wrong place... Thus, this issue is most likely the the old D-Link router.</p>

<p>Is anyone able to confirm that CSipSimple works properly in WMM enabled on AP and "Enable QoS" on CSipSimple so that I can know it is the old D-Link router's issue??</p>

<p>Anyway, CSipSimple is the best SIP client software I have found. I can use it as an extension of my Asterisk server outside the house as if it is a cellphone at Starbucks etc. The only issue I had was this no outbound audio at home.</p>

<p>Thanks, r3gis...@gmail.com :)</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #3</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Jan 24, 2012 by
                  <i class="ng-binding">Happy Kangaroo</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>This is my comment to the QoS thing.</p>

<p>I am not an expert in QoS either. I have just 4 months experience in 802.11n certification testing as a co-op and got some knowledge about WMM and QoS from the experience.</p>

<p>From my point of view, WMM functionality support at this point is not mandatory. Because I believe that a sip client on android is not for business use yet and a wireless AP at home is not so congested. But, it is nice to have WMM ability.</p>

<p>Regarding to WMM functionality, WMM priority value is set from 802.1p(802.1D) priority value by a wireless adapter and its driver. So, I believe, but I am not expert though, you do not really need to pay attention to WMM.</p>

<p>In fact, CSipSimple 0.03-01 r1108(with my handset, LG P500h) does set the WMM priority to voice when Enable QoS is on if you check 802.11 frames going to an AP from the handset. And, Layer 3 QoS value is also properly set to voice.
The values I obtained with WireShark are following:
The QoS value in the IP header(in a RTP segment): Differentiated Services Field: 0xc0 (DSCP 0x30: Class Selector 6; ECN: 0x00)
The QoS value in an 802.11 frame: Priority: 6 (Voice) (Voice)
This means WMM prioritasation is working. If it is not working, it must be set to 0 (Best Effort).</p>

<p>This is just an idea though...
I do not really know the latest nightly build, but if CSipSimple will have a video call capability, it would be nice to have 2 QoS on/off interfaces for voice and video for maybe expert mode. If it makes 2 RTP data streams for video and voice, disabling QoS only for video could be a better way to keep the voice quality while compromising only the video quality in congested wifi networks.
I just came up with this idea. Again, I am not expert; I do not know how RTP packets are used for a video call, and I even do not know if the idea complies with the RFCs.</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #4</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Feb 25, 2013 by
                  <i class="ng-binding">Grumpy Panda</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>Comment deleted</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #5</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Feb 25, 2013 by
                  <i class="ng-binding">Happy Kangaroo</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>This thread's status can be changed to resolved as per my comment #2 - either D-link WBR-2310 router or LG Optimus One (Model No.:LG-P500h) with Android 2.3.3., or both was malfunctioning with the L3 QoS and L2 QoS.</p>

<p>And, I was not talking about only L3 QoS, anyway; an L3 QoS value must correspond to a proper L2 QoS value (WMM) since SCipSimple is most likely used by a wireless device, but either my phone (highly likely) or my old router did not set proper WMM QoS value and I found either one was configuring a wrong value as far as I can recall. And, this L3 and L2 QoS issue should be device dependent since CSipSimple configures DSCP value properly as far as I can remember.</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #6</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Feb 25, 2013 by
                  <i class="ng-binding">Quick Hippo</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>Thanks for the update. 
Sorry for the delay updating things (I've so many issues to treat ;) ), so good that you recall me to update this one ;)
Thanks !</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments -->
          </div>

          <!-- Sidebar with additional information -->
          <div class="maia-col-4">
            <div class="maia-aside">
              <p>Status: <code class="ng-binding">Fixed</code></p>
              <!-- ngIf: issueCtrl.issue.labels.length > 0 --><p ng-if="issueCtrl.issue.labels.length &gt; 0" class="ng-scope">
                Labels:
                <br>
                <!-- ngRepeat: label in issueCtrl.issue.labels track by $index --><span ng-repeat="label in issueCtrl.issue.labels track by $index" class="ng-scope">
                  <span class="gca-label ng-binding">Type-Defect</span>
                </span><!-- end ngRepeat: label in issueCtrl.issue.labels track by $index --><span ng-repeat="label in issueCtrl.issue.labels track by $index" class="ng-scope">
                  <span class="gca-label ng-binding">Priority-Medium</span>
                </span><!-- end ngRepeat: label in issueCtrl.issue.labels track by $index -->
              </p><!-- end ngIf: issueCtrl.issue.labels.length > 0 -->
            </div>
          </div>
        </div><!-- end ngIf: !issueCtrl.error -->
      </div>
    </div>

  </div>
</div>
</div></div></div>
    <noscript>
      &lt;p&gt;The Google Code Archive requires JavaScript to be enabled in your browser.&lt;/p&gt;
    </noscript>

    <div id="maia-signature"></div>
    <div class="maia-footer" id="maia-footer">
      <div id="maia-footer-local">
      </div>
      <div id="maia-footer-global">
        <div class="maia-aux">
          <ul>
            <li>
              <a href="//www.google.com/">Google</a>
            </li>
            <li>
              <a href="//www.google.com/intl/en/about/">About Google</a>
            </li>
            <li>
              <a href="//www.google.com/intl/en/policies/privacy/">Privacy</a>
            </li>
            <li>
              <a href="//www.google.com/intl/en/policies/terms/">Terms</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <script src="//www.google.com/js/maia.js"></script>
  


</body></html>