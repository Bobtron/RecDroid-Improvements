https://code.google.com/archive/p/csipsimple/issues/2868<!DOCTYPE html><html class="google ng-scope" lang="en" ng-app="codesiteArchive.application"><head>
    <meta charset="utf-8">
    <meta content="initial-scale=1, minimum-scale=1, width=device-width" name="viewport">

    <!-- https://developers.google.com/webmasters/ajax-crawling/docs/specification -->
    <meta name="fragment" content="!">
    <title>Google Code Archive - Long-term storage for Google Code Project Hosting.</title>

    <link rel="icon" type="image/vnd.microsoft.icon" href="/archive/img/project-hosting.ico">
    <script src="//www.google.com/js/google.js"></script>
    <link href="//www.google.com/css/maia.css" rel="stylesheet">
    <link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,600,700&amp;lang=en" rel="stylesheet">
    <link rel="stylesheet" href="/archive/archive_css.css">
    <script>
      CLOSURE_NO_DEPS = true;
    </script>
    <script src="/archive/angular.js"></script><style type="text/css">@charset "UTF-8";

[ng\:cloak], [ng-cloak], [data-ng-cloak], [x-ng-cloak],
.ng-cloak, .x-ng-cloak,
.ng-hide:not(.ng-hide-animate) {
  display: none !important;
}

ng\:form {
  display: block;
}

.ng-animate-shim {
  visibility:hidden;
}

.ng-anchor {
  position:absolute;
}
</style>
    <script src="/archive/pagedown.js"></script>
    <script src="/archive/archive.js"></script>
    <base href="/archive/">
  </head>

  <body>
    <div class="maia-header" id="maia-header" role="banner">
      <div class="maia-aux">
        <a href="/archive/">
          </a><h1><a href="/archive/">
            <img alt="Google" src="//www.google.com/images/branding/googlelogo/1x/googlelogo_color_116x41dp.png"> Code</a>
          </h1>
        
        <a href="/archive/">
          <h2>Archive</h2>
        </a>
        <a class="maia-teleport" href="#content">Skip to content</a>
        <div class="maia-util">
          <form action="/archive/search" class="maia-search ng-pristine ng-valid">
            <input name="q" placeholder="Search this site" type="text">
            <button class="maia-button">
              <span class="maia-search-icon">Search</span>
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- ngView: --><div ng-view="" class="ng-scope"><div ng-controller="ProjectIssueCtrl as issueCtrl" class="ng-scope">
<nav-bar-widget nav-level-1="projectCtrl.navLevel1" class="ng-isolate-scope"><div class="maia-nav maia-complex" id="maia-nav-x" role="navigation">
  <div class="maia-aux">
    <ul>
      <li ng-class="{active: navLevel1 == 'projects'}">
        <a href="/archive/">Projects</a>
        <!-- ngIf: navLevel2 -->
      </li>
      <li ng-class="{active: navLevel1 == 'search'}">
        <a href="/archive/search">Search</a>
      </li>
      <li ng-class="{active: navLevel1 == 'about'}">
        <a href="/archive/about">About</a>
      </li>
    </ul>
  </div>
</div>
</nav-bar-widget>
<div id="maia-main" role="main">

  <!-- ngIf: issueCtrl.notFound -->

  <div ng-hide="issueCtrl.notFound">
    <!-- Left-side resource nav -->
    <project-resources-widget domain="issueCtrl.domain" project="issueCtrl.projectName" class="ng-isolate-scope"><div class="maia-nav" id="maia-nav-y" role="navigation">
  <!-- ngIf: domain == 'code.google.com' --><ul ng-if="domain == 'code.google.com'" class="ng-scope">
    <li class="active">
      <a href="/archive/p/csipsimple/">Project</a>
    </li>
    <li>
      <a href="/archive/p/csipsimple/source">Source</a>
    </li>
    <li>
      <a href="/archive/p/csipsimple/issues">Issues</a>
    </li>
    <li>
      <a href="/archive/p/csipsimple/wikis">Wikis</a>
    </li>
    <li>
      <a href="/archive/p/csipsimple/downloads">Downloads</a>
    </li>
  </ul><!-- end ngIf: domain == 'code.google.com' -->

    <!-- ngIf: domain != 'code.google.com' -->
</div></project-resources-widget>

    <div class="maia-article" role="article">
      <div class="maia-teleport" id="content"></div>
      <div class="maia-cols">
        <div id="gca-project-header" class="maia-col-10">
          <a id="gca-export-to-gh" class="maia-button" href="https://code.google.com/export-to-github/export?project=csipsimple">Export to GitHub</a>
            <img class="gca-project-logo" src="https://storage.googleapis.com/google-code-archive/v2/code.google.com/csipsimple/logo.png">
            <h1 class="ng-binding">csipsimple - issue #2868</h1>
            <p class="ng-binding">Choppy Opus audio</p>
        </div>

        <div class="maia-col-10">
          <hr>

        <!-- ngIf: issueCtrl.error -->

        <!-- ngIf: !issueCtrl.error --><div ng-if="!issueCtrl.error" class="ng-scope">
          <!-- Comments -->
          <div class="maia-col-8">
            <!-- ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Jan 10, 2015 by
                  <i class="ng-binding">Swift Kangaroo</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p><b>What steps will reproduce the problem?</b>
1. Use Opus
<b>2.</b>
<b>3.</b></p>

<p><b>What is the expected output? What do you see instead?</b>
with SILK I get OK sound, but with Opus the audio is choppy.</p>

<p>because of "Issue attachment storage quota exceeded", here's a link:
<a href="https://drive.google.com/file/d/0B_EMXtsx7o56ZnY2djZRS05DUlk/view?usp=sharing">https://drive.google.com/file/d/0B_EMXtsx7o56ZnY2djZRS05DUlk/view?usp=sharing</a></p>

<p>I wonder if my ZTE Blade III (cyanogenmod 11) is too slow. The other end has Nexus 5 (Lollipop).</p>

<p>If CPU is too slow, csipsimple should run performance test on startup.</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #1</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Jan 18, 2015 by
                  <i class="ng-binding">Quick Hippo</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>Sounds like problems I had with compatibility of older version of Opus spec. Are both devices using the very latest opus plugin version? Also, is there a sip server in the middle?</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #2</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Jan 18, 2015 by
                  <i class="ng-binding">Swift Kangaroo</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>Both devices have the latest codec pack from Play.
We both have configured ostel.co accounts, using tls and zrtp. </p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #3</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Feb 8, 2015 by
                  <i class="ng-binding">Quick Hippo</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>Hi,</p>

<p>The version on the playstore is outdate.
Please download and install the 1.5 from <a href="http://nightlies.csipsimple.com/plugins/">http://nightlies.csipsimple.com/plugins/</a></p>

<p>I'm trying to solve some change in android 5.x changes before releasing on playstore.</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #4</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Feb 24, 2015 by
                  <i class="ng-binding">Helpful Camel</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>I'm experiencing another kind of choppy sound with Opus: with a ptime of 40ms in FreeSwitch (Opus frame composed of 2*20ms subframes), the decoded audio by CSS is missing the second part (20ms of sound followed by 20ms of silence) and so on...</p>

<p>SDP:
v=0
o=FreeSWITCH 1424805772 1424805773 IN IP4 192.168.1.3
s=FreeSWITCH
c=IN IP4 192.168.1.3
t=0 0
m=audio 10454 RTP/AVP 111 101
a=rtpmap:111 opus/48000/2
a=fmtp:111 maxplaybackrate=16000
a=rtpmap:101 telephone-event/8000
a=fmtp:101 0-16
a=ptime:40
a=rtcp:10455 IN IP4 192.168.1.3</p>

<p>Partial log:
23:25:17.778      pj_opus.c !Frame recovered 640
23:25:17.778      pj_opus.c  Frame recovered 320
23:25:17.779 pjsua_jni_addo !.....Call 0 state changed to CONFIRMED
23:25:17.779      pj_opus.c !Encoder packet size 65 for input 1280 ouput max len 800 @ 6720
23:25:17.781      pj_opus.c  Frame recovered 640
23:25:17.781      pj_opus.c  Frame recovered 320
23:25:17.781 pjsua_jni_addo !.....Get secure for media type 1
23:25:17.782      pj_opus.c !Encoder packet size 84 for input 1280 ouput max len 800 @ 7360
23:25:17.782   Master/sound  Underflow, buf_cnt=0, will generate 1 frame
23:25:17.782      pj_opus.c  Frame recovered 640
23:25:17.782      pj_opus.c  Frame recovered 320
23:25:17.782   Master/sound  Underflow, buf_cnt=0, will generate 1 frame
23:25:17.783      pj_opus.c  Encoder packet size 75 for input 1280 ouput max len 800 @ 8000
23:25:17.783      pj_opus.c  Frame recovered 640
23:25:17.783      pj_opus.c  Frame recovered 320
23:25:17.785   Master/sound  Underflow, buf_cnt=0, will generate 1 frame
23:25:17.786      pj_opus.c  Encoder packet size 76 for input 1280 ouput max len 800 @ 8640
23:25:17.786 zrtp_android.c !ZRTP info message: Hello received, preparing a Commit
23:25:17.789 zrtp_android.c  ZRTP info message: Commit: Generated a public DH key
23:25:17.791 pjsua_jni_addo !.....Get secure for media type 1
23:25:17.885      pj_opus.c !Frame recovered 640
23:25:17.885      pj_opus.c  Frame recovered 320
23:25:17.886      pj_opus.c  Encoder packet size 66 for input 1280 ouput max len 800 @ 9280
23:25:17.886      pj_opus.c  Frame recovered 640
23:25:17.886      pj_opus.c  Frame recovered 320
23:25:17.887      pj_opus.c  Encoder packet size 53 for input 1280 ouput max len 800 @ 9920
23:25:17.887   Master/sound  Underflow, buf_cnt=0, will generate 1 frame
23:25:17.905      pj_opus.c  Encoder packet size 62 for input 1280 ouput max len 800 @ 10560
23:25:18.006      pj_opus.c  Encoder packet size 70 for input 1280 ouput max len 800 @ 11200
23:25:18.006      pj_opus.c  Encoder packet size 58 for input 1280 ouput max len 800 @ 11840
23:25:18.025      pj_opus.c  Encoder packet size 66 for input 1280 ouput max len 800 @ 12480
23:25:18.125      pj_opus.c  Encoder packet size 59 for input 1280 ouput max len 800 @ 13120
23:25:18.127      pj_opus.c  Encoder packet size 71 for input 1280 ouput max len 800 @ 13760
23:25:18.145      pj_opus.c  Encoder packet size 56 for input 1280 ouput max len 800 @ 14400
23:25:18.246      pj_opus.c  Encoder packet size 62 for input 1280 ouput max len 800 @ 15040
23:25:18.248      pj_opus.c  Encoder packet size 62 for input 1280 ouput max len 800 @ 15680
23:25:18.266      pj_opus.c  Encoder packet size 51 for input 1280 ouput max len 800 @ 16320
23:25:18.366      pj_opus.c  Encoder packet size 59 for input 1280 ouput max len 800 @ 16960
23:25:18.368      pj_opus.c  Encoder packet size 54 for input 1280 ouput max len 800 @ 17600
23:25:18.386      pj_opus.c  Encoder packet size 53 for input 1280 ouput max len 800 @ 18240
23:25:18.487      pj_opus.c  Encoder packet size 51 for input 1280 ouput max len 800 @ 18880
23:25:18.490      pj_opus.c  Encoder packet size 66 for input 1280 ouput max len 800 @ 19520
23:25:18.506      pj_opus.c  Encoder packet size 61 for input 1280 ouput max len 800 @ 20160
23:25:18.590 zrtp_android.c !ZRTP info message: Initiator: DHPart1 received, preparing DHPart2
23:25:18.597 zrtp_android.c  ZRTP info message: At least one retained secrets matches - security OK
23:25:18.606      pj_opus.c !Encoder packet size 71 for input 1280 ouput max len 800 @ 20800
23:25:18.608      pj_opus.c  Encoder packet size 68 for input 1280 ouput max len 800 @ 21440
23:25:18.627      pj_opus.c  Encoder packet size 66 for input 1280 ouput max len 800 @ 22080
23:25:18.727      pj_opus.c  Encoder packet size 62 for input 1280 ouput max len 800 @ 22720
23:25:18.729      pj_opus.c  Encoder packet size 59 for input 1280 ouput max len 800 @ 23360
23:25:18.730 zrtp_android.c !ZRTP info message: Initiator: Confirm1 received, preparing Confirm2
23:25:18.747      pj_opus.c !Encoder packet size 65 for input 1280 ouput max len 800 @ 24000
23:25:18.849      pj_opus.c  Encoder packet size 61 for input 1280 ouput max len 800 @ 24640
23:25:18.853      pj_opus.c  Encoder packet size 57 for input 1280 ouput max len 800 @ 25280
23:25:18.861 zrtp_android.c !Show sas : indw in ctxt 2a287cd0
23:25:18.865 zrtp_android.c  ZRTP info message: Entered secure state
23:25:18.867 pjsua_jni_addo !Get secure for media type 1
23:25:18.867      pj_opus.c !Pkt info : bw -&gt; 1105 , spf -&gt; 320, offset 2, packet_size 289
23:25:18.868      pj_opus.c  parsed 289 of 2
23:25:18.868      pj_opus.c  parsed 289 of 2
23:25:18.873 pjsua_jni_addo !Get secure for media type 1
23:25:18.892      pj_opus.c !Pkt info : bw -&gt; 1105 , spf -&gt; 320, offset 2, packet_size 248
23:25:18.893      pj_opus.c  parsed 248 of 2
23:25:18.893      pj_opus.c  parsed 248 of 2
23:25:18.931      pj_opus.c !Pkt info : bw -&gt; 1105 , spf -&gt; 320, offset 2, packet_size 266
23:25:18.931      pj_opus.c  parsed 266 of 2
23:25:18.931      pj_opus.c  parsed 266 of 2
23:25:18.966      pj_opus.c !Encoder packet size 74 for input 1280 ouput max len 800 @ 25920
23:25:18.967      pj_opus.c  Decode : copy from big buffer 1280 to 640
23:25:18.967      pj_opus.c  Decoded 289 to 640 with max 1280
23:25:18.967      pj_opus.c  Decode : copy from big buffer 640 to 640
23:25:18.967      pj_opus.c  Decoded 289 to 640 with max 640
23:25:18.969      pj_opus.c  Encoder packet size 63 for input 1280 ouput max len 800 @ 26560
23:25:18.970      pj_opus.c  Decode : copy from big buffer 1280 to 640
23:25:18.970      pj_opus.c  Decoded 248 to 640 with max 1280
23:25:18.970      pj_opus.c  Decode : copy from big buffer 640 to 640
23:25:18.970      pj_opus.c  Decoded 248 to 640 with max 640
23:25:18.972      pj_opus.c  Encoder packet size 58 for input 1280 ouput max len 800 @ 27200
23:25:18.974      pj_opus.c !Pkt info : bw -&gt; 1105 , spf -&gt; 320, offset 2, packet_size 323
23:25:18.974      pj_opus.c  parsed 323 of 2
23:25:18.974      pj_opus.c  parsed 323 of 2
23:25:18.985      pj_opus.c !Decode : copy from big buffer 1280 to 640
23:25:18.985      pj_opus.c  Decoded 266 to 640 with max 1280
23:25:18.985      pj_opus.c  Decode : copy from big buffer 640 to 640
23:25:18.985      pj_opus.c  Decoded 266 to 640 with max 640</p>

<p>I've been taking a look at opus_codec_parse() (pj_opus.c) and if I set *frame_cnt = 1; before the loop, the issue improves with continuous clicks.</p>

<p>By the way, in opus_codec_decode(),
the mask for frm_info should'n be 0xff, as shown in opus_codec_parse()?
  frm_info = input-&gt;bit_info &amp; 0xFF;
instead of
  frm_info = input-&gt;bit_info &amp; 0xF;
Opus accepts up to 48 subframes for an internal ptime of 2.5ms.</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #5</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Apr 14, 2015 by
                  <i class="ng-binding">Swift Kangaroo</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>can't reproduce with current versions, except that now I have Motorola Moto G 2014.  </p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments -->
          </div>

          <!-- Sidebar with additional information -->
          <div class="maia-col-4">
            <div class="maia-aside">
              <p>Status: <code class="ng-binding">Need-Details</code></p>
              <!-- ngIf: issueCtrl.issue.labels.length > 0 --><p ng-if="issueCtrl.issue.labels.length &gt; 0" class="ng-scope">
                Labels:
                <br>
                <!-- ngRepeat: label in issueCtrl.issue.labels track by $index --><span ng-repeat="label in issueCtrl.issue.labels track by $index" class="ng-scope">
                  <span class="gca-label ng-binding">Type-Defect</span>
                </span><!-- end ngRepeat: label in issueCtrl.issue.labels track by $index --><span ng-repeat="label in issueCtrl.issue.labels track by $index" class="ng-scope">
                  <span class="gca-label ng-binding">Priority-Medium</span>
                </span><!-- end ngRepeat: label in issueCtrl.issue.labels track by $index -->
              </p><!-- end ngIf: issueCtrl.issue.labels.length > 0 -->
            </div>
          </div>
        </div><!-- end ngIf: !issueCtrl.error -->
      </div>
    </div>

  </div>
</div>
</div></div></div>
    <noscript>
      &lt;p&gt;The Google Code Archive requires JavaScript to be enabled in your browser.&lt;/p&gt;
    </noscript>

    <div id="maia-signature"></div>
    <div class="maia-footer" id="maia-footer">
      <div id="maia-footer-local">
      </div>
      <div id="maia-footer-global">
        <div class="maia-aux">
          <ul>
            <li>
              <a href="//www.google.com/">Google</a>
            </li>
            <li>
              <a href="//www.google.com/intl/en/about/">About Google</a>
            </li>
            <li>
              <a href="//www.google.com/intl/en/policies/privacy/">Privacy</a>
            </li>
            <li>
              <a href="//www.google.com/intl/en/policies/terms/">Terms</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <script src="//www.google.com/js/maia.js"></script>
  


</body></html>