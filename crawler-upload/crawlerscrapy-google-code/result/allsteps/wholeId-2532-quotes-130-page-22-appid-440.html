https://code.google.com/archive/p/csipsimple/issues/2274<!DOCTYPE html><html class="google ng-scope" lang="en" ng-app="codesiteArchive.application"><head>
    <meta charset="utf-8">
    <meta content="initial-scale=1, minimum-scale=1, width=device-width" name="viewport">

    <!-- https://developers.google.com/webmasters/ajax-crawling/docs/specification -->
    <meta name="fragment" content="!">
    <title>Google Code Archive - Long-term storage for Google Code Project Hosting.</title>

    <link rel="icon" type="image/vnd.microsoft.icon" href="/archive/img/project-hosting.ico">
    <script src="//www.google.com/js/google.js"></script>
    <link href="//www.google.com/css/maia.css" rel="stylesheet">
    <link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,600,700&amp;lang=en" rel="stylesheet">
    <link rel="stylesheet" href="/archive/archive_css.css">
    <script>
      CLOSURE_NO_DEPS = true;
    </script>
    <script src="/archive/angular.js"></script><style type="text/css">@charset "UTF-8";

[ng\:cloak], [ng-cloak], [data-ng-cloak], [x-ng-cloak],
.ng-cloak, .x-ng-cloak,
.ng-hide:not(.ng-hide-animate) {
  display: none !important;
}

ng\:form {
  display: block;
}

.ng-animate-shim {
  visibility:hidden;
}

.ng-anchor {
  position:absolute;
}
</style>
    <script src="/archive/pagedown.js"></script>
    <script src="/archive/archive.js"></script>
    <base href="/archive/">
  </head>

  <body>
    <div class="maia-header" id="maia-header" role="banner">
      <div class="maia-aux">
        <a href="/archive/">
          </a><h1><a href="/archive/">
            <img alt="Google" src="//www.google.com/images/branding/googlelogo/1x/googlelogo_color_116x41dp.png"> Code</a>
          </h1>
        
        <a href="/archive/">
          <h2>Archive</h2>
        </a>
        <a class="maia-teleport" href="#content">Skip to content</a>
        <div class="maia-util">
          <form action="/archive/search" class="maia-search ng-pristine ng-valid">
            <input name="q" placeholder="Search this site" type="text">
            <button class="maia-button">
              <span class="maia-search-icon">Search</span>
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- ngView: --><div ng-view="" class="ng-scope"><div ng-controller="ProjectIssueCtrl as issueCtrl" class="ng-scope">
<nav-bar-widget nav-level-1="projectCtrl.navLevel1" class="ng-isolate-scope"><div class="maia-nav maia-complex" id="maia-nav-x" role="navigation">
  <div class="maia-aux">
    <ul>
      <li ng-class="{active: navLevel1 == 'projects'}">
        <a href="/archive/">Projects</a>
        <!-- ngIf: navLevel2 -->
      </li>
      <li ng-class="{active: navLevel1 == 'search'}">
        <a href="/archive/search">Search</a>
      </li>
      <li ng-class="{active: navLevel1 == 'about'}">
        <a href="/archive/about">About</a>
      </li>
    </ul>
  </div>
</div>
</nav-bar-widget>
<div id="maia-main" role="main">

  <!-- ngIf: issueCtrl.notFound -->

  <div ng-hide="issueCtrl.notFound">
    <!-- Left-side resource nav -->
    <project-resources-widget domain="issueCtrl.domain" project="issueCtrl.projectName" class="ng-isolate-scope"><div class="maia-nav" id="maia-nav-y" role="navigation">
  <!-- ngIf: domain == 'code.google.com' --><ul ng-if="domain == 'code.google.com'" class="ng-scope">
    <li class="active">
      <a href="/archive/p/csipsimple/">Project</a>
    </li>
    <li>
      <a href="/archive/p/csipsimple/source">Source</a>
    </li>
    <li>
      <a href="/archive/p/csipsimple/issues">Issues</a>
    </li>
    <li>
      <a href="/archive/p/csipsimple/wikis">Wikis</a>
    </li>
    <li>
      <a href="/archive/p/csipsimple/downloads">Downloads</a>
    </li>
  </ul><!-- end ngIf: domain == 'code.google.com' -->

    <!-- ngIf: domain != 'code.google.com' -->
</div></project-resources-widget>

    <div class="maia-article" role="article">
      <div class="maia-teleport" id="content"></div>
      <div class="maia-cols">
        <div id="gca-project-header" class="maia-col-10">
          <a id="gca-export-to-gh" class="maia-button" href="https://code.google.com/export-to-github/export?project=csipsimple">Export to GitHub</a>
            <img class="gca-project-logo" src="https://storage.googleapis.com/google-code-archive/v2/code.google.com/csipsimple/logo.png">
            <h1 class="ng-binding">csipsimple - issue #2274</h1>
            <p class="ng-binding">TLS Transport almost completely broken</p>
        </div>

        <div class="maia-col-10">
          <hr>

        <!-- ngIf: issueCtrl.error -->

        <!-- ngIf: !issueCtrl.error --><div ng-if="!issueCtrl.error" class="ng-scope">
          <!-- Comments -->
          <div class="maia-col-8">
            <!-- ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Mar 7, 2013 by
                  <i class="ng-binding">Happy Lion</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p><b>What steps will reproduce the problem?</b>
1. Use TLS transport with a SIP account (make sure you enable it in Network settings -&gt; Security)</p>

<p><b>What is the expected output? What do you see instead?</b>
I have only port 5061 (default TLS port) open on my firewall. If I just setup an account it won't register. If I put port 5061 it registers. But if you want to make a call it will use UDP transport (If you disable UDP transport in Network settings you get unsupported transport error). If I setup a proxy to the server with port 5061 it will register and can make a call but the call will be dropped after 30 seconds (I can't hangup my self btw).</p>

<p>Used Bria or other softphone, these work as expected.</p>

<p><b>What version of the product are you using? On what operating system?</b>
Latest stable and trunk. Using LG Nexus 4 on Android 4.2.2, but also having same issues on Sony Xperia T on Android 4.0.4 and 4.1.2</p>

<p><b>Please provide any additional information below.</b>
I had same kind of issues using TCP transport, these were kind of fixed using proxy, but it still tries to connect on UDP while making a call. This should not happen and should always use current transport wich is used to register.</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #1</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Mar 7, 2013 by
                  <i class="ng-binding">Quick Hippo</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>Well, maybe some explaination on sip topology are needed here (was already explained several times in the issue list, but lets do it again).</p>

<p>Actually, when you configure your account there is two <em>different</em> things. One is the registrar and the other is the sip proxy. And there is a third thing that is a call.</p>

<p>You can configure how sip is routed using these settings.</p>

<ul>
<li>Basically the registrar is just the server where you tell how to reach you. It's for register requests only and is indirectly used as default domain for calls made from the dialer.</li>
<li>The sip proxy is the server added to route in each requests. So this is very important if you want all your request to go through your server. By default the basic wizard set both the proxy and the registrar.
When you configure the "transport" setting in the account settings, it will apply to :</li>
<li>proxy if any setup (adding ;transport=TCP or ;transport=TLS)
or</li>
<li>registrar if no proxy setup.</li>
</ul>

<p>So for registration the transport used will be the one setup here in any case. And if you use your server as sip proxy it will apply for all calls too. Note that you must also set the port here using the simple very standard port string for example :5080 if you want to connect the port 5080 of the server.</p>

<p>Then, when you make a call. If you don't enter the part after the @ explicitely, it will autocomplete with the domain name of the account. Note that it doesn't autocomplete with the transport here. So if you configured <em>only</em> the registrar and the account with the TLS transport you will <em>NOT</em> use TLS transport. And this is a valid sip use case ! It is a valid topology and something that you could want. 
In sip you don't not necessarily want to call someone on your domain and if you don't use <em>your</em> proxy, and call someone in another domain, you will <em>NOT</em> need to go through <em>your</em> sip server ! In this case the sip path can go directly. And that's just fine in some cases ! It really depends on the topology. In situation where you didn't configure the sip proxy field, if you want to reach someone using TLS transport you need to dial the full sip uri user@domain;transport=TLS. (or adding scheme sips:xxxxx)</p>

<p>So for non expert users that wants to use TLS the advise is the following :
 - enable it in general settings 
 - create your account with basic wizard
 - long press account row select choose wizard and expert to transform it into an expert wizard
 - change the transport to TLS.</p>

<p>In this case, the server proxy will be set (as it's more likely what you want) and you sip path will pass by your sip server and be encrypted. After your server, if the callee is a non tls reachable user, it might not be encrypted.</p>

<p>So the TLS transport is not completely broken as you think. You are just misunderstanding some concept behind. However, maybe the user interface and the approach is one a little bit too expert. I'm open to discution if you have ideas and arguments to improve that (without breaking the fact that all topologies must be supported)</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #2</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Mar 7, 2013 by
                  <i class="ng-binding">Happy Lion</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>I understand that these are different, that's why I'm saying it should use the same transport as for the registration. Registration is not mandatory (I'm very aware of that). I'm also aware what the role is of a proxy.</p>

<p>But the problem still exists :-)
I've added a basic account, entered the details, changed transport to TLS. Now what is happening what I also mentioned in the ticket. I will register and can make a call (kind of). It will make the call but will drop it after 30 seconds, also I <em>can't</em> hangup the call, the button will get focus and grey out when I tap on it but the call just continue until 30 seconds and will then drop.</p>

<p>I also tried a uri call with appending ;transport=tls but also call will be dropped.</p>

<p>I think you should add transport option in basic or advanced wizard. Advanced it is only possible to select TCP not TLS. And why is TLS by default disabled in security settings?</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #3</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Mar 7, 2013 by
                  <i class="ng-binding">Quick Hippo</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>Did you setup your server with port 5061 ?</p>

<p>About two last points :</p>

<blockquote>
  <p>I think you should add transport option in basic or advanced wizard. Advanced it is only possible to select TCP not TLS. </p>
</blockquote>

<p>Currently not a setting understood by mainstream users. When a SIP provider allows TLS there is such an option or it's enabled by default : it's the case of OSTN and IT DOES WORKS !. In this case, it's tested and the fact that the server supports TLS correctly is sure. In this case the global setting is also enabled automatically.
So users just enter his username/pwd and the configuration is done so that TLS works. And it DOES work. There is no bug with that (I just retested). So it's definitely a problem in your configuration.</p>

<blockquote>
  <p>And why is TLS by default disabled in security settings?
  Matter of resources. If the wizard of the account allows TLS it will enable this global setting. If user doesn't need it resources to setup the TLS sockets will not be allocated. One of the task in this issue list is to add a warning dedicated for expert users that miss something and enable tls transport in account without having it in global settings.
  The goal of the expert wizard/setting mode is not mainstream users. It's developers aware of what it changes in pjsip sip stack (the settings are directly those of pjsip stack) and for users that are guided to try to have things working with their particular topology. And these users are guided either by me or by their IT that setup the SIP network are is aware of what to setup to match their topology.</p>
</blockquote>

<p>As pjsip is a rock robust stack with a lot of feature to address <em>all</em> possible topologies that's the way I decided to go. For super expert that have specific needs give the direct access to the stack. For mainstream users, make things easy and auto configure everything in the sip stack.
This also means that stuff like TLS are basically stuff that comes from pjsip and are already available in other apps such as blink etc and already tested elsewhere. 
Some other software voluntarily hide the complexity and try to find a compromise for users and expert. I consider this kind of compromize to be bad.
It deserve mainstream users that gets lost while they only want to enter a username and a password and get their service working (what I address with wizard)
It deserve expert that will not have full control on what is done by the sip application (what I address by expert modes). And expert without full knowledge will learn exactly how the stack works and I consider that good (as could reach some point were feedback can underly real root causes) :)</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #4</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Mar 7, 2013 by
                  <i class="ng-binding">Happy Lion</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>Sorry for the inconvenience but now it works like a charm. </p>

<p>I've kicked my server (Freeswitch) (killed and started again) and now it works. Strange part of this is that other clients did actually work?</p>

<p>Still investigating the logs it looks like the server is sending a signal after 30 seconds to check if the call is still active and the client doesn't respond and the server is terminating the call.</p>

<p>Why CSipSimple client didn't respond is still a mystery for me.</p>

<p>Anyway thank you for your time and for your patience!</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #5</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Mar 7, 2013 by
                  <i class="ng-binding">Quick Hippo</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>If you have the log it can be interesting to investigate. You can send it by email. I'll try to have a look.
Maybe something will ring a bell in the logs. 
The behavior of pjsip is by default sometimes a little bit weird but it's often to match at best the sip rfc. There is usually more pragmatic settings to workaround more complex/strange topology/servers.</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #6</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Mar 7, 2013 by
                  <i class="ng-binding">Happy Lion</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>I've sent you the log files to your email.</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments -->
          </div>

          <!-- Sidebar with additional information -->
          <div class="maia-col-4">
            <div class="maia-aside">
              <p>Status: <code class="ng-binding">Invalid</code></p>
              <!-- ngIf: issueCtrl.issue.labels.length > 0 --><p ng-if="issueCtrl.issue.labels.length &gt; 0" class="ng-scope">
                Labels:
                <br>
                <!-- ngRepeat: label in issueCtrl.issue.labels track by $index --><span ng-repeat="label in issueCtrl.issue.labels track by $index" class="ng-scope">
                  <span class="gca-label ng-binding">Type-Defect</span>
                </span><!-- end ngRepeat: label in issueCtrl.issue.labels track by $index --><span ng-repeat="label in issueCtrl.issue.labels track by $index" class="ng-scope">
                  <span class="gca-label ng-binding">Priority-Medium</span>
                </span><!-- end ngRepeat: label in issueCtrl.issue.labels track by $index -->
              </p><!-- end ngIf: issueCtrl.issue.labels.length > 0 -->
            </div>
          </div>
        </div><!-- end ngIf: !issueCtrl.error -->
      </div>
    </div>

  </div>
</div>
</div></div></div>
    <noscript>
      &lt;p&gt;The Google Code Archive requires JavaScript to be enabled in your browser.&lt;/p&gt;
    </noscript>

    <div id="maia-signature"></div>
    <div class="maia-footer" id="maia-footer">
      <div id="maia-footer-local">
      </div>
      <div id="maia-footer-global">
        <div class="maia-aux">
          <ul>
            <li>
              <a href="//www.google.com/">Google</a>
            </li>
            <li>
              <a href="//www.google.com/intl/en/about/">About Google</a>
            </li>
            <li>
              <a href="//www.google.com/intl/en/policies/privacy/">Privacy</a>
            </li>
            <li>
              <a href="//www.google.com/intl/en/policies/terms/">Terms</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <script src="//www.google.com/js/maia.js"></script>
  


</body></html>