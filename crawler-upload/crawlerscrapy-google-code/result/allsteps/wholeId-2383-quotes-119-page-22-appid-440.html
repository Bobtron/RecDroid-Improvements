https://code.google.com/archive/p/csipsimple/issues/2404<!DOCTYPE html><html class="google ng-scope" lang="en" ng-app="codesiteArchive.application"><head>
    <meta charset="utf-8">
    <meta content="initial-scale=1, minimum-scale=1, width=device-width" name="viewport">

    <!-- https://developers.google.com/webmasters/ajax-crawling/docs/specification -->
    <meta name="fragment" content="!">
    <title>Google Code Archive - Long-term storage for Google Code Project Hosting.</title>

    <link rel="icon" type="image/vnd.microsoft.icon" href="/archive/img/project-hosting.ico">
    <script src="//www.google.com/js/google.js"></script>
    <link href="//www.google.com/css/maia.css" rel="stylesheet">
    <link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,600,700&amp;lang=en" rel="stylesheet">
    <link rel="stylesheet" href="/archive/archive_css.css">
    <script>
      CLOSURE_NO_DEPS = true;
    </script>
    <script src="/archive/angular.js"></script><style type="text/css">@charset "UTF-8";

[ng\:cloak], [ng-cloak], [data-ng-cloak], [x-ng-cloak],
.ng-cloak, .x-ng-cloak,
.ng-hide:not(.ng-hide-animate) {
  display: none !important;
}

ng\:form {
  display: block;
}

.ng-animate-shim {
  visibility:hidden;
}

.ng-anchor {
  position:absolute;
}
</style>
    <script src="/archive/pagedown.js"></script>
    <script src="/archive/archive.js"></script>
    <base href="/archive/">
  </head>

  <body>
    <div class="maia-header" id="maia-header" role="banner">
      <div class="maia-aux">
        <a href="/archive/">
          </a><h1><a href="/archive/">
            <img alt="Google" src="//www.google.com/images/branding/googlelogo/1x/googlelogo_color_116x41dp.png"> Code</a>
          </h1>
        
        <a href="/archive/">
          <h2>Archive</h2>
        </a>
        <a class="maia-teleport" href="#content">Skip to content</a>
        <div class="maia-util">
          <form action="/archive/search" class="maia-search ng-pristine ng-valid">
            <input name="q" placeholder="Search this site" type="text">
            <button class="maia-button">
              <span class="maia-search-icon">Search</span>
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- ngView: --><div ng-view="" class="ng-scope"><div ng-controller="ProjectIssueCtrl as issueCtrl" class="ng-scope">
<nav-bar-widget nav-level-1="projectCtrl.navLevel1" class="ng-isolate-scope"><div class="maia-nav maia-complex" id="maia-nav-x" role="navigation">
  <div class="maia-aux">
    <ul>
      <li ng-class="{active: navLevel1 == 'projects'}">
        <a href="/archive/">Projects</a>
        <!-- ngIf: navLevel2 -->
      </li>
      <li ng-class="{active: navLevel1 == 'search'}">
        <a href="/archive/search">Search</a>
      </li>
      <li ng-class="{active: navLevel1 == 'about'}">
        <a href="/archive/about">About</a>
      </li>
    </ul>
  </div>
</div>
</nav-bar-widget>
<div id="maia-main" role="main">

  <!-- ngIf: issueCtrl.notFound -->

  <div ng-hide="issueCtrl.notFound">
    <!-- Left-side resource nav -->
    <project-resources-widget domain="issueCtrl.domain" project="issueCtrl.projectName" class="ng-isolate-scope"><div class="maia-nav" id="maia-nav-y" role="navigation">
  <!-- ngIf: domain == 'code.google.com' --><ul ng-if="domain == 'code.google.com'" class="ng-scope">
    <li class="active">
      <a href="/archive/p/csipsimple/">Project</a>
    </li>
    <li>
      <a href="/archive/p/csipsimple/source">Source</a>
    </li>
    <li>
      <a href="/archive/p/csipsimple/issues">Issues</a>
    </li>
    <li>
      <a href="/archive/p/csipsimple/wikis">Wikis</a>
    </li>
    <li>
      <a href="/archive/p/csipsimple/downloads">Downloads</a>
    </li>
  </ul><!-- end ngIf: domain == 'code.google.com' -->

    <!-- ngIf: domain != 'code.google.com' -->
</div></project-resources-widget>

    <div class="maia-article" role="article">
      <div class="maia-teleport" id="content"></div>
      <div class="maia-cols">
        <div id="gca-project-header" class="maia-col-10">
          <a id="gca-export-to-gh" class="maia-button" href="https://code.google.com/export-to-github/export?project=csipsimple">Export to GitHub</a>
            <img class="gca-project-logo" src="https://storage.googleapis.com/google-code-archive/v2/code.google.com/csipsimple/logo.png">
            <h1 class="ng-binding">csipsimple - issue #2404</h1>
            <p class="ng-binding">Problem with SIP-TLS over TCP only provider.</p>
        </div>

        <div class="maia-col-10">
          <hr>

        <!-- ngIf: issueCtrl.error -->

        <!-- ngIf: !issueCtrl.error --><div ng-if="!issueCtrl.error" class="ng-scope">
          <!-- Comments -->
          <div class="maia-col-8">
            <!-- ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Jun 12, 2013 by
                  <i class="ng-binding">Grumpy Bird</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p><b>What steps will reproduce the problem?</b>
1. Create an Expert account with TLS transport (both in account and global settings, transport is set to TLS, manually set proxy in form of sip:server:5061)
2. Call
3. Get 503 PJSIP_EUNSUPTRANSPORT without sending a packet</p>

<p><b>What is the expected output? What do you see instead?</b></p>

<p>Initiating a call over SIP-TLS over TCP.</p>

<p><b>What version of the product are you using? On what device / operating</b>
<b>system?</b></p>

<p>Yesterday's nightly build on Android 4.1.4.</p>

<p><b>Please provide any additional information below.</b></p>

<p>If I turn on UDP, I get a UDP packet to port 5061 when initiating call. I don't want to use UDP at all. My provider supports only SIP-TLS connections (it's based on freeswitch). Other softphones work correctly.</p>

<p>Registering and receiving calls work OK. Making a new call out does not work at all.</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #1</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Jun 12, 2013 by
                  <i class="ng-binding">Grumpy Bird</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>Also verified with csipsimple 1.0</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #2</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Jun 15, 2013 by
                  <i class="ng-binding">Quick Hippo</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>How it goes if instead of sip:server:5061 you enter sips:server:5061 in proxy field?
Some logs would be helpful to understand the problem if it doesn't help (see HowToCollectLogs wiki page).</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #3</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Jun 16, 2013 by
                  <i class="ng-binding">Grumpy Bird</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>Well, I had nothing in the proxy field, but had sips:server:5061 in registration URL field.</p>

<p>I thought that if the registrar and proxy are the same, you don't need to fill in proxy at all. I was wrong, now it works, thanks.</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #4</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Jun 16, 2013 by
                  <i class="ng-binding">Quick Hippo</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>Oh, I thought you had proxy set as you said "manually set proxy in form of sip:server:5061".</p>

<p>I think I should elaborate a little bit more why this works this way so that you understand why what you observe is logical.</p>

<p>In SIP, a lot of topologies are supported. It's possible to have all your calls going out through your sip provider or not. If you want all your call to go out from your sip provider you consider your sip provider as a "proxy".
By default for non expert it's the default : the sip provider server is both a registrar and a sip proxy. But that's actually two very different role in SIP.</p>

<p>So, what happen if you do not setup a sip proxy field for this account? The app consider you are calling <em>directly</em> the sip uri you dial. So it just take the sip uri and find the route based <em>only</em> on the sip uri. It will add something based on your sip account identity in the from because you are calling using the account but that's all it will do as the account is not configured to be a proxy.
If you call a different sip provider it's easy to understand that the packet will not go through your sip server and use a transport/socket created for the call to reach the remote part. It's a little less obvious when calling somebody on the same server but with a different transport but it's still logical :
By default a sip uri in form sip:user@domain should be reached using UDP transport. So, unless something is explicitly specified in this sip uri, when the app will resolve the route to use to send your packet it will use UDP transport (that's in SIP RFC spec). If you want to manually specify that you'd like the app to use a different transport you need to dial something like sip:user@domain;transport=TCP (if you want to use TCP) or sip:user@domain;transport=TLS (or even better if you want "end to end" sip+tls call dial sips:user@domain -- note the "sips" scheme).</p>

<p>This behavior is required to support possibilities of the SIP RFC. Sip client that doesn't allows this behavior doesn't allow all varieties of possible topology one could want.
Some other important point is that a remote could decide to change the sip route at any time and change the transport. And there is many buggy sip clients that doesn't allow that because they force the transport on an account while a sip server should be free to decide change the dialog route at different point during the sip call negotiation. Sip clients that doesn't do that correctly also lead sip server to implement very wrong things (see the debate on this issue list about sipdroid+pbxes.org+tcp for example).</p>

<p>So with all the previous point in minds, how to configure the app in expert mode if you want to force tls usage?</p>

<ul>
<li><p>1) I recommend to <em>NOT</em> disable TCP and UDP in global settings. It seems was your case as you had the "PJSIP_EUNSUPTRANSPORT" error. This one means that accordingly to your account configuration and what you are trying to dial the app should use a transport (probably udp) but that this transport is not activated/allowed. It's good for test to ensure your account conf is correct but in real world case the server could require the route to change to something different and you might have broken calls. It's better to configure the account the right way and check during call that TLS transport is used for the call (the yellow bar gives all information).</p></li>
<li><p>2) it depends on what you exactly want to do and what is supported by your server. </p>

<ul><li>If your sip server is fully supporting "sips" and that all you will call is users on this sip server that supports sips, you should configure the account so that it always dial in form "sips:....". To do so, in the expert account settings, use as default scheme "sips" instead of "sip". In this case you don't need necessarily the proxy to be set as the resolution of sips:user@your_domain will always result to send over TLS to your domain server.</li>
<li>If on your server there is people connected using sip and other using sips, you can't add a rule to always call using "sips" and you need to use the transport=TLS instead. Using that obviously do not guarantee the connection between your server and the remote side is done using TLS (it's the goal of not using sips here). To configure this way, the best solution is to setup the proxy field and have your server behaves as a sip proxy.</li>
<li>The later should also work fine if you call people on other sip domains and if your server is properly configured to proxy requests to other servers.</li>
<li>If you want to be able to reach other sip providers using your account but calling people that doesn't have sips or TLS transport allowed, and <em>without</em> going through your sip server as proxy, you will need to always specify while calling the sip address you'd like to call. This way to configure is the most complicate and requires you to specify each time you call (using the 'txt' dialer) the transport or scheme you'd like to use for this call. It's not very easy to use, but it's a valid topology.</li></ul></li>
<li><p>3) if you are concerned about encryption you should also consider enabling media encryption. As you maybe know there is 2 "plane" in sip audio calls : the control plane (used to establish the dialog and negotiate things -- it's actually SIP) and the media plane (where actual media is exchanged -- it's RTP). TLS is only for SIP. For media encryption you need SRTP or better ZRTP. ZRTP should ensure end to end encryption while SRTP could only ensure your side to server encryption (while the other side to server could depend on your server configuration).</p></li>
</ul>

<p>I hope it helps to understand why it works this way. The goal of the app in expert mode is to give direct access to very precise sip configuration and allow all possible topologies. Most other sip clients gives some settings but you don't know exactly what is behind. In CSipSimple I made the choice to give some very basic wizard for mainstream users and to still give access to an expert mode where expert can tweak and configure everything they could imagine.It can also be useful for mainstream users if they get guided by some IT guy that has better knowledge of SIP.
For now there is few mainstream wizard for sip provider that supports TLS (the OSTN does for example but they give a full tutorial to setup a server that supports everything correctly including media encryption). That's why configuration using TLS is more complicate, but usually for now it's made by geek people, and they are pleased to understand how things works behind the scenes :)</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #5</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Jun 17, 2013 by
                  <i class="ng-binding">Grumpy Bird</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>Hi,</p>

<p>thank you very much for your elaborate and very helpful answer. Should we put it into wiki for others to find it shall they need it?</p>

<p>Juraj.</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments -->
          </div>

          <!-- Sidebar with additional information -->
          <div class="maia-col-4">
            <div class="maia-aside">
              <p>Status: <code class="ng-binding">WrongConfig</code></p>
              <!-- ngIf: issueCtrl.issue.labels.length > 0 --><p ng-if="issueCtrl.issue.labels.length &gt; 0" class="ng-scope">
                Labels:
                <br>
                <!-- ngRepeat: label in issueCtrl.issue.labels track by $index --><span ng-repeat="label in issueCtrl.issue.labels track by $index" class="ng-scope">
                  <span class="gca-label ng-binding">Type-Defect</span>
                </span><!-- end ngRepeat: label in issueCtrl.issue.labels track by $index --><span ng-repeat="label in issueCtrl.issue.labels track by $index" class="ng-scope">
                  <span class="gca-label ng-binding">Priority-Medium</span>
                </span><!-- end ngRepeat: label in issueCtrl.issue.labels track by $index -->
              </p><!-- end ngIf: issueCtrl.issue.labels.length > 0 -->
            </div>
          </div>
        </div><!-- end ngIf: !issueCtrl.error -->
      </div>
    </div>

  </div>
</div>
</div></div></div>
    <noscript>
      &lt;p&gt;The Google Code Archive requires JavaScript to be enabled in your browser.&lt;/p&gt;
    </noscript>

    <div id="maia-signature"></div>
    <div class="maia-footer" id="maia-footer">
      <div id="maia-footer-local">
      </div>
      <div id="maia-footer-global">
        <div class="maia-aux">
          <ul>
            <li>
              <a href="//www.google.com/">Google</a>
            </li>
            <li>
              <a href="//www.google.com/intl/en/about/">About Google</a>
            </li>
            <li>
              <a href="//www.google.com/intl/en/policies/privacy/">Privacy</a>
            </li>
            <li>
              <a href="//www.google.com/intl/en/policies/terms/">Terms</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <script src="//www.google.com/js/maia.js"></script>
  


</body></html>