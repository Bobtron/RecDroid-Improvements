https://code.google.com/archive/p/csipsimple/issues/300<!DOCTYPE html><html class="google ng-scope" lang="en" ng-app="codesiteArchive.application"><head>
    <meta charset="utf-8">
    <meta content="initial-scale=1, minimum-scale=1, width=device-width" name="viewport">

    <!-- https://developers.google.com/webmasters/ajax-crawling/docs/specification -->
    <meta name="fragment" content="!">
    <title>Google Code Archive - Long-term storage for Google Code Project Hosting.</title>

    <link rel="icon" type="image/vnd.microsoft.icon" href="/archive/img/project-hosting.ico">
    <script src="//www.google.com/js/google.js"></script>
    <link href="//www.google.com/css/maia.css" rel="stylesheet">
    <link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,600,700&amp;lang=en" rel="stylesheet">
    <link rel="stylesheet" href="/archive/archive_css.css">
    <script>
      CLOSURE_NO_DEPS = true;
    </script>
    <script src="/archive/angular.js"></script><style type="text/css">@charset "UTF-8";

[ng\:cloak], [ng-cloak], [data-ng-cloak], [x-ng-cloak],
.ng-cloak, .x-ng-cloak,
.ng-hide:not(.ng-hide-animate) {
  display: none !important;
}

ng\:form {
  display: block;
}

.ng-animate-shim {
  visibility:hidden;
}

.ng-anchor {
  position:absolute;
}
</style>
    <script src="/archive/pagedown.js"></script>
    <script src="/archive/archive.js"></script>
    <base href="/archive/">
  </head>

  <body>
    <div class="maia-header" id="maia-header" role="banner">
      <div class="maia-aux">
        <a href="/archive/">
          </a><h1><a href="/archive/">
            <img alt="Google" src="//www.google.com/images/branding/googlelogo/1x/googlelogo_color_116x41dp.png"> Code</a>
          </h1>
        
        <a href="/archive/">
          <h2>Archive</h2>
        </a>
        <a class="maia-teleport" href="#content">Skip to content</a>
        <div class="maia-util">
          <form action="/archive/search" class="maia-search ng-pristine ng-valid">
            <input name="q" placeholder="Search this site" type="text">
            <button class="maia-button">
              <span class="maia-search-icon">Search</span>
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- ngView: --><div ng-view="" class="ng-scope"><div ng-controller="ProjectIssueCtrl as issueCtrl" class="ng-scope">
<nav-bar-widget nav-level-1="projectCtrl.navLevel1" class="ng-isolate-scope"><div class="maia-nav maia-complex" id="maia-nav-x" role="navigation">
  <div class="maia-aux">
    <ul>
      <li ng-class="{active: navLevel1 == 'projects'}">
        <a href="/archive/">Projects</a>
        <!-- ngIf: navLevel2 -->
      </li>
      <li ng-class="{active: navLevel1 == 'search'}">
        <a href="/archive/search">Search</a>
      </li>
      <li ng-class="{active: navLevel1 == 'about'}">
        <a href="/archive/about">About</a>
      </li>
    </ul>
  </div>
</div>
</nav-bar-widget>
<div id="maia-main" role="main">

  <!-- ngIf: issueCtrl.notFound -->

  <div ng-hide="issueCtrl.notFound">
    <!-- Left-side resource nav -->
    <project-resources-widget domain="issueCtrl.domain" project="issueCtrl.projectName" class="ng-isolate-scope"><div class="maia-nav" id="maia-nav-y" role="navigation">
  <!-- ngIf: domain == 'code.google.com' --><ul ng-if="domain == 'code.google.com'" class="ng-scope">
    <li class="active">
      <a href="/archive/p/csipsimple/">Project</a>
    </li>
    <li>
      <a href="/archive/p/csipsimple/source">Source</a>
    </li>
    <li>
      <a href="/archive/p/csipsimple/issues">Issues</a>
    </li>
    <li>
      <a href="/archive/p/csipsimple/wikis">Wikis</a>
    </li>
    <li>
      <a href="/archive/p/csipsimple/downloads">Downloads</a>
    </li>
  </ul><!-- end ngIf: domain == 'code.google.com' -->

    <!-- ngIf: domain != 'code.google.com' -->
</div></project-resources-widget>

    <div class="maia-article" role="article">
      <div class="maia-teleport" id="content"></div>
      <div class="maia-cols">
        <div id="gca-project-header" class="maia-col-10">
          <a id="gca-export-to-gh" class="maia-button" href="https://code.google.com/export-to-github/export?project=csipsimple">Export to GitHub</a>
            <img class="gca-project-logo" src="https://storage.googleapis.com/google-code-archive/v2/code.google.com/csipsimple/logo.png">
            <h1 class="ng-binding">csipsimple - issue #300</h1>
            <p class="ng-binding">Initial Register Repeating Twice</p>
        </div>

        <div class="maia-col-10">
          <hr>

        <!-- ngIf: issueCtrl.error -->

        <!-- ngIf: !issueCtrl.error --><div ng-if="!issueCtrl.error" class="ng-scope">
          <!-- Comments -->
          <div class="maia-col-8">
            <!-- ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Oct 23, 2010 by
                  <i class="ng-binding">Swift Monkey</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p><b>What steps will reproduce the problem?</b>
1. Set up an account with Sipsorcery.</p>

<p><b>What is the expected output? What do you see instead?</b>
The account shows registered in CSipSimple but it shows unregistered in Sipsorcery.</p>

<p>This only happens with the initial registration. Subsequent registration renewals work fine and Sipsorcery will show the account as registered. </p>

<p>The SIP trace shows that CSipSimple repeats the Register process twice during the initial registration. The immediate second Register process is probably the cause that deregisters the first registration. However, Sipsorcery does OK the immediate second Register, but for some reason, it deregisters the client.</p>

<p>Subsequent registration renewals only do the Register process once for each renewal. So the account registers fine in subsequent registrations.</p>

<p>Test was done with CSipSimple version 0.00-15.</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #1</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Oct 23, 2010 by
                  <i class="ng-binding">Quick Hippo</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>CSipSimple relies on pjsip sip stack.
Pjsip guys implemented something cool to solve NAT + port changes without STUN. However it implies that the app register a first time and then deduce from the registration result a correct public IP and re-register.</p>

<p>That's why you see two 2 registrations. 
However, should be fine with the server : it first register, then unregister and then register again... unless the sip server doesn't behaves as it should regarding registrations it should register the last registration (all the more so as if you get the registration icon, it means that registration is acknoledge our last registration).</p>

<p>What you could try is to activate STUN (in settings &gt; media &gt; Enable STUN).
Not sure that it will solve the problem since it could still re-register if port change is needed, but it can help.</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #2</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Oct 23, 2010 by
                  <i class="ng-binding">Swift Monkey</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>Yes, the duplicate registrations should work fine because Sipsorcery OK'ed the second registration. I posted the issue on Sipsorcery forum before I posted here just in case. </p>

<p>However, you described the process as register, unregister, register. While from the SIP traceï¼ŒI did not notice the unregister process. More specifically, it was like this: </p>

<p>Register(expires 300), Unauthorized, Register(expires 300), OK, Register(expires 300), Unauthorized, Register(expires 300), OK.</p>

<p>The STUN option does not seem to affect the behavior and result of Register.</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #3</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Oct 23, 2010 by
                  <i class="ng-binding">Swift Monkey</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>Aaron @Sipsorcery has identified the bug. The second Register process sends the registration with "expires=0" in the Contact header which overrules the "Expires" header, and that effectively unregisters the client. But there isn't a third Register process to register the client again until it is the time for the next registration renewal. </p>

<p>Please take a look of the following thread,
<a href="http://forum.sipsorcery.com/viewtopic.php?f=6&amp;t=2897&amp;p=17305">http://forum.sipsorcery.com/viewtopic.php?f=6&amp;t=2897&amp;p=17305</a></p>

<p>Now the question is, the third Register process is missing, is it missing from CSipSimple or for some reason Sipsorcery does not receive it?</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #4</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Oct 23, 2010 by
                  <i class="ng-binding">Quick Hippo</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>Indeed at the end of the traces you sent csipsimple should send a last updated register.
Could you try to produce logs in csipsimple?
See how to collect logs wiki page.
With these logs we'll see the device point of view.</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #5</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Oct 23, 2010 by
                  <i class="ng-binding">Swift Monkey</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>The log shows the third Register was not sent out. See the last line stating the registration was successful. It follows immediately after the second Register (expires=0). </p>

<p>======Log===============================
10-24 02:38:04.441 D/libpjsip(28477):  02:38:04.450    pjsua_acc.c  Account xxxxxxxx  added with id 0
10-24 02:38:04.451 V/libpjsip(28477):  02:38:04.451       endpoint  Request msg REGISTER/cseq=25098 (tdta0x81fec0) created.
10-24 02:38:04.451 V/libpjsip(28477):  02:38:04.451    tsx0x611c0c  Transaction created for Request msg REGISTER/cseq=25099 (tdta0x81fec0)
10-24 02:38:04.451 V/libpjsip(28477):  02:38:04.452    tsx0x611c0c  Sending Request msg REGISTER/cseq=25099 (tdta0x81fec0) in state Null
10-24 02:38:04.451 V/libpjsip(28477):  02:38:04.452  sip_resolve.c  DNS resolver not available, target 'sipsorcery.com:0' type=TCP will be resolved with getaddrinfo()
10-24 02:38:04.741 V/libpjsip(28477):  02:38:04.746  sip_resolve.c  Target 'sipsorcery.com:0' type=TCP resolved to '69.59.142.213:5060' type=TCP (TCP transport)
10-24 02:38:04.741 D/libpjsip(28477):  02:38:04.746   pjsua_core.c  TX 604 bytes Request msg REGISTER/cseq=25099 (tdta0x81fec0) to tcp 69.59.142.213:5060:
10-24 02:38:04.741 D/libpjsip(28477): REGISTER sip:sipsorcery.com;transport=tcp SIP/2.0
10-24 02:38:04.741 D/libpjsip(28477): Via: SIP/2.0/TCP xx.xx.xx.xx:43602;rport;branch=z9hG4bKPjY0POr-9pxT1kDv7C3EbtE3iK4KoKpeCv
10-24 02:38:04.741 D/libpjsip(28477): Max-Forwards: 70
10-24 02:38:04.741 D/libpjsip(28477): From: "xxxxxxxx" ;tag=VIsRKR9MUVBqDkZCIa7VtzRTwidc8YdF
10-24 02:38:04.741 D/libpjsip(28477): To: "xxxxxxxx" 
10-24 02:38:04.741 D/libpjsip(28477): Call-ID: QDGulhRgvkOfmTiQqsLUjbWeaZ.Ms9Qx
10-24 02:38:04.741 D/libpjsip(28477): CSeq: 25099 REGISTER
10-24 02:38:04.741 D/libpjsip(28477): User-Agent: CSipSimple
10-24 02:38:04.741 D/libpjsip(28477): Contact: "xxxxxxxx" 
10-24 02:38:04.741 D/libpjsip(28477): Expires: 3600
10-24 02:38:04.741 D/libpjsip(28477): Allow: PRACK, INVITE, ACK, BYE, CANCEL, UPDATE, SUBSCRIBE, NOTIFY, REFER, MESSAGE, OPTIONS
10-24 02:38:04.741 D/libpjsip(28477): Content-Length:  0
10-24 02:38:04.741 D/libpjsip(28477): 
10-24 02:38:04.741 D/libpjsip(28477): 
10-24 02:38:04.741 D/libpjsip(28477): --end msg--
10-24 02:38:04.741 V/libpjsip(28477):  02:38:04.747    tsx0x611c0c  State changed from Null to Calling, event=TX_MSG
10-24 02:38:04.741 I/libpjsip(28477):  02:38:04.748    pjsua_acc.c  Registration sent
10-24 02:38:04.751 D/Dialer  (28477): Update chooser choice
10-24 02:38:04.841 D/SIP AccountList(28477): &gt; Need to update list !
10-24 02:38:05.253 V/libpjsip(28477):  02:38:05.258 sip_endpoint.c  Processing incoming message: Response msg 401/REGISTER/cseq=25099 (rdata0x46c3e4)
10-24 02:38:05.253 D/libpjsip(28477):  02:38:05.258   pjsua_core.c  RX 543 bytes Response msg 401/REGISTER/cseq=25099 (rdata0x46c3e4) from tcp 69.59.142.213:5060:
10-24 02:38:05.253 D/libpjsip(28477): SIP/2.0 401 Unauthorised
10-24 02:38:05.253 D/libpjsip(28477): Via: SIP/2.0/TCP xx.xx.xx.xx:43602;rport=43602;branch=z9hG4bKPjY0POr-9pxT1kDv7C3EbtE3iK4KoKpeCv;received=xx.xx.xx.xx
10-24 02:38:05.253 D/libpjsip(28477): To: "xxxxxxxx" 
10-24 02:38:05.253 D/libpjsip(28477): From: "xxxxxxxx" ;tag=VIsRKR9MUVBqDkZCIa7VtzRTwidc8YdF
10-24 02:38:05.253 D/libpjsip(28477): Call-ID: QDGulhRgvkOfmTiQqsLUjbWeaZ.Ms9Qx
10-24 02:38:05.253 D/libpjsip(28477): CSeq: 25099 REGISTER
10-24 02:38:05.253 D/libpjsip(28477): WWW-Authenticate: Digest realm="sipsorcery.com",nonce="20307226251063734110"
10-24 02:38:05.253 D/libpjsip(28477): Content-Length: 0
10-24 02:38:05.253 D/libpjsip(28477): Allow: ACK, BYE, CANCEL, INFO, INVITE, NOTIFY, OPTIONS, REFER, REGISTER, SUBSCRIBE
10-24 02:38:05.253 D/libpjsip(28477): 
10-24 02:38:05.253 D/libpjsip(28477): 
10-24 02:38:05.253 D/libpjsip(28477): --end msg--
10-24 02:38:05.253 V/libpjsip(28477):  02:38:05.258    tsx0x611c0c  Incoming Response msg 401/REGISTER/cseq=25099 (rdata0x46c3e4) in state Calling
10-24 02:38:05.253 V/libpjsip(28477):  02:38:05.259    tsx0x611c0c  State changed from Calling to Completed, event=RX_MSG
10-24 02:38:05.253 V/libpjsip(28477):  02:38:05.259    tsx0x5780fc  Transaction created for Request msg REGISTER/cseq=25100 (tdta0x81fec0)
10-24 02:38:05.253 V/libpjsip(28477):  02:38:05.259    tsx0x5780fc  Sending Request msg REGISTER/cseq=25100 (tdta0x81fec0) in state Null
10-24 02:38:05.253 V/libpjsip(28477):  02:38:05.259       endpoint  Request msg REGISTER/cseq=25100 (tdta0x81fec0): skipping target resolution because address is already set
10-24 02:38:05.253 D/libpjsip(28477):  02:38:05.259   pjsua_core.c  TX 791 bytes Request msg REGISTER/cseq=25100 (tdta0x81fec0) to tcp 69.59.142.213:5060:
10-24 02:38:05.253 D/libpjsip(28477): REGISTER sip:sipsorcery.com;transport=tcp SIP/2.0
10-24 02:38:05.253 D/libpjsip(28477): Via: SIP/2.0/TCP xx.xx.xx.xx:43602;rport;branch=z9hG4bKPj5O3yPrxEPZF0qB-9VVjugVPV2Url0BtK
10-24 02:38:05.253 D/libpjsip(28477): Max-Forwards: 70
10-24 02:38:05.253 D/libpjsip(28477): From: "xxxxxxxx" ;tag=VIsRKR9MUVBqDkZCIa7VtzRTwidc8YdF
10-24 02:38:05.253 D/libpjsip(28477): To: "xxxxxxxx" 
10-24 02:38:05.253 D/libpjsip(28477): Call-ID: QDGulhRgvkOfmTiQqsLUjbWeaZ.Ms9Qx
10-24 02:38:05.253 D/libpjsip(28477): CSeq: 25100 REGISTER
10-24 02:38:05.253 D/libpjsip(28477): User-Agent: CSipSimple
10-24 02:38:05.253 D/libpjsip(28477): Contact: "xxxxxxxx" 
10-24 02:38:05.253 D/libpjsip(28477): Expires: 3600
10-24 02:38:05.253 D/libpjsip(28477): Allow: PRACK, INVITE, ACK, BYE, CANCEL, UPDATE, SUBSCRIBE, NOTIFY, REFER, MESSAGE, OPTIONS
10-24 02:38:05.253 D/libpjsip(28477): Authorization: Digest username="xxxxxxxx", realm="sipsorcery.com", nonce="20307226251063734110", uri="sip:sipsorcery.com;transport=tcp", response="85aaa1f9816081b173dc12dc29261520"
10-24 02:38:05.253 D/libpjsip(28477): Content-Length:  0
10-24 02:38:05.253 D/libpjsip(28477): 
10-24 02:38:05.253 D/libpjsip(28477): 
10-24 02:38:05.253 D/libpjsip(28477): --end msg--
10-24 02:38:05.253 V/libpjsip(28477):  02:38:05.260    tsx0x5780fc  State changed from Null to Calling, event=TX_MSG
10-24 02:38:05.253 V/libpjsip(28477):  02:38:05.260    tsx0x611c0c  Timeout timer event
10-24 02:38:05.253 V/libpjsip(28477):  02:38:05.260    tsx0x611c0c  State changed from Completed to Terminated, event=TIMER
10-24 02:38:05.253 V/libpjsip(28477):  02:38:05.260    tsx0x611c0c  Timeout timer event
10-24 02:38:05.253 V/libpjsip(28477):  02:38:05.260    tsx0x611c0c  State changed from Terminated to Destroyed, event=TIMER
10-24 02:38:05.253 V/libpjsip(28477):  02:38:05.260    tsx0x611c0c  Transaction destroyed!
10-24 02:38:05.461 V/libpjsip(28477):  02:38:05.464 sip_endpoint.c  Processing incoming message: Response msg 200/REGISTER/cseq=25100 (rdata0x46c3e4)
10-24 02:38:05.461 D/libpjsip(28477):  02:38:05.464   pjsua_core.c  RX 527 bytes Response msg 200/REGISTER/cseq=25100 (rdata0x46c3e4) from tcp 69.59.142.213:5060:
10-24 02:38:05.461 D/libpjsip(28477): SIP/2.0 200 Ok
10-24 02:38:05.461 D/libpjsip(28477): Via: SIP/2.0/TCP xx.xx.xx.xx:43602;rport=43602;branch=z9hG4bKPj5O3yPrxEPZF0qB-9VVjugVPV2Url0BtK;received=xx.xx.xx.xx
10-24 02:38:05.461 D/libpjsip(28477): To: "xxxxxxxx" ;tag=1222246502
10-24 02:38:05.461 D/libpjsip(28477): From: "xxxxxxxx" ;tag=VIsRKR9MUVBqDkZCIa7VtzRTwidc8YdF
10-24 02:38:05.461 D/libpjsip(28477): Call-ID: QDGulhRgvkOfmTiQqsLUjbWeaZ.Ms9Qx
10-24 02:38:05.461 D/libpjsip(28477): CSeq: 25100 REGISTER
10-24 02:38:05.461 D/libpjsip(28477): Contact: ;expires=3600
10-24 02:38:05.461 D/libpjsip(28477): Date: Sun, 24 Oct 2010 06:37:51 GMT
10-24 02:38:05.461 D/libpjsip(28477): Content-Length: 0
10-24 02:38:05.461 D/libpjsip(28477): Server: www.sipsorcery.com
10-24 02:38:05.461 D/libpjsip(28477): 
10-24 02:38:05.461 D/libpjsip(28477): 
10-24 02:38:05.461 D/libpjsip(28477): --end msg--
10-24 02:38:05.461 V/libpjsip(28477):  02:38:05.465    tsx0x5780fc  Incoming Response msg 200/REGISTER/cseq=25100 (rdata0x46c3e4) in state Calling
10-24 02:38:05.461 V/libpjsip(28477):  02:38:05.465    tsx0x5780fc  State changed from Calling to Completed, event=RX_MSG
10-24 02:38:05.461 I/libpjsip(28477):  02:38:05.465    pjsua_acc.c  IP address change detected for account 0 (192.168.1.131:5060 --&gt; xx.xx.xx.xx:43602). Updating registration (using method 2)
10-24 02:38:05.461 V/libpjsip(28477):  02:38:05.466       endpoint  Request msg REGISTER/cseq=25100 (tdta0x4b24f0) created.
10-24 02:38:05.461 V/libpjsip(28477):  02:38:05.466    tsx0x45dda4  Transaction created for Request msg REGISTER/cseq=25101 (tdta0x4b24f0)
10-24 02:38:05.461 V/libpjsip(28477):  02:38:05.467    tsx0x45dda4  Sending Request msg REGISTER/cseq=25101 (tdta0x4b24f0) in state Null
10-24 02:38:05.461 V/libpjsip(28477):  02:38:05.467  sip_resolve.c  DNS resolver not available, target 'sipsorcery.com:0' type=TCP will be resolved with getaddrinfo()
10-24 02:38:05.751 V/libpjsip(28477):  02:38:05.754  sip_resolve.c  Target 'sipsorcery.com:0' type=TCP resolved to '69.59.142.213:5060' type=TCP (TCP transport)
10-24 02:38:05.751 D/libpjsip(28477):  02:38:05.754   pjsua_core.c  TX 678 bytes Request msg REGISTER/cseq=25101 (tdta0x4b24f0) to tcp 69.59.142.213:5060:
10-24 02:38:05.751 D/libpjsip(28477): REGISTER sip:sipsorcery.com;transport=tcp SIP/2.0
10-24 02:38:05.751 D/libpjsip(28477): Via: SIP/2.0/TCP xx.xx.xx.xx:43602;rport;branch=z9hG4bKPjqPc4b.6TQm.Wf1cOwW63B4Nd9fVUhXd8
10-24 02:38:05.751 D/libpjsip(28477): Max-Forwards: 70
10-24 02:38:05.751 D/libpjsip(28477): From: "xxxxxxxx" ;tag=B40XJxsmT1weNpHkCqHLWyd2qLMNFqz1
10-24 02:38:05.751 D/libpjsip(28477): To: "xxxxxxxx" 
10-24 02:38:05.751 D/libpjsip(28477): Call-ID: QDGulhRgvkOfmTiQqsLUjbWeaZ.Ms9Qx
10-24 02:38:05.751 D/libpjsip(28477): CSeq: 25101 REGISTER
10-24 02:38:05.751 D/libpjsip(28477): User-Agent: CSipSimple
10-24 02:38:05.751 D/libpjsip(28477): Contact: 
10-24 02:38:05.751 D/libpjsip(28477): Contact: "xxxxxxxx" ;expires=0
10-24 02:38:05.751 D/libpjsip(28477): Expires: 3600
10-24 02:38:05.751 D/libpjsip(28477): Allow: PRACK, INVITE, ACK, BYE, CANCEL, UPDATE, SUBSCRIBE, NOTIFY, REFER, MESSAGE, OPTIONS
10-24 02:38:05.751 D/libpjsip(28477): Content-Length:  0
10-24 02:38:05.751 D/libpjsip(28477): 
10-24 02:38:05.751 D/libpjsip(28477): 
10-24 02:38:05.751 D/libpjsip(28477): --end msg--
10-24 02:38:05.751 V/libpjsip(28477):  02:38:05.755    tsx0x45dda4  State changed from Null to Calling, event=TX_MSG
10-24 02:38:05.751 I/libpjsip(28477):  02:38:05.755    pjsua_acc.c  Registration sent
10-24 02:38:05.751 V/libpjsip(28477):  02:38:05.756    tsx0x5780fc  Timeout timer event
10-24 02:38:05.751 V/libpjsip(28477):  02:38:05.756    tsx0x5780fc  State changed from Completed to Terminated, event=TIMER
10-24 02:38:05.751 V/libpjsip(28477):  02:38:05.756    tsx0x5780fc  Timeout timer event
10-24 02:38:05.751 V/libpjsip(28477):  02:38:05.756    tsx0x5780fc  State changed from Terminated to Destroyed, event=TIMER
10-24 02:38:05.751 V/libpjsip(28477):  02:38:05.756   tdta0x81fec0  Destroying txdata Request msg REGISTER/cseq=25100 (tdta0x81fec0)
10-24 02:38:05.751 V/libpjsip(28477):  02:38:05.756    tsx0x5780fc  Transaction destroyed!
10-24 02:38:05.972 V/libpjsip(28477):  02:38:05.977 sip_endpoint.c  Processing incoming message: Response msg 401/REGISTER/cseq=25101 (rdata0x46c3e4)
10-24 02:38:05.972 D/libpjsip(28477):  02:38:05.977   pjsua_core.c  RX 543 bytes Response msg 401/REGISTER/cseq=25101 (rdata0x46c3e4) from tcp 69.59.142.213:5060:
10-24 02:38:05.972 D/libpjsip(28477): SIP/2.0 401 Unauthorised
10-24 02:38:05.972 D/libpjsip(28477): Via: SIP/2.0/TCP xx.xx.xx.xx:43602;rport=43602;branch=z9hG4bKPjqPc4b.6TQm.Wf1cOwW63B4Nd9fVUhXd8;received=xx.xx.xx.xx
10-24 02:38:05.972 D/libpjsip(28477): To: "xxxxxxxx" 
10-24 02:38:05.972 D/libpjsip(28477): From: "xxxxxxxx" ;tag=B40XJxsmT1weNpHkCqHLWyd2qLMNFqz1
10-24 02:38:05.972 D/libpjsip(28477): Call-ID: QDGulhRgvkOfmTiQqsLUjbWeaZ.Ms9Qx
10-24 02:38:05.972 D/libpjsip(28477): CSeq: 25101 REGISTER
10-24 02:38:05.972 D/libpjsip(28477): WWW-Authenticate: Digest realm="sipsorcery.com",nonce="20307226251648140053"
10-24 02:38:05.972 D/libpjsip(28477): Content-Length: 0
10-24 02:38:05.972 D/libpjsip(28477): Allow: ACK, BYE, CANCEL, INFO, INVITE, NOTIFY, OPTIONS, REFER, REGISTER, SUBSCRIBE
10-24 02:38:05.972 D/libpjsip(28477): 
10-24 02:38:05.972 D/libpjsip(28477): 
10-24 02:38:05.972 D/libpjsip(28477): --end msg--
10-24 02:38:05.972 V/libpjsip(28477):  02:38:05.977    tsx0x45dda4  Incoming Response msg 401/REGISTER/cseq=25101 (rdata0x46c3e4) in state Calling
10-24 02:38:05.972 V/libpjsip(28477):  02:38:05.977    tsx0x45dda4  State changed from Calling to Completed, event=RX_MSG
10-24 02:38:05.972 V/libpjsip(28477):  02:38:05.977    tsx0x674c8c  Transaction created for Request msg REGISTER/cseq=25102 (tdta0x4b24f0)
10-24 02:38:05.972 V/libpjsip(28477):  02:38:05.977    tsx0x674c8c  Sending Request msg REGISTER/cseq=25102 (tdta0x4b24f0) in state Null
10-24 02:38:05.972 V/libpjsip(28477):  02:38:05.978       endpoint  Request msg REGISTER/cseq=25102 (tdta0x4b24f0): skipping target resolution because address is already set
10-24 02:38:05.972 D/libpjsip(28477):  02:38:05.978   pjsua_core.c  TX 865 bytes Request msg REGISTER/cseq=25102 (tdta0x4b24f0) to tcp 69.59.142.213:5060:
10-24 02:38:05.972 D/libpjsip(28477): REGISTER sip:sipsorcery.com;transport=tcp SIP/2.0
10-24 02:38:05.972 D/libpjsip(28477): Via: SIP/2.0/TCP xx.xx.xx.xx:43602;rport;branch=z9hG4bKPji7itted.oxGtE9TjBJwT96Kb.a-jLGCt
10-24 02:38:05.972 D/libpjsip(28477): Max-Forwards: 70
10-24 02:38:05.972 D/libpjsip(28477): From: "xxxxxxxx" ;tag=B40XJxsmT1weNpHkCqHLWyd2qLMNFqz1
10-24 02:38:05.972 D/libpjsip(28477): To: "xxxxxxxx" 
10-24 02:38:05.972 D/libpjsip(28477): Call-ID: QDGulhRgvkOfmTiQqsLUjbWeaZ.Ms9Qx
10-24 02:38:05.972 D/libpjsip(28477): CSeq: 25102 REGISTER
10-24 02:38:05.972 D/libpjsip(28477): User-Agent: CSipSimple
10-24 02:38:05.972 D/libpjsip(28477): Contact: 
10-24 02:38:05.972 D/libpjsip(28477): Contact: "xxxxxxxx" ;expires=0
10-24 02:38:05.972 D/libpjsip(28477): Expires: 3600
10-24 02:38:05.972 D/libpjsip(28477): Allow: PRACK, INVITE, ACK, BYE, CANCEL, UPDATE, SUBSCRIBE, NOTIFY, REFER, MESSAGE, OPTIONS
10-24 02:38:05.972 D/libpjsip(28477): Authorization: Digest username="xxxxxxxx", realm="sipsorcery.com", nonce="20307226251648140053", uri="sip:sipsorcery.com;transport=tcp", response="426dd268e71cc9a08b554396ada594dc"
10-24 02:38:05.972 D/libpjsip(28477): Content-Length:  0
10-24 02:38:05.972 D/libpjsip(28477): 
10-24 02:38:05.972 D/libpjsip(28477): 
10-24 02:38:05.972 D/libpjsip(28477): --end msg--
10-24 02:38:05.972 V/libpjsip(28477):  02:38:05.979    tsx0x674c8c  State changed from Null to Calling, event=TX_MSG
10-24 02:38:05.972 V/libpjsip(28477):  02:38:05.979    tsx0x45dda4  Timeout timer event
10-24 02:38:05.972 V/libpjsip(28477):  02:38:05.979    tsx0x45dda4  State changed from Completed to Terminated, event=TIMER
10-24 02:38:05.972 V/libpjsip(28477):  02:38:05.979    tsx0x45dda4  Timeout timer event
10-24 02:38:05.972 V/libpjsip(28477):  02:38:05.979    tsx0x45dda4  State changed from Terminated to Destroyed, event=TIMER
10-24 02:38:05.972 V/libpjsip(28477):  02:38:05.979    tsx0x45dda4  Transaction destroyed!
10-24 02:38:06.181 V/libpjsip(28477):  02:38:06.183 sip_endpoint.c  Processing incoming message: Response msg 200/REGISTER/cseq=25102 (rdata0x46c3e4)
10-24 02:38:06.181 D/libpjsip(28477):  02:38:06.184   pjsua_core.c  RX 451 bytes Response msg 200/REGISTER/cseq=25102 (rdata0x46c3e4) from tcp 69.59.142.213:5060:
10-24 02:38:06.181 D/libpjsip(28477): SIP/2.0 200 Ok
10-24 02:38:06.181 D/libpjsip(28477): Via: SIP/2.0/TCP xx.xx.xx.xx:43602;rport=43602;branch=z9hG4bKPji7itted.oxGtE9TjBJwT96Kb.a-jLGCt;received=xx.xx.xx.xx
10-24 02:38:06.181 D/libpjsip(28477): To: "xxxxxxxx" ;tag=1719811563
10-24 02:38:06.181 D/libpjsip(28477): From: "xxxxxxxx" ;tag=B40XJxsmT1weNpHkCqHLWyd2qLMNFqz1
10-24 02:38:06.181 D/libpjsip(28477): Call-ID: QDGulhRgvkOfmTiQqsLUjbWeaZ.Ms9Qx
10-24 02:38:06.181 D/libpjsip(28477): CSeq: 25102 REGISTER
10-24 02:38:06.181 D/libpjsip(28477): Date: Sun, 24 Oct 2010 06:37:51 GMT
10-24 02:38:06.181 D/libpjsip(28477): Content-Length: 0
10-24 02:38:06.181 D/libpjsip(28477): Server: www.sipsorcery.com
10-24 02:38:06.181 D/libpjsip(28477): 
10-24 02:38:06.181 D/libpjsip(28477): 
10-24 02:38:06.181 D/libpjsip(28477): --end msg--
10-24 02:38:06.181 V/libpjsip(28477):  02:38:06.184    tsx0x674c8c  Incoming Response msg 200/REGISTER/cseq=25102 (rdata0x46c3e4) in state Calling
10-24 02:38:06.181 V/libpjsip(28477):  02:38:06.184    tsx0x674c8c  State changed from Calling to Completed, event=RX_MSG
10-24 02:38:06.181 I/libpjsip(28477):  02:38:06.184    pjsua_acc.c  xxxxxxxx : registration success, status=200 (Ok), will re-register in 3600 seconds
=====End of Log========================</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #6</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Oct 24, 2010 by
                  <i class="ng-binding">Quick Hippo</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>The last register is not an Expires 0... It's :
Contact: 
Contact: "xxxxxxxx" ;expires=0
Expires: 3600</p>

<p>Expires is 3600 =&gt; it also update the expires of latest local register to 0... But actually it is 3600 ! it applies for the contact  (the first contact in the list).</p>

<p>This one is not present in the trace you posted on sipsorcery forum.</p>

<p>Why this last one is not transmitted to the server... that's the question.</p>

<p>Or more likely it's the first contact header that is eaten by the server. I'm not a SIP specialist (all sip stuff are done by pjsip guys), 
but I think that as in HTTP mutiple header fields with the same name should be allowed by the server.
So here if what you get on sip sorcery traces :
Contact: "xxxxxxxx" ;expires=0
Max-Forwards: 69
User-Agent: CSipSimple
Expires: 300</p>

<p>Correspond to what I send :
Contact: 
Contact: "xxxxxxxx" ;expires=0
Expires: 3600</p>

<p>There is a missing contact header that does the difference ! </p>

<p>(Thanks to your logs I've understood a bug open times ago but that is absolutely not related ;) -- about callerID ;) ).</p>

<p>I've tested with an OpenSIP server and it works properly with 2 contact header field. </p>

<p>Last question, (just for my information), I guess you are using Advanced or Expert account. Are you using SIP Proxy field or Force contact field? (Well force contact should solve your problem.. but will implies you already know your public IP... so not a good solution).</p>

<p>Just if you could do a test having a look at the same time to sipsorcery and csipsimple logs, checking CSeq ids to check that the last REGISTER sent has its first contact eaten by sipsorcery server... I think that it should be reported to sip sorcery guys. If they say that's not a standard way (not accepted by RFC) to send contact field I'll report back to pjsip guys to ask them why they are doing something not written in RFC.
SipSorcery guys maybe only manage comma separated contact field, but my understand of the RFC is that this <em>is</em> the exception while expanded 2 contact entries is normal.... but I can misunderstood, again I'm not a sip specialist and I've just waking up ;) .
<em>If I'm right</em>, they should really consider making their server support multiple fields entries with same names, else their server doesn't respect SIP RFC.</p>

<p>Keep me in touch.
(I reopen the bug in case it's in pjsip side that there is something wrong or something I can do on my side to provide an option for making it comma separated).</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #7</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Oct 24, 2010 by
                  <i class="ng-binding">Swift Monkey</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>You have a very good point. I did new trace logs on both sides of CSipSimple and Sipsorcery, and verified that Sipsorcery does eat the first Contact header of the two in the second Register. I will report the issue to Sipsorcery. Aaron should be able to fix the issue or give a good explanation if his implementation is more "standard". </p>

<p>I did not use the SIP Proxy field unless the provider requires it. I did not use the Force contact either because the IP of the wireless data is dynamic. I'll keep you updated.</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #8</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Oct 31, 2010 by
                  <i class="ng-binding">Quick Hippo</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>@jack : Aaron has updated the sipsorcery software. Could you try to see if it's better now?</p>

<p>Let us know (here or on sipsorcery forum, I've created a forum account to be able to talk directly to sipsorcery support if needed ;) ).</p>

<p>Thx a lot for reporting that point.</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #9</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Oct 31, 2010 by
                  <i class="ng-binding">Swift Monkey</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>I just tried it and took a look at the SIP trace. I can confirm it has been fixed. Thanks for pursuing on the issue and the great job done @CSipSimple.</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments -->
          </div>

          <!-- Sidebar with additional information -->
          <div class="maia-col-4">
            <div class="maia-aside">
              <p>Status: <code class="ng-binding">Fixed</code></p>
              <!-- ngIf: issueCtrl.issue.labels.length > 0 --><p ng-if="issueCtrl.issue.labels.length &gt; 0" class="ng-scope">
                Labels:
                <br>
                <!-- ngRepeat: label in issueCtrl.issue.labels track by $index --><span ng-repeat="label in issueCtrl.issue.labels track by $index" class="ng-scope">
                  <span class="gca-label ng-binding">Type-Defect</span>
                </span><!-- end ngRepeat: label in issueCtrl.issue.labels track by $index --><span ng-repeat="label in issueCtrl.issue.labels track by $index" class="ng-scope">
                  <span class="gca-label ng-binding">Priority-Medium</span>
                </span><!-- end ngRepeat: label in issueCtrl.issue.labels track by $index -->
              </p><!-- end ngIf: issueCtrl.issue.labels.length > 0 -->
            </div>
          </div>
        </div><!-- end ngIf: !issueCtrl.error -->
      </div>
    </div>

  </div>
</div>
</div></div></div>
    <noscript>
      &lt;p&gt;The Google Code Archive requires JavaScript to be enabled in your browser.&lt;/p&gt;
    </noscript>

    <div id="maia-signature"></div>
    <div class="maia-footer" id="maia-footer">
      <div id="maia-footer-local">
      </div>
      <div id="maia-footer-global">
        <div class="maia-aux">
          <ul>
            <li>
              <a href="//www.google.com/">Google</a>
            </li>
            <li>
              <a href="//www.google.com/intl/en/about/">About Google</a>
            </li>
            <li>
              <a href="//www.google.com/intl/en/policies/privacy/">Privacy</a>
            </li>
            <li>
              <a href="//www.google.com/intl/en/policies/terms/">Terms</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <script src="//www.google.com/js/maia.js"></script>
  


</body></html>