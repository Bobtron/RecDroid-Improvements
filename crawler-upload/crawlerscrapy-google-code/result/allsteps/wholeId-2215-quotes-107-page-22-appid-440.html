https://code.google.com/archive/p/csipsimple/issues/2638<!DOCTYPE html><html class="google ng-scope" lang="en" ng-app="codesiteArchive.application"><head>
    <meta charset="utf-8">
    <meta content="initial-scale=1, minimum-scale=1, width=device-width" name="viewport">

    <!-- https://developers.google.com/webmasters/ajax-crawling/docs/specification -->
    <meta name="fragment" content="!">
    <title>Google Code Archive - Long-term storage for Google Code Project Hosting.</title>

    <link rel="icon" type="image/vnd.microsoft.icon" href="/archive/img/project-hosting.ico">
    <script src="//www.google.com/js/google.js"></script>
    <link href="//www.google.com/css/maia.css" rel="stylesheet">
    <link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,600,700&amp;lang=en" rel="stylesheet">
    <link rel="stylesheet" href="/archive/archive_css.css">
    <script>
      CLOSURE_NO_DEPS = true;
    </script>
    <script src="/archive/angular.js"></script><style type="text/css">@charset "UTF-8";

[ng\:cloak], [ng-cloak], [data-ng-cloak], [x-ng-cloak],
.ng-cloak, .x-ng-cloak,
.ng-hide:not(.ng-hide-animate) {
  display: none !important;
}

ng\:form {
  display: block;
}

.ng-animate-shim {
  visibility:hidden;
}

.ng-anchor {
  position:absolute;
}
</style>
    <script src="/archive/pagedown.js"></script>
    <script src="/archive/archive.js"></script>
    <base href="/archive/">
  </head>

  <body>
    <div class="maia-header" id="maia-header" role="banner">
      <div class="maia-aux">
        <a href="/archive/">
          </a><h1><a href="/archive/">
            <img alt="Google" src="//www.google.com/images/branding/googlelogo/1x/googlelogo_color_116x41dp.png"> Code</a>
          </h1>
        
        <a href="/archive/">
          <h2>Archive</h2>
        </a>
        <a class="maia-teleport" href="#content">Skip to content</a>
        <div class="maia-util">
          <form action="/archive/search" class="maia-search ng-pristine ng-valid">
            <input name="q" placeholder="Search this site" type="text">
            <button class="maia-button">
              <span class="maia-search-icon">Search</span>
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- ngView: --><div ng-view="" class="ng-scope"><div ng-controller="ProjectIssueCtrl as issueCtrl" class="ng-scope">
<nav-bar-widget nav-level-1="projectCtrl.navLevel1" class="ng-isolate-scope"><div class="maia-nav maia-complex" id="maia-nav-x" role="navigation">
  <div class="maia-aux">
    <ul>
      <li ng-class="{active: navLevel1 == 'projects'}">
        <a href="/archive/">Projects</a>
        <!-- ngIf: navLevel2 -->
      </li>
      <li ng-class="{active: navLevel1 == 'search'}">
        <a href="/archive/search">Search</a>
      </li>
      <li ng-class="{active: navLevel1 == 'about'}">
        <a href="/archive/about">About</a>
      </li>
    </ul>
  </div>
</div>
</nav-bar-widget>
<div id="maia-main" role="main">

  <!-- ngIf: issueCtrl.notFound -->

  <div ng-hide="issueCtrl.notFound">
    <!-- Left-side resource nav -->
    <project-resources-widget domain="issueCtrl.domain" project="issueCtrl.projectName" class="ng-isolate-scope"><div class="maia-nav" id="maia-nav-y" role="navigation">
  <!-- ngIf: domain == 'code.google.com' --><ul ng-if="domain == 'code.google.com'" class="ng-scope">
    <li class="active">
      <a href="/archive/p/csipsimple/">Project</a>
    </li>
    <li>
      <a href="/archive/p/csipsimple/source">Source</a>
    </li>
    <li>
      <a href="/archive/p/csipsimple/issues">Issues</a>
    </li>
    <li>
      <a href="/archive/p/csipsimple/wikis">Wikis</a>
    </li>
    <li>
      <a href="/archive/p/csipsimple/downloads">Downloads</a>
    </li>
  </ul><!-- end ngIf: domain == 'code.google.com' -->

    <!-- ngIf: domain != 'code.google.com' -->
</div></project-resources-widget>

    <div class="maia-article" role="article">
      <div class="maia-teleport" id="content"></div>
      <div class="maia-cols">
        <div id="gca-project-header" class="maia-col-10">
          <a id="gca-export-to-gh" class="maia-button" href="https://code.google.com/export-to-github/export?project=csipsimple">Export to GitHub</a>
            <img class="gca-project-logo" src="https://storage.googleapis.com/google-code-archive/v2/code.google.com/csipsimple/logo.png">
            <h1 class="ng-binding">csipsimple - issue #2638</h1>
            <p class="ng-binding">DO NOT restart sip stack immediately if rfc 5626 supported by server</p>
        </div>

        <div class="maia-col-10">
          <hr>

        <!-- ngIf: issueCtrl.error -->

        <!-- ngIf: !issueCtrl.error --><div ng-if="!issueCtrl.error" class="ng-scope">
          <!-- Comments -->
          <div class="maia-col-8">
            <!-- ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Feb 5, 2014 by
                  <i class="ng-binding">Happy Lion</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p><b>What steps will reproduce the problem?</b>
1. Activate a sip account
2. Turn off wifi/3g
3. Turn on wifi/3g</p>

<p><b>What is the expected output? What do you see instead?</b>
Csipsimple should get registered as fast as possible.
But it takes a msm8960 processor 11 seconds to finish registration.</p>

<p><b>What version of the product are you using? On what device / operating</b>
<b>system?</b>
Nightly, Samsung Galaxy Victory, Android 4.1.2.</p>

<p><b>Please provide any additional information below.</b></p>

<p>It looks to be a design choice that Csipsimple restarts the sip stack upon network connected(Line 253, DynamicReceiver4.java). However, I would argue that this is not a very good choice in term of user experience: users hope to get connected as soon as possible.</p>

<p>For example, I have a tasker profile enabling wifi upon incoming call from google voice(which rings my cellphone and voip account simultaneously). My goal is to get sipsorcery registered asap so I can answer the voip call before the other party hangup or get diverted into voicemail. 11 seconds of starting csipsimple is just unacceptable for this case.</p>

<p>Maybe we do not really need to fully restart the whole stack, instead we can try to reuse a existing stack as much as possible. We can also choose to restart the stack at another time, say when network become disconnected.</p>

<p>When the network becoming connected, there are a lot of stuff going on in the android system other than csipsimple. Maybe we can even try some trick to increase our thread priority temporarily to get registered asap.</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #1</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Feb 5, 2014 by
                  <i class="ng-binding">Happy Lion</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>Below is my log file for your reference:</p>

<p>02-05 03:10:13.759 D/ConnectivityService(  745): ConnectivityChange for WIFI: CONNECTED/CONNECTED
02-05 03:10:14.450 D/DynamicReceiver( 9982): Internal receive android.net.conn.CONNECTIVITY_CHANGE
02-05 03:10:14.480 D/Prefs   ( 9982): We are valid for WIFI
02-05 03:10:14.490 D/DynamicReceiver( 9982): onConnectivityChanged(): null -&gt; WIFI
02-05 03:10:14.490 D/SIP SRV ( 9982): Stop sip stack
02-05 03:10:14.490 D/PjService( 9982): &gt;&gt; SIP STOP &lt;&lt;
02-05 03:10:14.500 D/PjService( 9982): Detroying...
02-05 03:10:14.510 D/Prefs   ( 9982): We are valid for WIFI
02-05 03:10:14.510 D/libpjsip( 9982): 03:10:14.518   pjsua_core.c !Shutting down, flags=0...
02-05 03:10:14.510 D/libpjsip( 9982): 03:10:14.518   pjsua_core.c  PJSUA state changed: RUNNING --&gt; CLOSING
02-05 03:10:14.510 D/libpjsip( 9982): 03:10:14.524   pjsua_call.c  .Hangup all calls..
02-05 03:10:14.510 D/libpjsip( 9982): 03:10:14.524   pjsua_pres.c  .Shutting down presence..
02-05 03:10:14.510 D/libpjsip( 9982): 03:10:14.526  pjsua_media.c  .Shutting down media..
02-05 03:10:14.801 D/libpjsip( 9982): 03:10:14.814  pjsua_media.c  ..Call 0: deinitializing media..
02-05 03:10:14.801 D/libpjsip( 9982): 03:10:14.814  pjsua_media.c  ..Call 1: deinitializing media..
02-05 03:10:14.801 D/libpjsip( 9982): 03:10:14.814  pjsua_media.c  ..Call 2: deinitializing media..
02-05 03:10:14.801 D/libpjsip( 9982): 03:10:14.814  pjsua_media.c  ..Call 3: deinitializing media..
02-05 03:10:14.801 D/libpjsip( 9982): 03:10:14.814    pjsua_vid.c  ..Destroying video subsystem..
02-05 03:10:14.801 D/libpjsip( 9982): 03:10:14.814    pjsua_vid.c  ...Window 0: destroying..
02-05 03:10:14.801 D/libpjsip( 9982): 03:10:14.814    pjsua_vid.c  ...Window 1: destroying..
02-05 03:10:14.801 D/libpjsip( 9982): 03:10:14.814    pjsua_vid.c  ...Window 2: destroying..
02-05 03:10:14.801 D/libpjsip( 9982): 03:10:14.814    pjsua_vid.c  ...Window 3: destroying..
02-05 03:10:14.801 D/libpjsip( 9982): 03:10:14.814    pjsua_vid.c  ...Window 4: destroying..
02-05 03:10:14.801 D/libpjsip( 9982): 03:10:14.814    pjsua_vid.c  ...Window 5: destroying..
02-05 03:10:14.801 D/libpjsip( 9982): 03:10:14.815    pjsua_vid.c  ...Window 6: destroying..
02-05 03:10:14.801 D/libpjsip( 9982): 03:10:14.815    pjsua_vid.c  ...Window 7: destroying..
02-05 03:10:14.801 D/libpjsip( 9982): 03:10:14.815    pjsua_vid.c  ...Window 8: destroying..
02-05 03:10:14.801 D/libpjsip( 9982): 03:10:14.815    pjsua_vid.c  ...Window 9: destroying..
02-05 03:10:14.801 D/libpjsip( 9982): 03:10:14.815    pjsua_vid.c  ...Window 10: destroying..
02-05 03:10:14.801 D/libpjsip( 9982): 03:10:14.815    pjsua_vid.c  ...Window 11: destroying..
02-05 03:10:14.801 D/libpjsip( 9982): 03:10:14.815    pjsua_vid.c  ...Window 12: destroying..
02-05 03:10:14.801 D/libpjsip( 9982): 03:10:14.815    pjsua_vid.c  ...Window 13: destroying..
02-05 03:10:14.801 D/libpjsip( 9982): 03:10:14.815    pjsua_vid.c  ...Window 14: destroying..
02-05 03:10:14.801 D/libpjsip( 9982): 03:10:14.815    pjsua_vid.c  ...Window 15: destroying..
02-05 03:10:14.801 D/libpjsip( 9982): 03:10:14.815   opensl_dev.c  ..OpenSL sound library shutting down..
02-05 03:10:15.571 D/Prefs   ( 9982): We are valid for WIFI
02-05 03:10:15.581 D/Device State( 9982): Try to start service if not already started
02-05 03:10:15.641 D/Prefs   ( 9982): We are valid for WIFI
02-05 03:10:15.641 D/SIP SRV ( 9982): Direct sip start
02-05 03:10:15.812 D/libpjsip( 9982): 03:10:15.823   pjsua_core.c  .Destroying...
02-05 03:10:15.812 D/libpjsip( 9982): 03:10:15.823 sip_transactio  .Stopping transaction layer module
02-05 03:10:15.812 D/libpjsip( 9982): 03:10:15.823 sip_transactio  .Stopped transaction layer module
02-05 03:10:15.812 D/libpjsip( 9982): 03:10:15.823 sip_endpoint.c  .Module "mod-unsolicited-mwi" unregistered
02-05 03:10:15.812 D/libpjsip( 9982): 03:10:15.823 sip_endpoint.c  .Module "mod-pjsua-options" unregistered
02-05 03:10:15.812 D/libpjsip( 9982): 03:10:15.823 sip_endpoint.c  .Module "mod-pjsua-im" unregistered
02-05 03:10:15.812 D/libpjsip( 9982): 03:10:15.823 sip_endpoint.c  .Module "mod-pjsua-pres" unregistered
02-05 03:10:15.812 D/libpjsip( 9982): 03:10:15.823 sip_endpoint.c  .Module "mod-pjsua" unregistered
02-05 03:10:15.812 D/libpjsip( 9982): 03:10:15.823 sip_endpoint.c  .Module "mod-stateful-util" unregistered
02-05 03:10:15.812 D/libpjsip( 9982): 03:10:15.823 sip_endpoint.c  .Module "mod-refer" unregistered
02-05 03:10:15.812 D/libpjsip( 9982): 03:10:15.823 sip_endpoint.c  .Module "mod-mwi" unregistered
02-05 03:10:15.812 D/libpjsip( 9982): 03:10:15.824 sip_endpoint.c  .Module "mod-presence" unregistered
02-05 03:10:15.812 D/libpjsip( 9982): 03:10:15.824 sip_endpoint.c  .Module "mod-evsub" unregistered
02-05 03:10:15.812 D/libpjsip( 9982): 03:10:15.824 sip_endpoint.c  .Module "mod-invite" unregistered
02-05 03:10:15.812 D/libpjsip( 9982): 03:10:15.824 sip_endpoint.c  .Module "mod-100rel" unregistered
02-05 03:10:15.812 D/libpjsip( 9982): 03:10:15.824 sip_endpoint.c  .Module "mod-ua" unregistered
02-05 03:10:15.812 D/libpjsip( 9982): 03:10:15.824 sip_transactio  .Transaction layer module destroyed
02-05 03:10:15.812 D/libpjsip( 9982): 03:10:15.824 sip_endpoint.c  .Module "mod-tsx-layer" unregistered
02-05 03:10:15.812 D/libpjsip( 9982): 03:10:15.824 sip_endpoint.c  .Module "mod-reg-tracker" unregistered
02-05 03:10:15.812 D/libpjsip( 9982): 03:10:15.824 sip_endpoint.c  .Module "mod-earlylock" unregistered
02-05 03:10:15.812 D/libpjsip( 9982): 03:10:15.824 sip_endpoint.c  .Module "mod-opus-sdp-rewriter" unregistered
02-05 03:10:15.812 D/libpjsip( 9982): 03:10:15.824 sip_endpoint.c  .Module "mod-msg-print" unregistered
02-05 03:10:15.812 D/libpjsip( 9982): 03:10:15.824 sip_endpoint.c  .Module "mod-pjsua-log" unregistered
02-05 03:10:15.812 D/libpjsip( 9982): 03:10:15.825   tcplis:34396  .SIP TCP listener destroyed
02-05 03:10:15.812 D/libpjsip( 9982): 03:10:15.825   tlslis:45075  .SIP TLS listener destroyed
02-05 03:10:15.822 D/libpjsip( 9982): 03:10:15.827 sip_endpoint.c  .Endpoint 0x40f53c3c destroyed
02-05 03:10:15.822 D/libpjsip( 9982): 03:10:15.827    stunresolve  .Pool is not released by application, releasing now
02-05 03:10:15.822 D/libpjsip( 9982): 03:10:15.827 glck0x5bf48d40  .Pool is not released by application, releasing now
02-05 03:10:15.822 D/libpjsip( 9982): 03:10:15.827    stunresolve  .Pool is not released by application, releasing now
02-05 03:10:15.822 D/libpjsip( 9982): 03:10:15.827    stunresolve  .Pool is not released by application, releasing now
02-05 03:10:15.822 D/libpjsip( 9982): 03:10:15.828   pjsua_core.c  .PJSUA state changed: CLOSING --&gt; NULL
02-05 03:10:15.822 D/libpjsip( 9982): 03:10:15.828   pjsua_core.c  .PJSUA destroyed...
02-05 03:10:15.822 I/MediaManager( 9982): Remove media manager....
02-05 03:10:15.822 D/BT8     ( 9982): Unregister BT media receiver
02-05 03:10:15.832 D/SIP SRV ( 9982): Accounts status.onChange( false)
02-05 03:10:15.832 D/SIP SRV ( 9982): Update registration state
02-05 03:10:15.832 D/SIP SRV ( 9982): Stop and unregister device receiver
02-05 03:10:15.842 D/SIP SRV ( 9982): Unregister telephony receiver
02-05 03:10:15.852 D/dalvikvm( 9982): WAIT_FOR_CONCURRENT_GC blocked 0ms
02-05 03:10:15.912 D/dalvikvm( 9982): GC_EXPLICIT freed 645K, 47% free 10484K/19523K, paused 7ms+12ms, total 63ms
02-05 03:10:16.012 D/Prefs   ( 9982): We are valid for WIFI
02-05 03:10:16.012 D/SIP SRV ( 9982): Start was asked and we should actually start now
02-05 03:10:16.012 D/SIP SRV ( 9982): Ask pjservice to start itself
02-05 03:10:16.022 D/PjService( 9982): Starting sip stack
02-05 03:10:16.973 I/PjService( 9982): Created 0
02-05 03:10:16.973 D/PjService( 9982): create ua receiver
02-05 03:10:16.973 D/SIP UA Receiver( 9982): Create async worker !!!
02-05 03:10:17.013 D/BT8     ( 9982): Register BT media receiver
02-05 03:10:17.013 D/BT8     ( 9982): &gt;&gt;&gt; BT SCO state changed !!! 
02-05 03:10:17.013 D/BT8     ( 9982): BT SCO state changed : 0 target is false
02-05 03:10:17.073 D/PjService( 9982): Attach is done to callback
02-05 03:10:17.183 D/PjService( 9982): Use OpenSL-ES implementation
02-05 03:10:17.253 D/PjService( 9982): add server 
02-05 03:10:17.393 D/libpjsip( 9982): 03:10:17.398 sip_endpoint.c  .Module "mod-pjsua-log" registered
02-05 03:10:17.393 D/libpjsip( 9982): 03:10:17.398 sip_endpoint.c  .Module "mod-tsx-layer" registered
02-05 03:10:17.393 D/libpjsip( 9982): 03:10:17.398 sip_endpoint.c  .Module "mod-stateful-util" registered
02-05 03:10:17.393 D/libpjsip( 9982): 03:10:17.399 sip_endpoint.c  .Module "mod-ua" registered
02-05 03:10:17.393 D/libpjsip( 9982): 03:10:17.399 sip_endpoint.c  .Module "mod-100rel" registered
02-05 03:10:17.393 D/libpjsip( 9982): 03:10:17.399 sip_endpoint.c  .Module "mod-pjsua" registered
02-05 03:10:17.393 D/libpjsip( 9982): 03:10:17.399 sip_endpoint.c  .Module "mod-invite" registered
02-05 03:10:17.393 D/libpjsip( 9982): 03:10:17.399   pjsua_core.c  .Trying STUN server  (1 of 1)..
02-05 03:10:18.485 D/libpjsip( 9982): 03:10:18.493   pjsua_core.c  .Error starting STUN socket for : gethostbyname() has returned error (PJ_ERESOLVE)
02-05 03:10:18.485 E/libpjsip( 9982): 03:10:18.493   pjsua_core.c  .STUN resolution failed: gethostbyname() has returned error (PJ_ERESOLVE)
02-05 03:10:18.485 W/libpjsip( 9982): 03:10:18.493   pjsua_core.c  .Ignoring STUN resolution failure (by setting)
02-05 03:10:18.495 D/libpjsip( 9982): 03:10:18.501          pjlib  ..select() I/O Queue created (0x5c124e64)
02-05 03:10:18.495 D/libpjsip( 9982): 03:10:18.501 webrtc_codec.c  ..List of supported codec.
02-05 03:10:18.495 D/libpjsip( 9982): 03:10:18.502 webrtc_codec.c  ..0 ISAC 103 16000 480 32000
02-05 03:10:18.495 D/libpjsip( 9982): 03:10:18.502 webrtc_codec.c  ..5 ILBC 102 8000 240 13300
02-05 03:10:18.495 D/libpjsip( 9982): 03:10:18.502         silk.c  ..SILK codec version 1.0.9 initialized
02-05 03:10:18.495 D/libpjsip( 9982): 03:10:18.502 sip_endpoint.c  ..Module "mod-opus-sdp-rewriter" registered
02-05 03:10:18.505 D/libpjsip( 9982): 03:10:18.508    pjsua_vid.c  ..Initializing video subsystem..
02-05 03:10:18.505 D/libpjsip( 9982): 03:10:18.508 sip_endpoint.c  .Module "mod-evsub" registered
02-05 03:10:18.505 D/libpjsip( 9982): 03:10:18.508 sip_endpoint.c  .Module "mod-presence" registered
02-05 03:10:18.505 D/libpjsip( 9982): 03:10:18.509 sip_endpoint.c  .Module "mod-mwi" registered
02-05 03:10:18.505 D/libpjsip( 9982): 03:10:18.509 sip_endpoint.c  .Module "mod-refer" registered
02-05 03:10:18.505 D/libpjsip( 9982): 03:10:18.509 sip_endpoint.c  .Module "mod-pjsua-pres" registered
02-05 03:10:18.505 D/libpjsip( 9982): 03:10:18.509 sip_endpoint.c  .Module "mod-pjsua-im" registered
02-05 03:10:18.505 D/libpjsip( 9982): 03:10:18.509 sip_endpoint.c  .Module "mod-pjsua-options" registered
02-05 03:10:18.505 D/libpjsip( 9982): 03:10:18.510   pjsua_core.c  .1 SIP worker threads created
02-05 03:10:18.505 I/libpjsip( 9982): 03:10:18.510   pjsua_core.c  .pjsua version 2.1-svn for  initialized
02-05 03:10:18.505 D/libpjsip( 9982): 03:10:18.510   pjsua_core.c  .PJSUA state changed: CREATED --&gt; INIT
02-05 03:10:18.505 D/libpjsip( 9982): 03:10:18.510   opensl_dev.c  OpenSL sound library initialized
02-05 03:10:18.505 D/libpjsip( 9982): 03:10:18.510 pjsua_jni_addo  Loaded audio dev
02-05 03:10:19.476 D/libpjsip( 9982): 03:10:19.480   pjsua_core.c  SIP UDP socket reachable at 192.168.1.3:38128
02-05 03:10:19.476 D/libpjsip( 9982): 03:10:19.480  udp0x5c02b678  SIP UDP transport started, published address is 192.168.1.3:38128
02-05 03:10:19.476 D/libpjsip( 9982): 03:10:19.480    pjsua_acc.c  Adding account: id=
02-05 03:10:19.476 D/libpjsip( 9982): 03:10:19.480    pjsua_acc.c  .Account  added with id 0
02-05 03:10:19.546 D/dalvikvm( 9982): WAIT_FOR_CONCURRENT_GC blocked 0ms
02-05 03:10:19.586 D/dalvikvm( 9982): GC_EXPLICIT freed 349K, 47% free 10453K/19523K, paused 3ms+4ms, total 38ms
02-05 03:10:20.437 D/libpjsip( 9982): 03:10:20.446   tcplis:54420  SIP TCP listener ready for incoming connections at 192.168.1.3:54420
02-05 03:10:20.437 D/libpjsip( 9982): 03:10:20.446    pjsua_acc.c  Adding account: id=
02-05 03:10:20.437 D/libpjsip( 9982): 03:10:20.446    pjsua_acc.c  .Account  added with id 1
02-05 03:10:21.428 D/libpjsip( 9982): 03:10:21.446   tlslis:57426  SIP TLS listener is ready for incoming connections at 192.168.1.3:57426
02-05 03:10:21.428 D/libpjsip( 9982): 03:10:21.446    pjsua_acc.c  Adding account: id=
02-05 03:10:21.428 D/libpjsip( 9982): 03:10:21.446    pjsua_acc.c  .Account  added with id 2
02-05 03:10:21.438 D/libpjsip( 9982): 03:10:21.452 sip_endpoint.c  Module "mod-earlylock" registered
02-05 03:10:21.438 D/libpjsip( 9982): 03:10:21.452 sip_endpoint.c  Module "mod-reg-tracker" registered
02-05 03:10:21.438 D/RegHandlerModule( 9982): Reg handler module added with status 0
02-05 03:10:21.438 D/libpjsip( 9982): 03:10:21.452   pjsua_core.c  PJSUA state changed: INIT --&gt; STARTING
02-05 03:10:21.438 E/libpjsip( 9982): 03:10:21.452  pjsua_media.c  ..NAT type detection failed: Invalid STUN server or server not configured (PJNATH_ESTUNINSERVER)
02-05 03:10:21.448 D/libpjsip( 9982): 03:10:21.457 sip_endpoint.c  .Module "mod-unsolicited-mwi" registered
02-05 03:10:21.448 D/libpjsip( 9982): 03:10:21.458   pjsua_core.c  .PJSUA state changed: STARTING --&gt; RUNNING
02-05 03:10:21.898 D/PjService( 9982): Audio codecs : PCMU/8000/1 (60) - PCMA/8000/1 (50) - ISAC/16000/1 (1) - SILK/24000/1 (220) - opus/16000/1 (1) - 
02-05 03:10:21.898 D/PjService( 9982): Video codecs : 
02-05 03:10:21.938 D/DynamicReceiver( 9982): Start monitoring of route file ? 0
02-05 03:10:21.938 D/SIP SRV ( 9982): Listen for phone state 
02-05 03:10:21.958 D/SIP SRV ( 9982): Add all accounts
02-05 03:10:21.958 D/SIP SRV ( 9982): We are adding all accounts right now....
02-05 03:10:22.008 D/PjSipAccount( 9982): Create proxy 0
02-05 03:10:22.058 D/libpjsip( 9982): 03:10:22.071    pjsua_acc.c  Adding account: id=
02-05 03:10:22.058 D/libpjsip( 9982): 03:10:22.071    pjsua_acc.c  .Account  added with id 3
02-05 03:10:22.058 D/libpjsip( 9982): 03:10:22.072    pjsua_acc.c  Acc 3: setting registration..
02-05 03:10:23.109 D/libpjsip( 9982): 03:10:23.124 tcpc0x5c045f4c  ..TCP client transport created
02-05 03:10:23.109 D/libpjsip( 9982): 03:10:23.124 tcpc0x5c045f4c  ..TCP transport 192.168.1.3:58241 is connecting to 67.222.131.147:2060...
02-05 03:10:23.109 D/libpjsip( 9982): 03:10:23.124   pjsua_core.c  ..TX 537 bytes Request msg REGISTER/cseq=32679 (tdta0x5c0446a8) to TCP 67.222.131.147:2060:
02-05 03:10:23.109 D/libpjsip( 9982): REGISTER sip:sipsorcery.com:2060;transport=tcp;lr SIP/2.0</p>

<p>02-05 03:10:23.109 D/libpjsip( 9982): v: SIP/2.0/TCP 192.168.1.3:58241;rport;branch=z9hG4bKPjXZW8dsaSUk84drjZCJsG2sKETIAcv2oU;alias</p>

<p>02-05 03:10:23.109 D/libpjsip( 9982): Max-Forwards: 70</p>

<p>02-05 03:10:23.109 D/libpjsip( 9982): f: ;tag=O1K6AquYjHh8JF.cTazHrIk-JbBhoQGk</p>

<p>02-05 03:10:23.109 D/libpjsip( 9982): t: </p>

<p>02-05 03:10:23.109 D/libpjsip( 9982): i: pWeXxRBdypUZSR6zLWVOxO.x3X2O9rK2</p>

<p>02-05 03:10:23.109 D/libpjsip( 9982): CSeq: 32679 REGISTER</p>

<p>02-05 03:10:23.109 D/libpjsip( 9982): User-Agent: CSipSimple.G729</p>

<p>02-05 03:10:23.109 D/libpjsip( 9982): m: ;+sip.ice</p>

<p>02-05 03:10:23.109 D/libpjsip( 9982): Expires: 900</p>

<p>02-05 03:10:23.109 D/libpjsip( 9982): Allow: PRACK, INVITE, ACK, BYE, CANCEL, UPDATE, INFO, SUBSCRIBE, NOTIFY, REFER, MESSAGE, OPTIONS</p>

<p>02-05 03:10:23.109 D/libpjsip( 9982): l:  0</p>

<p>02-05 03:10:23.109 D/libpjsip( 9982): </p>

<p>02-05 03:10:23.109 D/libpjsip( 9982): --end msg--
02-05 03:10:23.119 D/libpjsip( 9982): 03:10:23.128    pjsua_acc.c  .Acc 3: Registration sent
02-05 03:10:23.119 D/DBProvider( 9982): Added status_text= status_code=-1 display_name=SIPSorcery expires=0 account_id=4 added_status=0 priority=0 active=true wizard=EXPERT reg_uri=sip:sipsorcery.com:2060 pjsua_id=3
02-05 03:10:23.119 D/libpjsip( 9982): 03:10:23.135    pjsua_acc.c  Acc 3: setting online status to 1..
02-05 03:10:23.129 D/SIP SRV ( 9982): Accounts status.onChange( false)
02-05 03:10:23.129 D/SIP SRV ( 9982): Update registration state
02-05 03:10:23.190 D/Prefs   ( 9982): We are valid for WIFI
02-05 03:10:23.190 D/SIP SRV ( 9982): Start was asked and we should actually start now
02-05 03:10:23.190 D/SIP SRV ( 9982): Ask pjservice to start itself
02-05 03:10:23.190 D/dalvikvm( 9982): WAIT_FOR_CONCURRENT_GC blocked 0ms
02-05 03:10:23.190 D/libpjsip( 9982): 03:10:23.204 tcpc0x5c045f4c !TCP transport 192.168.1.3:58241 is connected to 67.222.131.147:2060
02-05 03:10:23.230 D/dalvikvm( 9982): GC_EXPLICIT freed 414K, 47% free 10478K/19523K, paused 3ms+6ms, total 45ms
02-05 03:10:23.250 D/DynamicReceiver( 9982): Internal receive android.net.conn.CONNECTIVITY_CHANGE
02-05 03:10:23.260 D/libpjsip( 9982): 03:10:23.273   pjsua_core.c  .RX 502 bytes Response msg 401/REGISTER/cseq=32679 (rdata0x5c0460fc) from TCP 67.222.131.147:2060:
02-05 03:10:23.260 D/libpjsip( 9982): SIP/2.0 401 Unauthorised</p>

<p>02-05 03:10:23.260 D/libpjsip( 9982): Via: SIP/2.0/TCP 192.168.1.3:58241;rport=58241;branch=z9hG4bKPjXZW8dsaSUk84drjZCJsG2sKETIAcv2oU;alias;received=67.173.9.164</p>

<p>02-05 03:10:23.260 D/libpjsip( 9982): To: </p>

<p>02-05 03:10:23.260 D/libpjsip( 9982): From: ;tag=O1K6AquYjHh8JF.cTazHrIk-JbBhoQGk</p>

<p>02-05 03:10:23.260 D/libpjsip( 9982): Call-ID: pWeXxRBdypUZSR6zLWVOxO.x3X2O9rK2</p>

<p>02-05 03:10:23.260 D/libpjsip( 9982): CSeq: 32679 REGISTER</p>

<p>02-05 03:10:23.260 D/libpjsip( 9982): WWW-Authenticate: Digest realm="sipsorcery.com",nonce="16432337902066415797"</p>

<p>02-05 03:10:23.260 D/libpjsip( 9982): Content-Length: 0</p>

<p>02-05 03:10:23.260 D/libpjsip( 9982): Allow: ACK, BYE, CANCEL, INFO, INVITE, NOTIFY, OPTIONS, REFER, REGISTER, SUBSCRIBE</p>

<p>02-05 03:10:23.260 D/libpjsip( 9982): </p>

<p>02-05 03:10:23.260 D/libpjsip( 9982): --end msg--
02-05 03:10:23.260 D/libpjsip( 9982): 03:10:23.274 mobile_reg_han  .mod_reg_tracker_on_rx_response
02-05 03:10:23.260 D/libpjsip( 9982): 03:10:23.274 mobile_reg_han  .mod_reg_tracker_on_rx_response done
02-05 03:10:23.270 D/PjService( 9982): Found pjsua 3 searching 3
02-05 03:10:23.270 D/RegHandlerReceiver( 9982): We restore ;+sip.ice
02-05 03:10:23.270 D/libpjsip( 9982): 03:10:23.283 mobile_reg_han  ....Hook a RX request
02-05 03:10:23.270 D/libpjsip( 9982): 03:10:23.283   pjsua_core.c  ....TX 792 bytes Request msg REGISTER/cseq=32680 (tdta0x5c0446a8) to TCP 67.222.131.147:2060:
02-05 03:10:23.270 D/libpjsip( 9982): REGISTER sip:sipsorcery.com:2060;transport=tcp;lr SIP/2.0</p>

<p>02-05 03:10:23.270 D/libpjsip( 9982): v: SIP/2.0/TCP 192.168.1.3:58241;rport;branch=z9hG4bKPjyUfdWsmEPgoAg1fmBW-2.Piks3OqgjQf;alias</p>

<p>02-05 03:10:23.270 D/libpjsip( 9982): Max-Forwards: 70</p>

<p>02-05 03:10:23.270 D/libpjsip( 9982): f: ;tag=O1K6AquYjHh8JF.cTazHrIk-JbBhoQGk</p>

<p>02-05 03:10:23.270 D/libpjsip( 9982): t: </p>

<p>02-05 03:10:23.270 D/libpjsip( 9982): i: pWeXxRBdypUZSR6zLWVOxO.x3X2O9rK2</p>

<p>02-05 03:10:23.270 D/libpjsip( 9982): CSeq: 32680 REGISTER</p>

<p>02-05 03:10:23.270 D/libpjsip( 9982): User-Agent: CSipSimple.G729</p>

<p>02-05 03:10:23.270 D/libpjsip( 9982): m: ;+sip.ice</p>

<p>02-05 03:10:23.270 D/libpjsip( 9982): Expires: 900</p>

<p>02-05 03:10:23.270 D/libpjsip( 9982): Allow: PRACK, INVITE, ACK, BYE, CANCEL, UPDATE, INFO, SUBSCRIBE, NOTIFY, REFER, MESSAGE, OPTIONS</p>

<p>02-05 03:10:23.270 D/libpjsip( 9982): Authorization: Digest username="xxxx", realm="sipsorcery.com", nonce="16432337902066415797", uri="sip:sipsorcery.com:2060;transport=tcp;lr", response="5de29825d85d4755b534bac36a945403"</p>

<p>02-05 03:10:23.270 D/libpjsip( 9982): m: ;expires=0;+sip.ice</p>

<p>02-05 03:10:23.280 D/libpjsip( 9982): l:  0</p>

<p>02-05 03:10:23.280 D/libpjsip( 9982): </p>

<p>02-05 03:10:23.280 D/libpjsip( 9982): --end msg--
02-05 03:10:23.290 D/Prefs   ( 9982): We are valid for WIFI
02-05 03:10:23.290 D/DynamicReceiver( 9982): onConnectivityChanged(): null -&gt; WIFI
02-05 03:10:23.460 D/libpjsip( 9982): 03:10:23.469   pjsua_core.c  .RX 476 bytes Response msg 200/REGISTER/cseq=32680 (rdata0x5c0460fc) from TCP 67.222.131.147:2060:
02-05 03:10:23.460 D/libpjsip( 9982): SIP/2.0 200 Ok</p>

<p>02-05 03:10:23.460 D/libpjsip( 9982): Via: SIP/2.0/TCP 192.168.1.3:58241;rport=58241;branch=z9hG4bKPjyUfdWsmEPgoAg1fmBW-2.Piks3OqgjQf;alias;received=67.173.9.164</p>

<p>02-05 03:10:23.460 D/libpjsip( 9982): To: ;tag=SGTRMDEVXE</p>

<p>02-05 03:10:23.460 D/libpjsip( 9982): From: ;tag=O1K6AquYjHh8JF.cTazHrIk-JbBhoQGk</p>

<p>02-05 03:10:23.460 D/libpjsip( 9982): Call-ID: pWeXxRBdypUZSR6zLWVOxO.x3X2O9rK2</p>

<p>02-05 03:10:23.460 D/libpjsip( 9982): CSeq: 32680 REGISTER</p>

<p>02-05 03:10:23.460 D/libpjsip( 9982): Contact: ;expires=900</p>

<p>02-05 03:10:23.460 D/libpjsip( 9982): Date: Wed, 05 Feb 2014 09:10:24 GMT</p>

<p>02-05 03:10:23.460 D/libpjsip( 9982): Content-Length: 0</p>

<p>02-05 03:10:23.460 D/libpjsip( 9982): Server: www.sipsorcery.com</p>

<p>02-05 03:10:23.460 D/libpjsip( 9982): </p>

<p>02-05 03:10:23.460 D/libpjsip( 9982): --end msg--
02-05 03:10:23.460 D/libpjsip( 9982): 03:10:23.469 mobile_reg_han  .mod_reg_tracker_on_rx_response
02-05 03:10:23.460 D/libpjsip( 9982): 03:10:23.469 mobile_reg_han  .mod_reg_tracker_on_rx_response 2
02-05 03:10:23.460 D/libpjsip( 9982): 03:10:23.469 mobile_reg_han  .Hook a REGISTER RX response !!!
02-05 03:10:23.460 D/libpjsip( 9982): 03:10:23.469 mobile_reg_han  . Hook should save contact : ;+sip.ice &gt; 900
02-05 03:10:23.660 D/PjService( 9982): Found pjsua 3 searching 3
02-05 03:10:23.680 D/libpjsip( 9982): 03:10:23.691 mobile_reg_han  .mod_reg_tracker_on_rx_response done
02-05 03:10:23.690 D/libpjsip( 9982): 03:10:23.701    pjsua_acc.c  ....SIP outbound status for acc 3 is not active
02-05 03:10:23.690 I/libpjsip( 9982): 03:10:23.701    pjsua_acc.c  ....IP address change detected for account 3 (192.168.1.3:54420 --&gt; 67.173.9.164:58241). Updating registration (using method 2)
02-05 03:10:23.690 D/libpjsip( 9982): 03:10:23.701    pjsua_acc.c  ....Acc 3: setting registration..
02-05 03:10:24.571 D/PjService( 9982): Found pjsua 3 searching 3
02-05 03:10:24.571 D/RegHandlerReceiver( 9982): We restore ;+sip.ice
02-05 03:10:24.571 D/libpjsip( 9982): 03:10:24.581 mobile_reg_han  ......The register already has old contact in it, ignore
02-05 03:10:24.571 D/libpjsip( 9982): 03:10:24.581   pjsua_core.c  ......TX 792 bytes Request msg REGISTER/cseq=32681 (tdta0x5c0493e8) to TCP 67.222.131.147:2060:
02-05 03:10:24.571 D/libpjsip( 9982): REGISTER sip:sipsorcery.com:2060;transport=tcp;lr SIP/2.0</p>

<p>02-05 03:10:24.571 D/libpjsip( 9982): v: SIP/2.0/TCP 192.168.1.3:58241;rport;branch=z9hG4bKPjyMlCfbKeLIogKi514PsXOdqLex6CxE3X;alias</p>

<p>02-05 03:10:24.571 D/libpjsip( 9982): Max-Forwards: 70</p>

<p>02-05 03:10:24.571 D/libpjsip( 9982): f: ;tag=wBJN6ReoTlSLeTX1KI0tMJoFI5202guZ</p>

<p>02-05 03:10:24.571 D/libpjsip( 9982): t: </p>

<p>02-05 03:10:24.571 D/libpjsip( 9982): i: pWeXxRBdypUZSR6zLWVOxO.x3X2O9rK2</p>

<p>02-05 03:10:24.571 D/libpjsip( 9982): CSeq: 32681 REGISTER</p>

<p>02-05 03:10:24.571 D/libpjsip( 9982): Authorization: Digest username="xxxx", realm="sipsorcery.com", nonce="16432337902066415797", uri="sip:sipsorcery.com:2060;transport=tcp;lr", response="5de29825d85d4755b534bac36a945403"</p>

<p>02-05 03:10:24.571 D/libpjsip( 9982): User-Agent: CSipSimple.G729</p>

<p>02-05 03:10:24.571 D/libpjsip( 9982): m: ;+sip.ice</p>

<p>02-05 03:10:24.571 D/libpjsip( 9982): m: ;expires=0;+sip.ice</p>

<p>02-05 03:10:24.571 D/libpjsip( 9982): Expires: 900</p>

<p>02-05 03:10:24.571 D/libpjsip( 9982): Allow: PRACK, INVITE, ACK, BYE, CANCEL, UPDATE, INFO, SUBSCRIBE, NOTIFY, REFER, MESSAGE, OPTIONS</p>

<p>02-05 03:10:24.571 D/libpjsip( 9982): l:  0</p>

<p>02-05 03:10:24.571 D/libpjsip( 9982): </p>

<p>02-05 03:10:24.571 D/libpjsip( 9982): --end msg--
02-05 03:10:24.581 D/libpjsip( 9982): 03:10:24.587    pjsua_acc.c  .....Acc 3: Registration sent
02-05 03:10:24.661 D/libpjsip( 9982): 03:10:24.672   pjsua_core.c  .RX 477 bytes Response msg 200/REGISTER/cseq=32681 (rdata0x5c0460fc) from TCP 67.222.131.147:2060:
02-05 03:10:24.661 D/libpjsip( 9982): SIP/2.0 200 Ok</p>

<p>02-05 03:10:24.661 D/libpjsip( 9982): Via: SIP/2.0/TCP 192.168.1.3:58241;rport=58241;branch=z9hG4bKPjyMlCfbKeLIogKi514PsXOdqLex6CxE3X;alias;received=67.173.9.164</p>

<p>02-05 03:10:24.661 D/libpjsip( 9982): To: ;tag=MOACJKMSBG</p>

<p>02-05 03:10:24.661 D/libpjsip( 9982): From: ;tag=wBJN6ReoTlSLeTX1KI0tMJoFI5202guZ</p>

<p>02-05 03:10:24.661 D/libpjsip( 9982): Call-ID: pWeXxRBdypUZSR6zLWVOxO.x3X2O9rK2</p>

<p>02-05 03:10:24.661 D/libpjsip( 9982): CSeq: 32681 REGISTER</p>

<p>02-05 03:10:24.661 D/libpjsip( 9982): Contact: ;expires=900</p>

<p>02-05 03:10:24.661 D/libpjsip( 9982): Date: Wed, 05 Feb 2014 09:10:25 GMT</p>

<p>02-05 03:10:24.661 D/libpjsip( 9982): Content-Length: 0</p>

<p>02-05 03:10:24.661 D/libpjsip( 9982): Server: www.sipsorcery.com</p>

<p>02-05 03:10:24.661 D/libpjsip( 9982): </p>

<p>02-05 03:10:24.661 D/libpjsip( 9982): --end msg--
02-05 03:10:24.661 D/libpjsip( 9982): 03:10:24.675 mobile_reg_han  .mod_reg_tracker_on_rx_response
02-05 03:10:24.661 D/libpjsip( 9982): 03:10:24.676 mobile_reg_han  .mod_reg_tracker_on_rx_response 2
02-05 03:10:24.661 D/libpjsip( 9982): 03:10:24.676 mobile_reg_han  .Hook a REGISTER RX response !!!
02-05 03:10:24.661 D/libpjsip( 9982): 03:10:24.676 mobile_reg_han  . Hook should save contact : ;+sip.ice &gt; 900
02-05 03:10:24.671 D/PjService( 9982): Found pjsua 3 searching 3
02-05 03:10:24.701 D/libpjsip( 9982): 03:10:24.712 mobile_reg_han  .mod_reg_tracker_on_rx_response done
02-05 03:10:24.711 D/libpjsip( 9982): 03:10:24.726    pjsua_acc.c  ....SIP outbound status for acc 3 is not active
02-05 03:10:24.711 I/libpjsip( 9982): 03:10:24.726    pjsua_acc.c  ....: registration success, status=200 (Ok), will re-register in 900 seconds
02-05 03:10:24.711 D/SIP UA Receiver( 9982): &lt; LOCK CPU
02-05 03:10:24.721 D/PjService( 9982): Found pjsua 3 searching 3
02-05 03:10:24.731 D/PjService( 9982): Update profile from service for 3 aka in db 4
02-05 03:10:24.731 D/SIP UA Receiver( 9982): &gt; UNLOCK CPU 0
02-05 03:10:24.731 D/DBProvider( 9982): Updated status_text=OK status_code=200 display_name=SIPSorcery expires=894 account_id=4 added_status=0 priority=0 active=true wizard=EXPERT reg_uri=sip:sipsorcery.com:2060 pjsua_id=3
02-05 03:10:24.741 D/PjService( 9982): Profile state UP : status_text=OK status_code=200 expires=894
02-05 03:10:24.771 D/SIP SRV ( 9982): Accounts status.onChange( false)
02-05 03:10:24.771 D/SIP SRV ( 9982): Update registration state</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #2</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Feb 5, 2014 by
                  <i class="ng-binding">Quick Hippo</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>It's a software design choice. In order to clear all state of the sip stack it's choosen to stop and restart totally the stack. It's the shorter way to do and is not so bad compared to alternative that are bug prone (<a href="http://trac.pjsip.org/repos/wiki/IPAddressChange">http://trac.pjsip.org/repos/wiki/IPAddressChange</a>). Also in android it's advised to wait a little so that the network layer is fully ready again for transport.</p>

<p>BTW, I think that this is the delay you observe, the sip stack restart does not take so many time that it should be noticeable. 
If you have a close look to logs, you'll see that it restarts in 7 seconds (10:17 to 10:24) and that half of this time is spent trying to bind local sockets and resolving network :
17 -&gt; 18 : spent to request stun server... that is unresolvable ! (what is your stun config? maybe there is a problem here, or maybe the network layer is not yet fully ready)
18 -&gt; 19 : spent to bind udp socket
19 -&gt; 20 : spent to bind tcp socket
20 -&gt; 21 : spetn to bind tls socket =&gt; do you need it, maybe you can disable this option and save 1 second?
after that time is spend in network communication (and the app receive at 10:23 a final confirmation of the fact the network layer is fully ready) (
02-05 03:10:23.290 D/DynamicReceiver( 9982): onConnectivityChanged(): null -&gt; WIFI)</p>

<p>So, compared to a solution where you have registration changed and all interface rebound as listening socket... there is no performance difference at all ! If we compare between a precise solution that would only rebind listening sockets on new interfaces + send a re-register and a solution that restarts the entire stack : the long time spent is time spent to re-bind sockets and to re-register. It's not time spent allocating pjsip stack and modules and launching them (maybe the only small thing that takes time from your logs is the codec allocation, but it's very few time compared to the rest). </p>

<p>Another point : during the time of the restart you are actually not connected to the server, and IMHO it's good to remove the csipsimple icon from notification bar during this time.</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #3</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Feb 5, 2014 by
                  <i class="ng-binding">Happy Lion</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><blockquote>
  <blockquote>
    <p>the long time spent is time spent to re-bind sockets and to re-register.</p>
  </blockquote>
</blockquote>

<p>Actually, we don't need to bind udp/tcp/tls before making network connection if RFC5626 is used. The only necessary spending in this case is from 10:22.058 to 10:23.460, if I disable the stun server totally.</p>

<p>At least we can schedule the stack-destruction task right after the NetworkOff event, without changing the current design structure too much, right?</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #4</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Feb 5, 2014 by
                  <i class="ng-binding">Quick Hippo</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>we don't need to bind udp/tcp/tls before making network connection if RFC5626 is used. </p>

<p>Yep you are right. I didn't thought about this case. Indeed if rfc5626 is supported by server with TCP or TLS there's something that could maybe done. It would not be very simple implementation however because when android tell app a network type is lost it does not tells a new one will come soon. And in case none come I would like to keep the current behavior (stack and service stopped and consuming no more CPU)
So, I change the issue state to accepted enhancement. It does not go in my personal task list however because I personnaly don't see big benefit to that + is at risk that some changes has to be made in pjsip layer + have few free time for csipsimple those days and free time will be spent on more critical problems ;). But if anyone contribute a robust solution for this, it will be welcome :)</p>

<blockquote>
  <blockquote>
    <p>At least we can schedule the stack-destruction task right after the NetworkOff event
    Mmmh, should be the case. what do you consider to be the "network off" event in terms of android SDK? Normally as soon as network changes (lost or change) (except if a hidden hacky option of CSipSimple is used or if there is an ongoing call) the sip service is stopped (restarted) immediately if I don't mistake (but I could have forgot things on this part : it's a stable one that I didn't changed for a while)</p>
  </blockquote>
</blockquote></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #5</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Jun 22, 2015 by
                  <i class="ng-binding">Quick Hippo</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content -->
              <!-- ngIf: !comment.content --><span ng-if="!comment.content" class="ng-scope">
                <p><em>(No comment was entered for this change.)</em></p>
              </span><!-- end ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments -->
          </div>

          <!-- Sidebar with additional information -->
          <div class="maia-col-4">
            <div class="maia-aside">
              <p>Status: <code class="ng-binding">Obsolete</code></p>
              <!-- ngIf: issueCtrl.issue.labels.length > 0 --><p ng-if="issueCtrl.issue.labels.length &gt; 0" class="ng-scope">
                Labels:
                <br>
                <!-- ngRepeat: label in issueCtrl.issue.labels track by $index --><span ng-repeat="label in issueCtrl.issue.labels track by $index" class="ng-scope">
                  <span class="gca-label ng-binding">Type-Enhancement</span>
                </span><!-- end ngRepeat: label in issueCtrl.issue.labels track by $index --><span ng-repeat="label in issueCtrl.issue.labels track by $index" class="ng-scope">
                  <span class="gca-label ng-binding">Priority-Low</span>
                </span><!-- end ngRepeat: label in issueCtrl.issue.labels track by $index -->
              </p><!-- end ngIf: issueCtrl.issue.labels.length > 0 -->
            </div>
          </div>
        </div><!-- end ngIf: !issueCtrl.error -->
      </div>
    </div>

  </div>
</div>
</div></div></div>
    <noscript>
      &lt;p&gt;The Google Code Archive requires JavaScript to be enabled in your browser.&lt;/p&gt;
    </noscript>

    <div id="maia-signature"></div>
    <div class="maia-footer" id="maia-footer">
      <div id="maia-footer-local">
      </div>
      <div id="maia-footer-global">
        <div class="maia-aux">
          <ul>
            <li>
              <a href="//www.google.com/">Google</a>
            </li>
            <li>
              <a href="//www.google.com/intl/en/about/">About Google</a>
            </li>
            <li>
              <a href="//www.google.com/intl/en/policies/privacy/">Privacy</a>
            </li>
            <li>
              <a href="//www.google.com/intl/en/policies/terms/">Terms</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <script src="//www.google.com/js/maia.js"></script>
  


</body></html>