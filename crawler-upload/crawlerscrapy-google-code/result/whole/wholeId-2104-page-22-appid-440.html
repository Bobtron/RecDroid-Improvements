https://code.google.com/archive/p/csipsimple/issues/2727<!DOCTYPE html><html class="google ng-scope" lang="en" ng-app="codesiteArchive.application"><head>
    <meta charset="utf-8">
    <meta content="initial-scale=1, minimum-scale=1, width=device-width" name="viewport">

    <!-- https://developers.google.com/webmasters/ajax-crawling/docs/specification -->
    <meta name="fragment" content="!">
    <title>Google Code Archive - Long-term storage for Google Code Project Hosting.</title>

    <link rel="icon" type="image/vnd.microsoft.icon" href="/archive/img/project-hosting.ico">
    <script src="//www.google.com/js/google.js"></script>
    <link href="//www.google.com/css/maia.css" rel="stylesheet">
    <link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,600,700&amp;lang=en" rel="stylesheet">
    <link rel="stylesheet" href="/archive/archive_css.css">
    <script>
      CLOSURE_NO_DEPS = true;
    </script>
    <script src="/archive/angular.js"></script><style type="text/css">@charset "UTF-8";

[ng\:cloak], [ng-cloak], [data-ng-cloak], [x-ng-cloak],
.ng-cloak, .x-ng-cloak,
.ng-hide:not(.ng-hide-animate) {
  display: none !important;
}

ng\:form {
  display: block;
}

.ng-animate-shim {
  visibility:hidden;
}

.ng-anchor {
  position:absolute;
}
</style>
    <script src="/archive/pagedown.js"></script>
    <script src="/archive/archive.js"></script>
    <base href="/archive/">
  </head>

  <body>
    <div class="maia-header" id="maia-header" role="banner">
      <div class="maia-aux">
        <a href="/archive/">
          </a><h1><a href="/archive/">
            <img alt="Google" src="//www.google.com/images/branding/googlelogo/1x/googlelogo_color_116x41dp.png"> Code</a>
          </h1>
        
        <a href="/archive/">
          <h2>Archive</h2>
        </a>
        <a class="maia-teleport" href="#content">Skip to content</a>
        <div class="maia-util">
          <form action="/archive/search" class="maia-search ng-pristine ng-valid">
            <input name="q" placeholder="Search this site" type="text">
            <button class="maia-button">
              <span class="maia-search-icon">Search</span>
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- ngView: --><div ng-view="" class="ng-scope"><div ng-controller="ProjectIssueCtrl as issueCtrl" class="ng-scope">
<nav-bar-widget nav-level-1="projectCtrl.navLevel1" class="ng-isolate-scope"><div class="maia-nav maia-complex" id="maia-nav-x" role="navigation">
  <div class="maia-aux">
    <ul>
      <li ng-class="{active: navLevel1 == 'projects'}">
        <a href="/archive/">Projects</a>
        <!-- ngIf: navLevel2 -->
      </li>
      <li ng-class="{active: navLevel1 == 'search'}">
        <a href="/archive/search">Search</a>
      </li>
      <li ng-class="{active: navLevel1 == 'about'}">
        <a href="/archive/about">About</a>
      </li>
    </ul>
  </div>
</div>
</nav-bar-widget>
<div id="maia-main" role="main">

  <!-- ngIf: issueCtrl.notFound -->

  <div ng-hide="issueCtrl.notFound">
    <!-- Left-side resource nav -->
    <project-resources-widget domain="issueCtrl.domain" project="issueCtrl.projectName" class="ng-isolate-scope"><div class="maia-nav" id="maia-nav-y" role="navigation">
  <!-- ngIf: domain == 'code.google.com' --><ul ng-if="domain == 'code.google.com'" class="ng-scope">
    <li class="active">
      <a href="/archive/p/csipsimple/">Project</a>
    </li>
    <li>
      <a href="/archive/p/csipsimple/source">Source</a>
    </li>
    <li>
      <a href="/archive/p/csipsimple/issues">Issues</a>
    </li>
    <li>
      <a href="/archive/p/csipsimple/wikis">Wikis</a>
    </li>
    <li>
      <a href="/archive/p/csipsimple/downloads">Downloads</a>
    </li>
  </ul><!-- end ngIf: domain == 'code.google.com' -->

    <!-- ngIf: domain != 'code.google.com' -->
</div></project-resources-widget>

    <div class="maia-article" role="article">
      <div class="maia-teleport" id="content"></div>
      <div class="maia-cols">
        <div id="gca-project-header" class="maia-col-10">
          <a id="gca-export-to-gh" class="maia-button" href="https://code.google.com/export-to-github/export?project=csipsimple">Export to GitHub</a>
            <img class="gca-project-logo" src="https://storage.googleapis.com/google-code-archive/v2/code.google.com/csipsimple/logo.png">
            <h1 class="ng-binding">csipsimple - issue #2727</h1>
            <p class="ng-binding">SIP SIMPLE outgoing message does not honour port unless SIP proxy is configured.</p>
        </div>

        <div class="maia-col-10">
          <hr>

        <!-- ngIf: issueCtrl.error -->

        <!-- ngIf: !issueCtrl.error --><div ng-if="!issueCtrl.error" class="ng-scope">
          <!-- Comments -->
          <div class="maia-col-8">
            <!-- ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Jun 18, 2014 by
                  <i class="ng-binding">Helpful Bear</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p><b>What steps will reproduce the problem?</b>
1. setup SIP server on non-default port (i.e. 5080/UDP)
2. setup csipsimple
3. setup another client (i.e. microsip)
4. send SIMPLE message from other client to csipsimple (arrives)
5. reply to this message from csipsimple</p>

<p><b>What is the expected output? What do you see instead?</b>
Expected to see mesage sent from csipsimple delivered at other client, but instead the message does not arrive. Network trace shows csipsimple sending packets to port 5060.</p>

<p><b>What version of the product are you using? On what device / operating</b>
<b>system?</b>
1.02.00 r2330 on hammerhead (N5) android</p>

<p><b>Please provide any additional information below.</b>
- Server is FreeSWITCH 1.2.23 running with mod_sms configured for TCP/UDP 5080
- Registration URI in CsipSimple is configured for port 5080. However, there is no general port setting for a given account.
- network trace below; 1.1.1.1 being the SIP server, 2.2.2.2 being the csipsimple client, 1111 being the other client sending a message, 2222 being csipsimple again.</p>

<p>15:15:36.101949 IP 1.1.1.1.5080 &gt; 2.2.2.2.46096: UDP, length 711
MESSAGE sip:2222@2.2.2.2:23154 SIP/2.0
Via: SIP/2.0/UDP 1.1.1.1:5080;rport;branch=z9hG4bK9tBFDB9HeF01N
Route: &lt;sip:2222@2.2.2.2:23154&gt;;ob
Max-Forwards: 70
From: "MicroSIP user" &lt;sip:1111@sip.domain.com&gt;;tag=0c924a2897914ab1b925f86a01e47ead
To: &lt;sip:2222@2.2.2.2:23154&gt;;ob
Call-ID: 333932b5-69bd-429e-a43e-4a2f07817ed6
CSeq: 61208810 MESSAGE
Contact: &lt;sip:1.1.1.1:5080&gt;
User-Agent: FreeSWITCH-mod_sofia/1.2.23~64bit
Allow: INVITE, ACK, BYE, CANCEL, OPTIONS, MESSAGE, INFO, UPDATE, REGISTER, REFER, NOTIFY, PUBLISH, SUBSCRIBE
Supported: timer, path, replaces
Content-Type: text/plain
Content-Length: 4
X-FS-Sending-Message: f399503f-03c1-40ae-a45c-be6bc7cc15d9</p>

<p>test
15:15:36.438741 IP 2.2.2.2.46096 &gt; 1.1.1.1.5080: UDP, length 355
SIP/2.0 200 OK
Via: SIP/2.0/UDP 1.1.1.1:5080;rport=5080;received=1.1.1.1;branch=z9hG4bK9tBFDB9HeF01N
Call-ID: 333932b5-69bd-429e-a43e-4a2f07817ed6
From: "MicroSIP user" &lt;sip:1111@sip.domain.com&gt;;tag=0c924a2897914ab1b925f86a01e47ead
To: &lt;sip:2222@2.2.2.2&gt;;tag=z9hG4bK9tBFDB9HeF01N;ob
CSeq: 61208810 MESSAGE
Content-Length:  0</p>

<p>15:18:31.530854 IP 2.2.2.2.46096 &gt; 1.1.1.1.5060: SIP, length: 480
MESSAGE sip:1111@sip.domain.com SIP/2.0
Via: SIP/2.0/UDP 2.2.2.2:46096;rport;branch=z9hG4bKPjJfH0cPev.N7zo9QTi0oDjnz.1qnVwtj-
Max-Forwards: 70
From: "CsipSimple user" &lt;sip:2222@sip.domain.com&gt;;tag=-rS0Qbtdh9EO7bJFEqtUcMGylcJCaC.z
To: &lt;sip:1111@sip.domain.com&gt;
Call-ID: 0CqgZsl6lTev2zQJvFOSlmcMr4RuQKOr
CSeq: 8130 MESSAGE
Accept: text/plain, application/im-iscomposing+xml
User-Agent: CSipSimple_hammerhead-19/r2330
Content-Type: text/plain
Content-Length:     9</p>

<p>test back</p>

<p>After configuring the SIP proxy settings to sip.domain.com:5080, it does work.</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #1</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Jun 18, 2014 by
                  <i class="ng-binding">Quick Hippo</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>Are you using basic/advanced or expert wizard?</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #2</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Jun 18, 2014 by
                  <i class="ng-binding">Helpful Bear</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>I used the advanced wizard to setup the account. Later on I switched to expert as I had to disable "Allow contact rewrite" to prevent double registration at the SIP server.</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #3</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Jun 19, 2014 by
                  <i class="ng-binding">Quick Hippo</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>Ok, so can you check your "sip id" field. 
It should contains something like : 
And also upgrade to latest nightly build (it gives better indication of what will be autocompleted : <a href="http://nightlies.csipsimple.com/trunk/">http://nightlies.csipsimple.com/trunk/</a> )</p>

<p>If your sip id field does not contains the port, that's the problem (registrar is something not necessarily linked to your default domain).
When you make a call/write a message without specifying target domain, csipsimple should take your default domain from the account domain (and this comes from the sip id, not from the registrar).</p>

<p>You can still at any moment, send a message to somebody by specifying the domain name manually.
In this case if you dial / send message to 111@yourdomain it's totally expected that the sip will try to reach over port 5060. That's how SIP is defined in the standard.
In case you'd like sip uri like 111@yourdomain to work when calling from your domain (that are actually not valid if you give that to somebody with another provider), you have to setup the proxy field so that it reach your sip server (and then your sip server will be able to route internally and discover it's probably something it should handle by itself).
Else you have to dial using a valid sip uri, in your case 111@yourdomain:5080</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #4</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Jun 19, 2014 by
                  <i class="ng-binding">Helpful Bear</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>Thanks for your response. I just checked the account ID setting in expert mode and it did not contain the port number. I changed it to "name" , removed the SIP proxy settings and I tried again. SIP MESSAGE packets are still going out to sip.domain.com:5060. I will look into latest nightly build later on.</p>

<p>Please note that I'm only responding to a message that comes in from another account. Adding another contact with the correct sip URI does indeed work, but that means incoming and outgoing messages have to go through a different contact, which is not desirable.</p>

<p>I more and more get the feeling that also the microsip client is to blame, as the From: header from the SIP MESSAGE of microsip does not contain the non-default port number.</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #5</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Jun 19, 2014 by
                  <i class="ng-binding">Quick Hippo</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>Oh, ok if it's reply to an incoming message the default account is not important.</p>

<p>What is taken into account in this case is the "from" sent by your server.</p>

<p>As you said, if this from field doesn't contains the custom port, it should be expected that the sip client try to use default port to reach the user directly.
Let's assume the following case (very improbable but that is allowed in sip specifications) :
With 2 sip servers running on your server, one using port 5060, the other using port 5080; with two completly different users database.
User 111@yourdomain.com is equal to user 111@yourdomain.com:5060 but is different from user 111@yourdomain.com:5080.
If the server running on port 5080 (or a user connected to this server) announces it's users with a from without port (or 5060), it will lead to confusion on clients sides that are able to manage this scenario properly : the client has no way to know that it should understand the incoming message/call that apparently comes from the user of the 5060 server rather than the one of the 5080 user.</p>

<p>With what you changed in sip id (to add port 5080) you should have fixed the way csipsimple announced itself to outside world. (And the fact it was not fill with the port is maybe a problem that I should fix). Something pretty similar should be done on microsip side. I hope they left a way to configure that as they are also based on pjsip.</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #6</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Jun 19, 2014 by
                  <i class="ng-binding">Helpful Bear</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>Thanks for your response. I have no way to configure it on the microsip side. However, the message does get sent to the correct port (as it is received by csipsimple). I just configured the contact on the microsip side with number (2222) and name (CsipSimple user) and from there on I'm able to send messages to the user registered at CsipSimple.</p>

<p>Either way I'm happy with just entering the sip proxy settings to get it to work. :-)</p>

<p>Thanks for your support.</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments -->
          </div>

          <!-- Sidebar with additional information -->
          <div class="maia-col-4">
            <div class="maia-aside">
              <p>Status: <code class="ng-binding">Need-Details</code></p>
              <!-- ngIf: issueCtrl.issue.labels.length > 0 --><p ng-if="issueCtrl.issue.labels.length &gt; 0" class="ng-scope">
                Labels:
                <br>
                <!-- ngRepeat: label in issueCtrl.issue.labels track by $index --><span ng-repeat="label in issueCtrl.issue.labels track by $index" class="ng-scope">
                  <span class="gca-label ng-binding">Type-Defect</span>
                </span><!-- end ngRepeat: label in issueCtrl.issue.labels track by $index --><span ng-repeat="label in issueCtrl.issue.labels track by $index" class="ng-scope">
                  <span class="gca-label ng-binding">Priority-Medium</span>
                </span><!-- end ngRepeat: label in issueCtrl.issue.labels track by $index -->
              </p><!-- end ngIf: issueCtrl.issue.labels.length > 0 -->
            </div>
          </div>
        </div><!-- end ngIf: !issueCtrl.error -->
      </div>
    </div>

  </div>
</div>
</div></div></div>
    <noscript>
      &lt;p&gt;The Google Code Archive requires JavaScript to be enabled in your browser.&lt;/p&gt;
    </noscript>

    <div id="maia-signature"></div>
    <div class="maia-footer" id="maia-footer">
      <div id="maia-footer-local">
      </div>
      <div id="maia-footer-global">
        <div class="maia-aux">
          <ul>
            <li>
              <a href="//www.google.com/">Google</a>
            </li>
            <li>
              <a href="//www.google.com/intl/en/about/">About Google</a>
            </li>
            <li>
              <a href="//www.google.com/intl/en/policies/privacy/">Privacy</a>
            </li>
            <li>
              <a href="//www.google.com/intl/en/policies/terms/">Terms</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <script src="//www.google.com/js/maia.js"></script>
  


</body></html>