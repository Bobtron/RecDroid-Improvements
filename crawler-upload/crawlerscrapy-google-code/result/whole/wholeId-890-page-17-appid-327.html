https://code.google.com/archive/p/android-daisy-epub-reader/issues/52<!DOCTYPE html><html class="google ng-scope" lang="en" ng-app="codesiteArchive.application"><head>
    <meta charset="utf-8">
    <meta content="initial-scale=1, minimum-scale=1, width=device-width" name="viewport">

    <!-- https://developers.google.com/webmasters/ajax-crawling/docs/specification -->
    <meta name="fragment" content="!">
    <title>Google Code Archive - Long-term storage for Google Code Project Hosting.</title>

    <link rel="icon" type="image/vnd.microsoft.icon" href="/archive/img/project-hosting.ico">
    <script src="//www.google.com/js/google.js"></script>
    <link href="//www.google.com/css/maia.css" rel="stylesheet">
    <link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,600,700&amp;lang=en" rel="stylesheet">
    <link rel="stylesheet" href="/archive/archive_css.css">
    <script>
      CLOSURE_NO_DEPS = true;
    </script>
    <script src="/archive/angular.js"></script><style type="text/css">@charset "UTF-8";

[ng\:cloak], [ng-cloak], [data-ng-cloak], [x-ng-cloak],
.ng-cloak, .x-ng-cloak,
.ng-hide:not(.ng-hide-animate) {
  display: none !important;
}

ng\:form {
  display: block;
}

.ng-animate-shim {
  visibility:hidden;
}

.ng-anchor {
  position:absolute;
}
</style>
    <script src="/archive/pagedown.js"></script>
    <script src="/archive/archive.js"></script>
    <base href="/archive/">
  </head>

  <body>
    <div class="maia-header" id="maia-header" role="banner">
      <div class="maia-aux">
        <a href="/archive/">
          </a><h1><a href="/archive/">
            <img alt="Google" src="//www.google.com/images/branding/googlelogo/1x/googlelogo_color_116x41dp.png"> Code</a>
          </h1>
        
        <a href="/archive/">
          <h2>Archive</h2>
        </a>
        <a class="maia-teleport" href="#content">Skip to content</a>
        <div class="maia-util">
          <form action="/archive/search" class="maia-search ng-pristine ng-valid">
            <input name="q" placeholder="Search this site" type="text">
            <button class="maia-button">
              <span class="maia-search-icon">Search</span>
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- ngView: --><div ng-view="" class="ng-scope"><div ng-controller="ProjectIssueCtrl as issueCtrl" class="ng-scope">
<nav-bar-widget nav-level-1="projectCtrl.navLevel1" class="ng-isolate-scope"><div class="maia-nav maia-complex" id="maia-nav-x" role="navigation">
  <div class="maia-aux">
    <ul>
      <li ng-class="{active: navLevel1 == 'projects'}">
        <a href="/archive/">Projects</a>
        <!-- ngIf: navLevel2 -->
      </li>
      <li ng-class="{active: navLevel1 == 'search'}">
        <a href="/archive/search">Search</a>
      </li>
      <li ng-class="{active: navLevel1 == 'about'}">
        <a href="/archive/about">About</a>
      </li>
    </ul>
  </div>
</div>
</nav-bar-widget>
<div id="maia-main" role="main">

  <!-- ngIf: issueCtrl.notFound -->

  <div ng-hide="issueCtrl.notFound">
    <!-- Left-side resource nav -->
    <project-resources-widget domain="issueCtrl.domain" project="issueCtrl.projectName" class="ng-isolate-scope"><div class="maia-nav" id="maia-nav-y" role="navigation">
  <!-- ngIf: domain == 'code.google.com' --><ul ng-if="domain == 'code.google.com'" class="ng-scope">
    <li class="active">
      <a href="/archive/p/android-daisy-epub-reader/">Project</a>
    </li>
    <li>
      <a href="/archive/p/android-daisy-epub-reader/source">Source</a>
    </li>
    <li>
      <a href="/archive/p/android-daisy-epub-reader/issues">Issues</a>
    </li>
    <li>
      <a href="/archive/p/android-daisy-epub-reader/wikis">Wikis</a>
    </li>
    <li>
      <a href="/archive/p/android-daisy-epub-reader/downloads">Downloads</a>
    </li>
  </ul><!-- end ngIf: domain == 'code.google.com' -->

    <!-- ngIf: domain != 'code.google.com' -->
</div></project-resources-widget>

    <div class="maia-article" role="article">
      <div class="maia-teleport" id="content"></div>
      <div class="maia-cols">
        <div id="gca-project-header" class="maia-col-10">
          <a id="gca-export-to-gh" class="maia-button" href="https://code.google.com/export-to-github/export?project=android-daisy-epub-reader">Export to GitHub</a>
            <img class="gca-project-logo" src="https://storage.googleapis.com/google-code-archive/v2/code.google.com/android-daisy-epub-reader/logo.png">
            <h1 class="ng-binding">android-daisy-epub-reader - issue #52</h1>
            <p class="ng-binding">We need a way to play sections of MP3 audio correctly </p>
        </div>

        <div class="maia-col-10">
          <hr>

        <!-- ngIf: issueCtrl.error -->

        <!-- ngIf: !issueCtrl.error --><div ng-if="!issueCtrl.error" class="ng-scope">
          <!-- Comments -->
          <div class="maia-col-8">
            <!-- ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Dec 28, 2011 by
                  <i class="ng-binding">Helpful Panda</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>Lots of full-audio DAISY books store their recorded audio in mp3 files. Often several sections are stored in a common mp3 file, where the starting and ending offsets are stored in the SMIL file which points to the mp3 audio. The SMIL file may also refer to text and other media to be displayed as the audio is played. (See the following web link for more information about the relationships between SMIL files and audio files in the DAISY 2.02 <a href="http://www.daisy.org/z3986/specifications/daisy_202.html#smil">http://www.daisy.org/z3986/specifications/daisy_202.html#smil</a> )</p>

<p>The current version of DaisyReader simply sidesteps the challenge by taking advantage of the typical way the audio is stored in full-audio books. It plays the audio from the current offset until the end of the mp3 file. The current offset either comes from the automatic bookmark (created by DaisyReader to keep track of where it has reached in the current DAISY audio book) or from the clip-start attribute for the section selected by the user as they navigate around the book. </p>

<p>The current approach is too limiting if we want to synchronize other media with the audio being played (i.e. the book being 'read') or for books that don't store the audio segments sequentially (the standard is flexible in how the audio is stored and referenced, read the following section of the DAISY 2.02 standard for details: 2.3.4.1 The NCC - SMIL - Audio relationships )</p>

<p>The main technical limitations we have identified is the Android MediaPlayer does not accept an 'end' or 'play-until' parameter. Thanks to Nick Williamson at the RNIB, we have an experimental implementation that starts a separate timer in the program which sends a stop command to the MediaPlayer when the duration of the current segment has been reached or exceeded. However when we tested this 
design we noticed the audio is sometimes truncated and doesn't sound as smooth as we'd like.</p>

<p>Here are some additional ideas which might work. Each could be assessed and tested for practicality and suitability.
   1 SplitMp3Files Programmatically split the mp3 files into separate, discrete files each containing only one segment. We would also need to patch the information in the SMIL files to point to the discrete files.</p>

<p>2 OverlayMp3Files Create a 'virtual' overlay which makes the mp3 file appear as if it finishes at the end of the current segment. Pass this overlay to the MediaPlayer which then plays it as if it's a real file. The MediaPlayer then stops at the 'end' of the overlay on the track.</p>

<p>3 NativeMediaPlayer Create a custom MediaPlayer that allows us to specify when to finish playing the current audio. Several commercial development companies have created custom Media Players to allow more flexibility and control, we could do something similar.</p>

<p>I don't know enough at this stage to implement any of the 3 proposed approaches effectively (in terms of both time and quality of the results) contributions of ideas and code are welcome. </p>

<p>Here are some links that may contain clues on how to improve our handling of the mp3 audio:
   * <a href="http://www.wiseandroid.com/post/2010/07/13/Intro-to-the-three-Android-Audio-APIs.aspx">http://www.wiseandroid.com/post/2010/07/13/Intro-to-the-three-Android-Audio-APIs.aspx</a>
   * <a href="http://mindtherobot.com/blog/624/android-audio-play-an-mp3-file-on-an-audiotrack/">http://mindtherobot.com/blog/624/android-audio-play-an-mp3-file-on-an-audiotrack/</a> 
   * A pair of related questions on stackoverflow.com which seem to have the same aim we have: <a href="http://stackoverflow.com/questions/5457094/android-how-to-stop-a-playing-media-mp3-in-specific-duration">http://stackoverflow.com/questions/5457094/android-how-to-stop-a-playing-media-mp3-in-specific-duration</a> and <a href="http://stackoverflow.com/questions/5454452/android-how-to-stop-media-mp3-in-playing-when-specific-milliseconds-come">http://stackoverflow.com/questions/5454452/android-how-to-stop-media-mp3-in-playing-when-specific-milliseconds-come</a>
   * <a href="http://developer.android.com/reference/android/os/CountDownTimer.html">http://developer.android.com/reference/android/os/CountDownTimer.html</a> as another way to possibly control the MediaPlayer
   * <a href="http://www.javazoom.net/projects.html">http://www.javazoom.net/projects.html</a> JLayer and other related libraries for playing MP3 (and other audio formats) using Java. See <a href="http://www.streamhead.com/jlayer-java-mp3-decoder/">http://www.streamhead.com/jlayer-java-mp3-decoder/</a> for an overview of using JLayer.
   * <a href="http://code.google.com/p/mp3transform/">http://code.google.com/p/mp3transform/</a> is a newer version of J(ava)Layer
   * <a href="http://www.javaworld.com/javaworld/jw-11-2000/jw-1103-mp3.html">http://www.javaworld.com/javaworld/jw-11-2000/jw-1103-mp3.html</a> (an older article from 2000 and for Java 1.3 but seems interesting and relevant)
   * <a href="http://stackoverflow.com/questions/6294807/calculate-mpeg-frame-length-ms">http://stackoverflow.com/questions/6294807/calculate-mpeg-frame-length-ms</a> if we decide to use JavaLayer and it's AdvancedPlayer then it provides a method that takes starting and ending frames, so we'd need to be able to calculate the correct values for each frame.
   * <a href="http://p-nand-q.com/download/split3pm.html">http://p-nand-q.com/download/split3pm.html</a> however read the limitation about inaccuracies in the timing. Also the code is in C++</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #1</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Apr 12, 2012 by
                  <i class="ng-binding">Massive Giraffe</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>The <a href="http://stackoverflow.com/questions/5454452/android-how-to-stop-media-mp3-in-playing-when-specific-milliseconds-come">http://stackoverflow.com/questions/5454452/android-how-to-stop-media-mp3-in-playing-when-specific-milliseconds-come</a> answer looks good.</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments -->
          </div>

          <!-- Sidebar with additional information -->
          <div class="maia-col-4">
            <div class="maia-aside">
              <p>Status: <code class="ng-binding">Accepted</code></p>
              <!-- ngIf: issueCtrl.issue.labels.length > 0 --><p ng-if="issueCtrl.issue.labels.length &gt; 0" class="ng-scope">
                Labels:
                <br>
                <!-- ngRepeat: label in issueCtrl.issue.labels track by $index --><span ng-repeat="label in issueCtrl.issue.labels track by $index" class="ng-scope">
                  <span class="gca-label ng-binding">Type-Enhancement</span>
                </span><!-- end ngRepeat: label in issueCtrl.issue.labels track by $index --><span ng-repeat="label in issueCtrl.issue.labels track by $index" class="ng-scope">
                  <span class="gca-label ng-binding">Priority-High</span>
                </span><!-- end ngRepeat: label in issueCtrl.issue.labels track by $index -->
              </p><!-- end ngIf: issueCtrl.issue.labels.length > 0 -->
            </div>
          </div>
        </div><!-- end ngIf: !issueCtrl.error -->
      </div>
    </div>

  </div>
</div>
</div></div></div>
    <noscript>
      &lt;p&gt;The Google Code Archive requires JavaScript to be enabled in your browser.&lt;/p&gt;
    </noscript>

    <div id="maia-signature"></div>
    <div class="maia-footer" id="maia-footer">
      <div id="maia-footer-local">
      </div>
      <div id="maia-footer-global">
        <div class="maia-aux">
          <ul>
            <li>
              <a href="//www.google.com/">Google</a>
            </li>
            <li>
              <a href="//www.google.com/intl/en/about/">About Google</a>
            </li>
            <li>
              <a href="//www.google.com/intl/en/policies/privacy/">Privacy</a>
            </li>
            <li>
              <a href="//www.google.com/intl/en/policies/terms/">Terms</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <script src="//www.google.com/js/maia.js"></script>
  


</body></html>