https://code.google.com/archive/p/csipsimple/issues/1529<!DOCTYPE html><html class="google ng-scope" lang="en" ng-app="codesiteArchive.application"><head>
    <meta charset="utf-8">
    <meta content="initial-scale=1, minimum-scale=1, width=device-width" name="viewport">

    <!-- https://developers.google.com/webmasters/ajax-crawling/docs/specification -->
    <meta name="fragment" content="!">
    <title>Google Code Archive - Long-term storage for Google Code Project Hosting.</title>

    <link rel="icon" type="image/vnd.microsoft.icon" href="/archive/img/project-hosting.ico">
    <script src="//www.google.com/js/google.js"></script>
    <link href="//www.google.com/css/maia.css" rel="stylesheet">
    <link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,600,700&amp;lang=en" rel="stylesheet">
    <link rel="stylesheet" href="/archive/archive_css.css">
    <script>
      CLOSURE_NO_DEPS = true;
    </script>
    <script src="/archive/angular.js"></script><style type="text/css">@charset "UTF-8";

[ng\:cloak], [ng-cloak], [data-ng-cloak], [x-ng-cloak],
.ng-cloak, .x-ng-cloak,
.ng-hide:not(.ng-hide-animate) {
  display: none !important;
}

ng\:form {
  display: block;
}

.ng-animate-shim {
  visibility:hidden;
}

.ng-anchor {
  position:absolute;
}
</style>
    <script src="/archive/pagedown.js"></script>
    <script src="/archive/archive.js"></script>
    <base href="/archive/">
  </head>

  <body>
    <div class="maia-header" id="maia-header" role="banner">
      <div class="maia-aux">
        <a href="/archive/">
          </a><h1><a href="/archive/">
            <img alt="Google" src="//www.google.com/images/branding/googlelogo/1x/googlelogo_color_116x41dp.png"> Code</a>
          </h1>
        
        <a href="/archive/">
          <h2>Archive</h2>
        </a>
        <a class="maia-teleport" href="#content">Skip to content</a>
        <div class="maia-util">
          <form action="/archive/search" class="maia-search ng-pristine ng-valid">
            <input name="q" placeholder="Search this site" type="text">
            <button class="maia-button">
              <span class="maia-search-icon">Search</span>
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- ngView: --><div ng-view="" class="ng-scope"><div ng-controller="ProjectIssueCtrl as issueCtrl" class="ng-scope">
<nav-bar-widget nav-level-1="projectCtrl.navLevel1" class="ng-isolate-scope"><div class="maia-nav maia-complex" id="maia-nav-x" role="navigation">
  <div class="maia-aux">
    <ul>
      <li ng-class="{active: navLevel1 == 'projects'}">
        <a href="/archive/">Projects</a>
        <!-- ngIf: navLevel2 -->
      </li>
      <li ng-class="{active: navLevel1 == 'search'}">
        <a href="/archive/search">Search</a>
      </li>
      <li ng-class="{active: navLevel1 == 'about'}">
        <a href="/archive/about">About</a>
      </li>
    </ul>
  </div>
</div>
</nav-bar-widget>
<div id="maia-main" role="main">

  <!-- ngIf: issueCtrl.notFound -->

  <div ng-hide="issueCtrl.notFound">
    <!-- Left-side resource nav -->
    <project-resources-widget domain="issueCtrl.domain" project="issueCtrl.projectName" class="ng-isolate-scope"><div class="maia-nav" id="maia-nav-y" role="navigation">
  <!-- ngIf: domain == 'code.google.com' --><ul ng-if="domain == 'code.google.com'" class="ng-scope">
    <li class="active">
      <a href="/archive/p/csipsimple/">Project</a>
    </li>
    <li>
      <a href="/archive/p/csipsimple/source">Source</a>
    </li>
    <li>
      <a href="/archive/p/csipsimple/issues">Issues</a>
    </li>
    <li>
      <a href="/archive/p/csipsimple/wikis">Wikis</a>
    </li>
    <li>
      <a href="/archive/p/csipsimple/downloads">Downloads</a>
    </li>
  </ul><!-- end ngIf: domain == 'code.google.com' -->

    <!-- ngIf: domain != 'code.google.com' -->
</div></project-resources-widget>

    <div class="maia-article" role="article">
      <div class="maia-teleport" id="content"></div>
      <div class="maia-cols">
        <div id="gca-project-header" class="maia-col-10">
          <a id="gca-export-to-gh" class="maia-button" href="https://code.google.com/export-to-github/export?project=csipsimple">Export to GitHub</a>
            <img class="gca-project-logo" src="https://storage.googleapis.com/google-code-archive/v2/code.google.com/csipsimple/logo.png">
            <h1 class="ng-binding">csipsimple - issue #1529</h1>
            <p class="ng-binding">No outgoing audio from CSipSimple to softphone or Asterisk server on the same network</p>
        </div>

        <div class="maia-col-10">
          <hr>

        <!-- ngIf: issueCtrl.error -->

        <!-- ngIf: !issueCtrl.error --><div ng-if="!issueCtrl.error" class="ng-scope">
          <!-- Comments -->
          <div class="maia-col-8">
            <!-- ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Jan 22, 2012 by
                  <i class="ng-binding">Happy Kangaroo</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>This could be two separate issues.</p>

<p><b>What steps will reproduce the problem?</b>
1.Connect to a wireless LAN access point, and any other networks are disabled(I don't use the phone as UMTS/GSM phone.)
2.Set up a RTP starting port number in the Network settings, 65520 for example.
3.Set up an audio call with maybe any codec (tested G711u and GSM) to sflphone by either URI direct call or extension via Asterisk server. They are all on the same network.</p>

<p><b>What is the expected output? What do you see instead?</b>
1.Sflphone should receive audio from CSipSimple, but no sound.
1-1.Outgoing audio from CSipSimple must be sent, but no audio is sent.
1-2.CSipSimple must send RTP packets to sflphone or Asterisk server, but no RTP packets are sent if I check the packets with WireShark. However, it sometimes works properly and sends RTP packets after a while being on the same network.</p>

<p>2.The RTP port for audio in CSipSimple must be the port number I set or higher.
2-1.CSipSimple uses random port numbers such as 36180 and 33934 in the SIP/SDP message.
2-2.Sflphone sends RTP packets to the port stated in the Media Description section.
2-3.There is another attribute that states rtcp port. I do not know RFC but I do not see this parameter when I use a different app(AGEphone ver.1.0.017) and it works perfectly on the LAN.</p>

<p><b>What version of the product are you using? On what operating system?</b>
Cellphone
1.LG Optimus One (Model No.:LG-P500h) with Android 2.3.3.
2.CSipSimple version is 0.03-01 r1108
3.Current IP address is 192.168.0.16 (DHCP)</p>

<p>Asterisk Server
1.OS is Ubuntu 11.04 with 2.6.38-8-generic kernel
2.Asterisk is Asterisk 1.6.2.9-2ubuntu2.1
3.Current IP address is 192.168.0.200 (static)</p>

<p>SFLphone
1.OS is Ubuntu 11.04 with 2.6.38-13-generic-pae kernel
2.SFLphone is 0.9.12
3.Current IP address is 192.168.0.10 (DHCP)</p>

<p><b>Please provide any additional information below.</b>
CSipSimple works perfectly when it connects to the Asterisk Server that is open to the Internet from WAN side of NATed networks such as starbucks wifi etc.</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #1</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Jan 22, 2012 by
                  <i class="ng-binding">Happy Kangaroo</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>Oh, I forgot to add the subnet mask. It is 255.255.255.0 (/24) for the all IPs.</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #2</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Jan 23, 2012 by
                  <i class="ng-binding">Quick Hippo</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>Is STUN (or STUN+ICE) activated in csipsimple when you make the test inside the private network?</p>

<p>If so, it may try to resolve the public rtp port and ip and provide that in the SDP to your server in the private network. And this one gets lost because it will try to send to the public port and it will probably fail (unless your public router does really tricky things).
It could explains :
* why it works from outside
* that sdp you observe have a different port (and probably ip)
* the other sip client that has not stun activated works inside (and may fail if you use it outside ;) ).</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #3</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Jan 23, 2012 by
                  <i class="ng-binding">Happy Kangaroo</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>Thank you for the response.</p>

<p>No, I never used STUN. Disabling ICE solved the RTP port number one. Now I see the ports are the number I set or higher.
But it uses a random port number with ICE even when there is no connection to the router (Truly LAN network). How can ICE obtain a public port while there is no public IP and port??</p>

<p>Anyway, CSipSimple still does not send RTP packets to SFLphone or Asterisk, or even another softphone(Twinkle etc)</p>

<p>I tried different codecs, G711u, G711a and GSM, but all the same, no RTP audio packets from CSipSimple. I suppose this is not related to a codec.</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #4</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Jan 23, 2012 by
                  <i class="ng-binding">Happy Kangaroo</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>I think I found out the cause.</p>

<p>What steps will reproduce the problem?
1.Enabling WMM function for Wireless LAN on a wireless router or an access point 
2.Turn on "Enable QoS"
3.Connect to a wireless LAN access point, and any other networks are disabled(I don't use the phone as UMTS/GSM phone.)
4.Set up a RTP starting port number in the Network settings, 65520 for example.
5.Set up an audio call with maybe any codec (tested G711u and GSM) to sflphone by either URI direct call or extension via Asterisk server. They are all on the same network.</p>

<p>What is the expected output? What do you see instead?
1.Sflphone should receive audio from CSipSimple, but no sound.
1-1.Outgoing audio from CSipSimple must be sent, but no audio is sent.
1-2.CSipSimple must send RTP packets to sflphone or Asterisk server, but no RTP packets are sent if I check the packets with WireShark. However, it sometimes works properly and sends RTP packets after a while being on the same network.</p>

<p>What version of the product are you using? On what operating system?
Cellphone
1.LG Optimus One (Model No.:LG-P500h) with Android 2.3.3.
2.CSipSimple version is 0.03-01 r1108
3.Current IP address is 192.168.0.16 (DHCP)</p>

<p>Asterisk Server
1.OS is Ubuntu 11.04 with 2.6.38-8-generic kernel
2.Asterisk is Asterisk 1.6.2.9-2ubuntu2.1
3.Current IP address is 192.168.0.200 (static)</p>

<p>SFLphone
1.OS is Ubuntu 11.04 with 2.6.38-13-generic-pae kernel
2.SFLphone is 0.9.12
3.Current IP address is 192.168.0.10 (DHCP)</p>

<p>Wireless router
1.D-link WBR-2310 working as an access point (NAPT is disabled)
2.Firmware ver. 2.03
3.WMM function is on</p>

<p>Please provide any additional information below.
1.CSipSimple works perfectly when it connects to the Asterisk Server that is open to the Internet from WAN side of NATed networks such as starbucks wifi etc.</p>

<p>Solutions to avoid this issue:
* Disabling WMM function on Wireless LAN
 --&gt; CSipSimple works perfectly regardless of Enable QoS setting.
* Disabling "Enable QoS" on CSipSimple
 --&gt; CSipSimple works perfectly regardless of WMM setting on a wireless router</p>

<p>So, this is mainly related to WMM(L2 QoS for wireless LAN, 802.11e-2005) functionality because CSipSImple works fine when WMM is disabled, and I presume that this issue occurs when WMM is on, Enable QoS is on and peers are in the same private LAN because I do not recall I had this issue when I used public wifi APs.</p>

<p>I will check if the wifi APs have WMM enabled or not when I visit any public wifi place next time, and post updates.</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #5</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Jan 23, 2012 by
                  <i class="ng-binding">Happy Kangaroo</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>Since it is closed, I will make a new ticket.</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #6</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Jan 23, 2012 by
                  <i class="ng-binding">Quick Hippo</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>Ok. Sorry for the delay replying. I do csipsimple only on my free time (night, week end and hollidays) ;).</p>

<p>So don't be worried if I don't reply for an entire day, it just means that I had hard time for my full time part job and was too tired to do support stuff :).</p>

<p>I could have re-open the issue :), but good idea to open a new one.</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments -->
          </div>

          <!-- Sidebar with additional information -->
          <div class="maia-col-4">
            <div class="maia-aside">
              <p>Status: <code class="ng-binding">Done</code></p>
              <!-- ngIf: issueCtrl.issue.labels.length > 0 --><p ng-if="issueCtrl.issue.labels.length &gt; 0" class="ng-scope">
                Labels:
                <br>
                <!-- ngRepeat: label in issueCtrl.issue.labels track by $index --><span ng-repeat="label in issueCtrl.issue.labels track by $index" class="ng-scope">
                  <span class="gca-label ng-binding">Type-Defect</span>
                </span><!-- end ngRepeat: label in issueCtrl.issue.labels track by $index --><span ng-repeat="label in issueCtrl.issue.labels track by $index" class="ng-scope">
                  <span class="gca-label ng-binding">Priority-Medium</span>
                </span><!-- end ngRepeat: label in issueCtrl.issue.labels track by $index -->
              </p><!-- end ngIf: issueCtrl.issue.labels.length > 0 -->
            </div>
          </div>
        </div><!-- end ngIf: !issueCtrl.error -->
      </div>
    </div>

  </div>
</div>
</div></div></div>
    <noscript>
      &lt;p&gt;The Google Code Archive requires JavaScript to be enabled in your browser.&lt;/p&gt;
    </noscript>

    <div id="maia-signature"></div>
    <div class="maia-footer" id="maia-footer">
      <div id="maia-footer-local">
      </div>
      <div id="maia-footer-global">
        <div class="maia-aux">
          <ul>
            <li>
              <a href="//www.google.com/">Google</a>
            </li>
            <li>
              <a href="//www.google.com/intl/en/about/">About Google</a>
            </li>
            <li>
              <a href="//www.google.com/intl/en/policies/privacy/">Privacy</a>
            </li>
            <li>
              <a href="//www.google.com/intl/en/policies/terms/">Terms</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <script src="//www.google.com/js/maia.js"></script>
  


</body></html>