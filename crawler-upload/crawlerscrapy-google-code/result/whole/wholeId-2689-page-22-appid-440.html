https://code.google.com/archive/p/csipsimple/issues/2111<!DOCTYPE html><html class="google ng-scope" lang="en" ng-app="codesiteArchive.application"><head>
    <meta charset="utf-8">
    <meta content="initial-scale=1, minimum-scale=1, width=device-width" name="viewport">

    <!-- https://developers.google.com/webmasters/ajax-crawling/docs/specification -->
    <meta name="fragment" content="!">
    <title>Google Code Archive - Long-term storage for Google Code Project Hosting.</title>

    <link rel="icon" type="image/vnd.microsoft.icon" href="/archive/img/project-hosting.ico">
    <script src="//www.google.com/js/google.js"></script>
    <link href="//www.google.com/css/maia.css" rel="stylesheet">
    <link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,600,700&amp;lang=en" rel="stylesheet">
    <link rel="stylesheet" href="/archive/archive_css.css">
    <script>
      CLOSURE_NO_DEPS = true;
    </script>
    <script src="/archive/angular.js"></script><style type="text/css">@charset "UTF-8";

[ng\:cloak], [ng-cloak], [data-ng-cloak], [x-ng-cloak],
.ng-cloak, .x-ng-cloak,
.ng-hide:not(.ng-hide-animate) {
  display: none !important;
}

ng\:form {
  display: block;
}

.ng-animate-shim {
  visibility:hidden;
}

.ng-anchor {
  position:absolute;
}
</style>
    <script src="/archive/pagedown.js"></script>
    <script src="/archive/archive.js"></script>
    <base href="/archive/">
  </head>

  <body>
    <div class="maia-header" id="maia-header" role="banner">
      <div class="maia-aux">
        <a href="/archive/">
          </a><h1><a href="/archive/">
            <img alt="Google" src="//www.google.com/images/branding/googlelogo/1x/googlelogo_color_116x41dp.png"> Code</a>
          </h1>
        
        <a href="/archive/">
          <h2>Archive</h2>
        </a>
        <a class="maia-teleport" href="#content">Skip to content</a>
        <div class="maia-util">
          <form action="/archive/search" class="maia-search ng-pristine ng-valid">
            <input name="q" placeholder="Search this site" type="text">
            <button class="maia-button">
              <span class="maia-search-icon">Search</span>
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- ngView: --><div ng-view="" class="ng-scope"><div ng-controller="ProjectIssueCtrl as issueCtrl" class="ng-scope">
<nav-bar-widget nav-level-1="projectCtrl.navLevel1" class="ng-isolate-scope"><div class="maia-nav maia-complex" id="maia-nav-x" role="navigation">
  <div class="maia-aux">
    <ul>
      <li ng-class="{active: navLevel1 == 'projects'}">
        <a href="/archive/">Projects</a>
        <!-- ngIf: navLevel2 -->
      </li>
      <li ng-class="{active: navLevel1 == 'search'}">
        <a href="/archive/search">Search</a>
      </li>
      <li ng-class="{active: navLevel1 == 'about'}">
        <a href="/archive/about">About</a>
      </li>
    </ul>
  </div>
</div>
</nav-bar-widget>
<div id="maia-main" role="main">

  <!-- ngIf: issueCtrl.notFound -->

  <div ng-hide="issueCtrl.notFound">
    <!-- Left-side resource nav -->
    <project-resources-widget domain="issueCtrl.domain" project="issueCtrl.projectName" class="ng-isolate-scope"><div class="maia-nav" id="maia-nav-y" role="navigation">
  <!-- ngIf: domain == 'code.google.com' --><ul ng-if="domain == 'code.google.com'" class="ng-scope">
    <li class="active">
      <a href="/archive/p/csipsimple/">Project</a>
    </li>
    <li>
      <a href="/archive/p/csipsimple/source">Source</a>
    </li>
    <li>
      <a href="/archive/p/csipsimple/issues">Issues</a>
    </li>
    <li>
      <a href="/archive/p/csipsimple/wikis">Wikis</a>
    </li>
    <li>
      <a href="/archive/p/csipsimple/downloads">Downloads</a>
    </li>
  </ul><!-- end ngIf: domain == 'code.google.com' -->

    <!-- ngIf: domain != 'code.google.com' -->
</div></project-resources-widget>

    <div class="maia-article" role="article">
      <div class="maia-teleport" id="content"></div>
      <div class="maia-cols">
        <div id="gca-project-header" class="maia-col-10">
          <a id="gca-export-to-gh" class="maia-button" href="https://code.google.com/export-to-github/export?project=csipsimple">Export to GitHub</a>
            <img class="gca-project-logo" src="https://storage.googleapis.com/google-code-archive/v2/code.google.com/csipsimple/logo.png">
            <h1 class="ng-binding">csipsimple - issue #2111</h1>
            <p class="ng-binding">There's no "Set published IP" option in "Network settings"</p>
        </div>

        <div class="maia-col-10">
          <hr>

        <!-- ngIf: issueCtrl.error -->

        <!-- ngIf: !issueCtrl.error --><div ng-if="!issueCtrl.error" class="ng-scope">
          <!-- Comments -->
          <div class="maia-col-8">
            <!-- ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Dec 6, 2012 by
                  <i class="ng-binding">Massive Rhino</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p><b>What steps will reproduce the problem?</b>
1. Start CSipSimple;
2. Open "Settings", advanced mode;
3. Open "Network settings"'</p>

<p>What is the expected output? 
Near the "Use STUN", "Use ICE" and "Use TURN" options there is "Override published IP address" option (for users that want to deal with NAT manually).</p>

<p>What do you see instead?
No such option.</p>

<p><b>What version of the product are you using? On what operating system?</b>
"0.04-05 r2041"</p>

<p><b>Please provide any additional information below.</b>
On desktop SIP clients I typically see 3 modes:
* While IP - no NAT traversal;
* STUN server mode;
* Enter your published IP.</p>

<p>In CSipSimple I see mostly two the first modes.
When connected over cable internet, Twinkle in STUN mode, for example, tells something like "Symmetric NAT: cannot STUN. Redirect UDP ports 5059 and 8000+ to me and input the public IP address", and it works when I do it.
I think it's not too difficult for CSipSimple to support such mode.</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #1</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Dec 6, 2012 by
                  <i class="ng-binding">Quick Hippo</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>It's per account setting.</p>

<p>Transform your account to expert wizard. (long press account row, choose wizard, expert) and edit it.</p>

<p>You'll access all accounts settings included those to change the bound ip address and in your case the announced public address. You can also select use of stun (for sip and/or for media) in per account settings.</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #2</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Dec 6, 2012 by
                  <i class="ng-binding">Massive Rhino</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>OK, found it. "RTP public address"?  Is it only for RTP or also for incoming SIP invitations, etc (the 5059 port that Twinkle wants)?</p>

<p>I think in non-expert account editor there should be a message like "Press menu -&gt; Choose wizard -&gt; Expert to view all settings". Also maybe in network settings menu there should be a notice like "To set your public IP address use expert account editor".</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #3</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Dec 6, 2012 by
                  <i class="ng-binding">Quick Hippo</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>It's for RTP address you publish in SDP.</p>

<p>For signaling normally it's not needed as channel is opened. You can fix the client port however if you want (turn expert global setting on : go in settings, press menu expert mode), and you can fix the local UDP, TCP and RTP port.</p>

<p>Normally for SIP, signaling (with the contact rewrite process) will do the trick and anyway your socket between you and the server will be kept alive so that you can get incoming call. (In SIP case it's the client initiator of the connection so no problem, problems comes when you need some incoming packets like for media).</p>

<p>About the message I don't think it's a good idea. 
Users that are not expert will not understand settings and get frustrated or mess things. 
I'm even not sure it matches your need in your case. Maybe you only want local bound ports changed.
So I prefer to guide and try to understand users needs in this case and help users to reach the best configuration for their needs. SIP configuration is really not easy for mainstream users. That's why there is wizards. As soon as it's for mainstream sip provider I can add a wizard and this provides a really better user experience than technical settings.</p>

<p>BTW, maybe I could be more helpful if you give me exact constraint you have in your network. Or exact problem you have rather than searching to apply a receipt that's seems a little bit brutal way to configure and probably not everything is needed and some more flexible configuration is possible. </p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #4</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Dec 6, 2012 by
                  <i class="ng-binding">Massive Rhino</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>There are different networks with different constraints.</p>

<p>Now I mostly experiment with SIP to be able to look at datagrams and tell what is wrong and why things fail.</p>

<p>For example, I want to wrap the whole SIP (including media session) into single TCP connection (that is forwardable over SSH, for example). I implemented a pair of programs for this. Currently it works a bit, but with issues (not tested it with CSipSimple, only with Linphone on GNU/Linux).</p>

<p>I'm unsure who decides what host:port to use for media session (and how registrars, STUN or whatever affects this); looking at things in Wireshark.</p>

<p>The only clean NATless connection I have is on my VPS server, I want to use it for SIP as well...</p>

<p>BTW is there some public sip account where I can call to verify that everything is configured correctly? E.g. I call to some "sip:testcall@example.com", it says to record message, then plays the message back, like "Skype test call"?</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #5</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Dec 8, 2012 by
                  <i class="ng-binding">Quick Hippo</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>You can try with open echo tests numbers :
<a href="http://wiki.ekiga.org/index.php/Fun_Numbers">http://wiki.ekiga.org/index.php/Fun_Numbers</a>
<a href="http://www.voip-info.org/wiki/view/Phone+Numbers">http://www.voip-info.org/wiki/view/Phone+Numbers</a></p>

<p>About who decide to ip:port for media session here's how goes things :</p>

<p>1] The sip client opens locally a ip:port for RTP media session (this is always udp as it's real time protocol). This ip:port listens for incoming packets to decode and play it. This local port in csipsimple can be configured using the RTP port setting in global settings.</p>

<p>2] The next step is to "find" the ip:port to announce to your remote.
Here starts to come the tricky stuffs.
There is several way to decide the correct ip:port to announce.
In some situations when the two sip endpoints are on same routed network (no nat in the middle), the port will be the correct one as remote will directly reach us. The IP could also be the one of the default gateway (more likely remote will reach from our default gw). However it could be different ip if multi-homed (vpn cases). In this case, the app should announce a different IP. This can be done in csipsimple by specifying the "rtp public address" option in account setting.
Another (better) solution is to rely on a third party that is a fixed point and is on the same network than your remote party : a "public" server able to resolve your rtp/udp IP:PORT. This is done using STUN. In basic terms stun is just the sip client asking to a public server how is seen ip:port of its opened udp port. As UDP allows to connect different servers from same port, it's not a problem to ask a public stun server what's our ip:port and then get incoming packets from the actual remote. The other benefit is that when you do the stun request you open the NAT hole so that what you'll get in reply will be accurate and reusable for the actual remote.
The dark side of that is that you have one STUN server that is outside and considered as being on same network than your remote side.
So will not work well if your remote side is on same network than you (and if your router is not loop-back capable). It will not work well if vpn too as the public ip is not accurate to reach client from another client in vpn network.
But, stun will work well in some cases. Example : stun server and sip server are on the same network and if the sip server also gateway all media. In this case, it's sure things works (BTW, that's what I advise to guys working with sip server in a vpn : just adding a stun server on their sip server).
A latest solution is to combine all potential candidates I enumerated before and instead of announcing only one candidate, announce how many candidates we could find out in our resolution. This is ICE and can be activated in csipsimple too (in global settings). In this case the remote side <em>must</em> also support ice, else it will just fallback on the only announced one.</p>

<p>3] Announce the public ip:port to remote side.
This is really what you should look at instead of looking udp/rtp sessions. As it's actually what's announced to remote side and how remote side should reach you. This is done in the INVITE (or reply to INVITE) in the SDP. The SDP describe media session and contains ip:port where to reach the app, it also contains codecs and sometimes crypto information.
If the SDP is wrong or doesn't present the correct ip:port there is no way for the remote to reach you. (it's not absolutely true, but for the first explanation step lets say it's the case).
The basic SDP contains only one ip:port per media. If ICE is enabled you'll see more candidates that remote side should try.</p>

<p>That's it, from this point both side should be able to stream.
SIP signaling (registrar, invite etc) should <em>not</em> affect that. Some sip client does but it's not clean assumption as normally media layer and signaling layers are separated and media path could go a very different way than signaling part. So media layer should resolve things by itself without being affected by SIP resolution. 
For example a situation where you use a sip server you reach using your VPN but that is not media gateway and where your remote side is on public network should result in having signalization using your vpn but media using the most direct path between you and the remote (the public network).</p>

<p>That's why you need to configure media layer in respect with your situation.
And if you have a VPN that is not used for default gateway, you need to consider following options at choice :
 - enable ICE and have ICE supported on remote sides
 - have a stun server on your vpn network where your sip server is
 - if not stun enabled (or stun configured to a public server), configure the account so that it announce the rtp ip of your vpn interface instead of the one of the default device gateway. (problem is that you'll need a fixed ip in this case... could be reached by assigning some mac address association in your vpn dhcp).</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments -->
          </div>

          <!-- Sidebar with additional information -->
          <div class="maia-col-4">
            <div class="maia-aside">
              <p>Status: <code class="ng-binding">WrongConfig</code></p>
              <!-- ngIf: issueCtrl.issue.labels.length > 0 --><p ng-if="issueCtrl.issue.labels.length &gt; 0" class="ng-scope">
                Labels:
                <br>
                <!-- ngRepeat: label in issueCtrl.issue.labels track by $index --><span ng-repeat="label in issueCtrl.issue.labels track by $index" class="ng-scope">
                  <span class="gca-label ng-binding">Type-Defect</span>
                </span><!-- end ngRepeat: label in issueCtrl.issue.labels track by $index --><span ng-repeat="label in issueCtrl.issue.labels track by $index" class="ng-scope">
                  <span class="gca-label ng-binding">Priority-Medium</span>
                </span><!-- end ngRepeat: label in issueCtrl.issue.labels track by $index -->
              </p><!-- end ngIf: issueCtrl.issue.labels.length > 0 -->
            </div>
          </div>
        </div><!-- end ngIf: !issueCtrl.error -->
      </div>
    </div>

  </div>
</div>
</div></div></div>
    <noscript>
      &lt;p&gt;The Google Code Archive requires JavaScript to be enabled in your browser.&lt;/p&gt;
    </noscript>

    <div id="maia-signature"></div>
    <div class="maia-footer" id="maia-footer">
      <div id="maia-footer-local">
      </div>
      <div id="maia-footer-global">
        <div class="maia-aux">
          <ul>
            <li>
              <a href="//www.google.com/">Google</a>
            </li>
            <li>
              <a href="//www.google.com/intl/en/about/">About Google</a>
            </li>
            <li>
              <a href="//www.google.com/intl/en/policies/privacy/">Privacy</a>
            </li>
            <li>
              <a href="//www.google.com/intl/en/policies/terms/">Terms</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <script src="//www.google.com/js/maia.js"></script>
  


</body></html>