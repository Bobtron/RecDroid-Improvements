https://code.google.com/archive/p/csipsimple/issues/2760<!DOCTYPE html><html class="google ng-scope" lang="en" ng-app="codesiteArchive.application"><head>
    <meta charset="utf-8">
    <meta content="initial-scale=1, minimum-scale=1, width=device-width" name="viewport">

    <!-- https://developers.google.com/webmasters/ajax-crawling/docs/specification -->
    <meta name="fragment" content="!">
    <title>Google Code Archive - Long-term storage for Google Code Project Hosting.</title>

    <link rel="icon" type="image/vnd.microsoft.icon" href="/archive/img/project-hosting.ico">
    <script src="//www.google.com/js/google.js"></script>
    <link href="//www.google.com/css/maia.css" rel="stylesheet">
    <link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,600,700&amp;lang=en" rel="stylesheet">
    <link rel="stylesheet" href="/archive/archive_css.css">
    <script>
      CLOSURE_NO_DEPS = true;
    </script>
    <script src="/archive/angular.js"></script><style type="text/css">@charset "UTF-8";

[ng\:cloak], [ng-cloak], [data-ng-cloak], [x-ng-cloak],
.ng-cloak, .x-ng-cloak,
.ng-hide:not(.ng-hide-animate) {
  display: none !important;
}

ng\:form {
  display: block;
}

.ng-animate-shim {
  visibility:hidden;
}

.ng-anchor {
  position:absolute;
}
</style>
    <script src="/archive/pagedown.js"></script>
    <script src="/archive/archive.js"></script>
    <base href="/archive/">
  </head>

  <body>
    <div class="maia-header" id="maia-header" role="banner">
      <div class="maia-aux">
        <a href="/archive/">
          </a><h1><a href="/archive/">
            <img alt="Google" src="//www.google.com/images/branding/googlelogo/1x/googlelogo_color_116x41dp.png"> Code</a>
          </h1>
        
        <a href="/archive/">
          <h2>Archive</h2>
        </a>
        <a class="maia-teleport" href="#content">Skip to content</a>
        <div class="maia-util">
          <form action="/archive/search" class="maia-search ng-pristine ng-valid">
            <input name="q" placeholder="Search this site" type="text">
            <button class="maia-button">
              <span class="maia-search-icon">Search</span>
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- ngView: --><div ng-view="" class="ng-scope"><div ng-controller="ProjectIssueCtrl as issueCtrl" class="ng-scope">
<nav-bar-widget nav-level-1="projectCtrl.navLevel1" class="ng-isolate-scope"><div class="maia-nav maia-complex" id="maia-nav-x" role="navigation">
  <div class="maia-aux">
    <ul>
      <li ng-class="{active: navLevel1 == 'projects'}">
        <a href="/archive/">Projects</a>
        <!-- ngIf: navLevel2 -->
      </li>
      <li ng-class="{active: navLevel1 == 'search'}">
        <a href="/archive/search">Search</a>
      </li>
      <li ng-class="{active: navLevel1 == 'about'}">
        <a href="/archive/about">About</a>
      </li>
    </ul>
  </div>
</div>
</nav-bar-widget>
<div id="maia-main" role="main">

  <!-- ngIf: issueCtrl.notFound -->

  <div ng-hide="issueCtrl.notFound">
    <!-- Left-side resource nav -->
    <project-resources-widget domain="issueCtrl.domain" project="issueCtrl.projectName" class="ng-isolate-scope"><div class="maia-nav" id="maia-nav-y" role="navigation">
  <!-- ngIf: domain == 'code.google.com' --><ul ng-if="domain == 'code.google.com'" class="ng-scope">
    <li class="active">
      <a href="/archive/p/csipsimple/">Project</a>
    </li>
    <li>
      <a href="/archive/p/csipsimple/source">Source</a>
    </li>
    <li>
      <a href="/archive/p/csipsimple/issues">Issues</a>
    </li>
    <li>
      <a href="/archive/p/csipsimple/wikis">Wikis</a>
    </li>
    <li>
      <a href="/archive/p/csipsimple/downloads">Downloads</a>
    </li>
  </ul><!-- end ngIf: domain == 'code.google.com' -->

    <!-- ngIf: domain != 'code.google.com' -->
</div></project-resources-widget>

    <div class="maia-article" role="article">
      <div class="maia-teleport" id="content"></div>
      <div class="maia-cols">
        <div id="gca-project-header" class="maia-col-10">
          <a id="gca-export-to-gh" class="maia-button" href="https://code.google.com/export-to-github/export?project=csipsimple">Export to GitHub</a>
            <img class="gca-project-logo" src="https://storage.googleapis.com/google-code-archive/v2/code.google.com/csipsimple/logo.png">
            <h1 class="ng-binding">csipsimple - issue #2760</h1>
            <p class="ng-binding">Weird configuration issue with Samsung IInfuse SGH-I997</p>
        </div>

        <div class="maia-col-10">
          <hr>

        <!-- ngIf: issueCtrl.error -->

        <!-- ngIf: !issueCtrl.error --><div ng-if="!issueCtrl.error" class="ng-scope">
          <!-- Comments -->
          <div class="maia-col-8">
            <!-- ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Aug 18, 2014 by
                  <i class="ng-binding">Quick Giraffe</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p><b>What steps will reproduce the problem?</b>
1. Install CSS r2427 on new phone
2. Agree with default settings in initial wizard ("Easy configuration")
3. Restore an old good working configuration from a seved .json file
4. Enter password (it's not saved within .json file) and see how account logins
5. Make test call(s) and check that CSS makes / received calls
6. Open "Settings" dialog box from CSS and immediately close it
7. Observe that you account stops registering at all, no matter what you do...</p>

<p><b>What is the expected output? What do you see instead?</b>
Expected: SIP registration still working as before
Instead: CSS can't register any SIP account anymore</p>

<p><b>What version of the product are you using? On what device / operating</b>
<b>system?</b>
Latest CSS r2427.
Samsung Infuse I997 with default ATT ROM. Android: 2.3.6. Kernel: 2.6.35.7-I997UCKL2-CL806505.</p>

<p><b>Please provide any additional information below.</b>
After opening "Settings" box, no matter what you try, it's not possible to make account registration. The only (temporary) solution from this weird  status is to go to system "Settings | Applications | Manage applications", pick CSipSimple and reset all its data ("Clear data"). Then you have to go to p.1 above...</p>

<p>Unfortunately I don't see any way to keep CSS "Settings" in some .json file for further export/import all of CSS's settings. And it seems that those settings are not kept in default "Backup" file too... It'd be nice if a regular backup file kept those settings. Or at least if those settings would be saved in some configuration file.</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #1</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Feb 22, 2015 by
                  <i class="ng-binding">Quick Giraffe</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>Using latest CSS build r2469 I tried to register CSS with the latest ATT kernel (2.6.35.7-I997RUXKG3-CL366622) and result still the same. CSS can register account with SIP server (calls have one-way audio). But as soon as I go to the "Settings" dialog (to check STUN server settings), CSS completely stops registering... The only way to make it registrations is to reset all CSS data in task manager :(</p>

<p>I've created detailed (level 5) log in CSS and it shows, that CSS sends REGISTER requests (or, rather, it thinks, that it sends those requests). But those packages never leave the phone. SIP server never gets any REGISTER packets from the phone at all. Accordingly to CSS log, destination IP address and port of SIP server in those REGISTER packets are completely correct. I tried both UDP and TCP protocols with the same result...</p>

<p>How to diagnose and resolve the problem?</p>

<p>Please note, that I can use Zoiper (another Android SIP client) on this phone to register account with the same SIP server. The problem occurs only when I use CSS.</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #2</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Mar 4, 2015 by
                  <i class="ng-binding">Quick Giraffe</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content --><span ng-if="comment.content" class="ng-scope">
                <markdown-widget text="comment.content" class="markdown"><p>Today I tested CSS r2469, now running on Android 4.4.4, and the problem is still here. So, it's definitely not related to OS or kernel version, but to CSS and perhaps how it uses its SIP library PJSIP v2.3.</p>

<p>While running CSS, I've watched network with Wireshark (SharkForRoot app) and discovered that when CSS can't register itself with SIP provider, it actually doesn't sent REGISTER packets at all! There is no REGISTER packets on the wire (or rather - on the air, 'cause it's WiFi)...</p>

<p>There are some points:
* When phone is on my LAN, it can NOT send REGISTER requests (no packets are sent via WiFi). And it doesn't matter which provider I try to use. When it's on another LAN, it can sent REGISTER packets just fine. What is the difference, that could make that happen?
* PJSIP sends/receives STUN packets OK, no matter where it's used. That could narrow focus on how PJSIP is used to sent those particular packets (REGISTER and STUN).
* The same CSS version was working well in another Android phone in the very same environments.</p>

<h2>Here is REGISTER packets, logged by CSS.</h2>

<p>Successful registration (packet is sent):
17:49:25.140   pjsua_core.c  TX 622 bytes Request msg REGISTER/cseq=28023 (tdta0x2a1e44c8) to UDP IP.ADD.RES.FSW:6060:
REGISTER sip:domain.tld SIP/2.0
Via: SIP/2.0/UDP IP.ADD.RES.WAN:42202;rport;branch=z9hG4bKPjn8KBKZ8W47Q3qOLvfBXXINApeGJe3nqC
Route: 
Max-Forwards: 70
From: "inFuse-CSS" ;tag=wf9tIy6JX8xl-PsgL26dp-Co0OdigKtA
To: "inFuse-CSS" 
Call-ID: kBAoOogJLrGCKXBbGSHEmt0Sju3obktN
CSeq: 28023 REGISTER
Contact: "inFuse-CSS" 
Expires: 605
Allow: PRACK, INVITE, ACK, BYE, CANCEL, UPDATE, INFO, SUBSCRIBE, NOTIFY, REFER, MESSAGE, OPTIONS
Contact: "inFuse-CSS" ;expires=0</p>

<h2>Content-Length:  0</h2>

<p>Failed registration (packet is not sent at all):
12:54:40.275   pjsua_core.c  TX 535 bytes Request msg REGISTER/cseq=45155 (tdta0x2a1f2cd8) to UDP IP.ADD.RES.FSW:6060:
REGISTER sip:domain.tld SIP/2.0
Via: SIP/2.0/UDP 0.0.0.0;rport;branch=z9hG4bKPjifoX-1ZMpzUOSYSk--MR0EahEtYM3MWr
Route: 
Max-Forwards: 70
From: "inFuse-CSS" ;tag=IdyeM9VKgFPRI1ahAuloy6rvF0p0tcGK
To: "inFuse-CSS" 
Call-ID: 2aLUxrsGSiN6Sci1kXKH1ROLhF3briRo
CSeq: 45155 REGISTER
Contact: "inFuse-CSS" 
Expires: 605
Allow: PRACK, INVITE, ACK, BYE, CANCEL, UPDATE, INFO, SUBSCRIBE, NOTIFY, REFER, MESSAGE, OPTIONS</p>

<h2>Content-Length:  0</h2>

<p>Here is the difference of REGISTER packets (see above) in two cases (+ OK and - BAD):
+ TX 622 bytes
- TX 535 bytes
+ Via: SIP/2.0/UDP IP.ADD.RES.WAN:42202;rport...
- Via: SIP/2.0/UDP 0.0.0.0;rport...
+ Contact: "inFuse-CSS" 
- Contact: "inFuse-CSS" 
Moreover, there are 2 "Contact" entries in OK message (and why is that?) </p>

<p>Main questions are:
1. Why CSS running in inFuse can't sent packets in one LAN and can do it on others? I don't see any difference between those LANs, but CSS running in inFuse obviously does... What could be so special about it?
2. In failure case, the IP is 0.0.0.0. Is that important? And if it is, why is that? May be answer to that question could help to find the root of the problem.</p>

<p>r3gis, please let me know where to look at the problem and what I should change to make CSS working on my LAN. Let me know if you need any other logs or you want to check my configuration. I'd be glad to provide it...</p>

<p>Thanks!</p></markdown-widget>
              </span><!-- end ngIf: comment.content -->
              <!-- ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments --><div ng-repeat="comment in issueCtrl.issue.comments" class="ng-scope">
              <div>
                <!-- ngIf: comment.id --><h3 ng-if="comment.id" class="ng-binding ng-scope">Comment #3</h3><!-- end ngIf: comment.id -->
                <!-- ms to seconds. -->
                <small class="ng-binding">
                  Posted on Jun 22, 2015 by
                  <i class="ng-binding">Quick Hippo</i>
                </small>
              </div>

              <!-- TODO(chrsmith): Get the formatting right. Google Code comments
              are not stored in wiki/markdown or HTML format. So we probably need to
              create a custom filter to get 100% paritiy. -->
              <!-- ngIf: comment.content -->
              <!-- ngIf: !comment.content --><span ng-if="!comment.content" class="ng-scope">
                <p><em>(No comment was entered for this change.)</em></p>
              </span><!-- end ngIf: !comment.content -->

              <!-- ngIf: comment.attachments.length -->
              <!-- ngRepeat: attachment in comment.attachments -->
            </div><!-- end ngRepeat: comment in issueCtrl.issue.comments -->
          </div>

          <!-- Sidebar with additional information -->
          <div class="maia-col-4">
            <div class="maia-aside">
              <p>Status: <code class="ng-binding">Obsolete</code></p>
              <!-- ngIf: issueCtrl.issue.labels.length > 0 --><p ng-if="issueCtrl.issue.labels.length &gt; 0" class="ng-scope">
                Labels:
                <br>
                <!-- ngRepeat: label in issueCtrl.issue.labels track by $index --><span ng-repeat="label in issueCtrl.issue.labels track by $index" class="ng-scope">
                  <span class="gca-label ng-binding">Type-Defect</span>
                </span><!-- end ngRepeat: label in issueCtrl.issue.labels track by $index --><span ng-repeat="label in issueCtrl.issue.labels track by $index" class="ng-scope">
                  <span class="gca-label ng-binding">Priority-Medium</span>
                </span><!-- end ngRepeat: label in issueCtrl.issue.labels track by $index -->
              </p><!-- end ngIf: issueCtrl.issue.labels.length > 0 -->
            </div>
          </div>
        </div><!-- end ngIf: !issueCtrl.error -->
      </div>
    </div>

  </div>
</div>
</div></div></div>
    <noscript>
      &lt;p&gt;The Google Code Archive requires JavaScript to be enabled in your browser.&lt;/p&gt;
    </noscript>

    <div id="maia-signature"></div>
    <div class="maia-footer" id="maia-footer">
      <div id="maia-footer-local">
      </div>
      <div id="maia-footer-global">
        <div class="maia-aux">
          <ul>
            <li>
              <a href="//www.google.com/">Google</a>
            </li>
            <li>
              <a href="//www.google.com/intl/en/about/">About Google</a>
            </li>
            <li>
              <a href="//www.google.com/intl/en/policies/privacy/">Privacy</a>
            </li>
            <li>
              <a href="//www.google.com/intl/en/policies/terms/">Terms</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <script src="//www.google.com/js/maia.js"></script>
  


</body></html>